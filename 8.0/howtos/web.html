<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Building Interface Extensions &mdash; перевод на русский язык документации odoo 8.0</title>

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="перевод на русский язык документации odoo 8.0" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Web Service API" href="../api_integration.html" />
    <link rel="prev" title="Building a Module" href="./backend.html" />
</head>

<body role="document">
    <header class="">
        <figure class="card top">
            <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
        </figure>
    </header>
    <nav id="main_navbar" class="navbar ">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-main">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <nav class="nav navbar-nav navbar-left">
                    <li id="main-back">
                        <a href="../index.html" class="mdi-navigation-arrow-back"></a>
                    </li>
                    <li>
                        <h1 id="main_title">Building Interface Extensions</h1>
                    </li>
                </nav>
            </div>

            <nav class="collapse navbar-collapse navbar-main navbar-right" role="navigation">

                <ul class="navbar-nav navbar-right nav">
                    <li class="versions">
                        <a class="dropdown-toggle" data-toggle="dropdown">
                8.0 <span class="caret"></span>
              </a>
                        <ul class="dropdown-menu" role="menu">

                            <li><a href="https://www.odoo.com/documentation/9.0/howtos/web.html">9.0</a></li>

                        </ul>
                    </li>
                </ul>

                <ul class="current navbar-nav navbar-right nav">
                    <li class="toctree-l1 current dropdown"><a data-toggle="dropdown" href="../tutorials.html" class="dropdown-toggle internal reference">Tutorials</a>
                        <ul class="current dropdown-menu">
                            <li class="toctree-l2"><a href="themes.html" class="internal reference">Theme Tutorial</a></li>
                            <li class="toctree-l2"><a href="website.html" class="internal reference">Building a Website</a></li>
                            <li class="toctree-l2"><a href="backend.html" class="internal reference">Building a Module</a></li>
                            <li class="current toctree-l2"><a href="" class="current internal reference">Building Interface Extensions</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1"><a href="../api_integration.html" class="internal reference">Web Service API</a>
                        <ul></ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../setup.html" class="dropdown-toggle internal reference">Setting Up</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../setup/install.html" class="internal reference">Installing Odoo</a></li>
                            <li class="toctree-l2"><a href="../setup/deploy.html" class="internal reference">Deploying Odoo</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../reference.html" class="dropdown-toggle internal reference">Reference</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../reference/orm.html" class="internal reference">ORM API</a></li>
                            <li class="toctree-l2"><a href="../reference/data.html" class="internal reference">Data Files</a></li>
                            <li class="toctree-l2"><a href="../reference/actions.html" class="internal reference">Actions</a></li>
                            <li class="toctree-l2"><a href="../reference/views.html" class="internal reference">Views</a></li>
                            <li class="toctree-l2"><a href="../reference/module.html" class="internal reference">Modules</a></li>
                            <li class="toctree-l2"><a href="../reference/cmdline.html" class="internal reference">Command-line interface: odoo.py</a></li>
                            <li class="toctree-l2"><a href="../reference/security.html" class="internal reference">Security in Odoo</a></li>
                            <li class="toctree-l2"><a href="../reference/testing.html" class="internal reference">Testing Modules</a></li>
                            <li class="toctree-l2"><a href="../reference/http.html" class="internal reference">Web Controllers</a></li>
                            <li class="toctree-l2"><a href="../reference/qweb.html" class="internal reference">QWeb</a></li>
                            <li class="toctree-l2"><a href="../reference/javascript.html" class="internal reference">Javascript</a></li>
                            <li class="toctree-l2"><a href="../reference/translations.html" class="internal reference">Translating Modules</a></li>
                            <li class="toctree-l2"><a href="../reference/reports.html" class="internal reference">QWeb Reports</a></li>
                            <li class="toctree-l2"><a href="../reference/workflows.html" class="internal reference">Workflows</a></li>
                            <li class="toctree-l2"><a href="../reference/guidelines.html" class="internal reference">Odoo Guidelines</a></li>
                            <li class="toctree-l2"><a href="../reference/upgrade_api.html" class="internal reference">Upgrade API</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../business.html" class="dropdown-toggle internal reference">Business Mementoes</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/accounting.html" class="external reference">Accounting Memento (US GAAP)</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/double-entry.html" class="external reference">Double-Entry Inventory</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/valuation.html" class="external reference">Inventory Valuations</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </nav>


    <main class="container ">

        <div class="row">

            <aside>
                <div class="navbar-aside text-center">
                    <div class="logo_box">
                        <span class="logo"></span> Documentation
                    </div>
                    <ul class="list-group text-left nav">
                        <li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">A Simple Module</a></li>
                        <li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo JavaScript Module</a></li>
                        <li class="list-group-item"><a href="#classes" class="ripple internal reference">Classes</a></li>
                        <li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">Widgets Basics</a>
                            <ul>
                                <li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">Your First Widget</a></li>
                                <li class="list-group-item"><a href="#display-content" class="ripple internal reference">Display Content</a></li>
                                <li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Widget Parents and Children</a></li>
                                <li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">Destroying Widgets</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">The QWeb Template Engine</a>
                            <ul>
                                <li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">Using QWeb</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">QWeb Context</a></li>
                                        <li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">Template Declaration</a></li>
                                        <li class="list-group-item"><a href="#escaping" class="ripple internal reference">Escaping</a></li>
                                        <li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">Outputting HTML</a></li>
                                        <li class="list-group-item"><a href="#conditionals" class="ripple internal reference">Conditionals</a></li>
                                        <li class="list-group-item"><a href="#iteration" class="ripple internal reference">Iteration</a></li>
                                        <li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">Defining attributes</a></li>
                                        <li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">Calling other templates</a></li>
                                        <li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">To Learn More About QWeb</a></li>
                                        <li class="list-group-item"><a href="#exercise" class="ripple internal reference">Exercise</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">Widget Helpers</a>
                            <ul>
                                <li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference"><code >Widget</code>'s jQuery Selector</a></li>
                                <li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">Easier DOM Events Binding</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">Widget Events and Properties</a>
                            <ul>
                                <li class="list-group-item"><a href="#events" class="ripple internal reference">Events</a></li>
                                <li class="list-group-item"><a href="#properties" class="ripple internal reference">Properties</a></li>
                                <li class="list-group-item"><a href="#id3" class="ripple internal reference">Exercise</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">Modify existing widgets and classes</a></li>
                        <li class="list-group-item"><a href="#translations" class="ripple internal reference">Translations</a></li>
                        <li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">Communication with the Odoo Server</a>
                            <ul>
                                <li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">Contacting Models</a></li>
                                <li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li>
                                <li class="list-group-item"><a href="#queries" class="ripple internal reference">Queries</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#exercises" class="ripple internal reference">Exercises</a></li>
                        <li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">Existing web components</a>
                            <ul>
                                <li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">The Action Manager</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">Using the Action Manager</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#client-actions" class="ripple internal reference">Client Actions</a></li>
                                <li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">Architecture of the Views</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">The View Manager</a></li>
                                        <li class="list-group-item"><a href="#the-views" class="ripple internal reference">The Views</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">The Form View Fields</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">Creating a New Type of Field</a>
                                            <ul>
                                                <li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">Simple Read-Only Field</a></li>
                                                <li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">Read-Write Field</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">The Form View Custom Widgets</a></li>
                            </ul>
                        </li>
                    </ul>

                    <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/8.0/doc/howtos/web.rst" class="gith-link">
              Edit on GitHub
          </a></p>

                </div>
            </aside>

            <article class="doc-body ">


                <section id="building-interface-extensions">
                    <p>This guide is about creating modules for Odoo's web client.</p>
                    <p>To create websites with Odoo, see <a href="website.html" class="internal reference"><em >Building a Website</em></a>; to add business capabilities or extend existing business systems of Odoo, see <a href="backend.html" class="internal reference"><em >Building a Module</em></a>.</p>
                    <div
                        role="alert" class="alert-warning alert">
                        <p class="alert-title">Warning</p>
                        <p>This guide assumes knowledge of:</p>
                        <ul>
                            <li>Javascript basics and good practices</li>
                            <li><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li>
                            <li><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li>
                        </ul>
                        <p>It also requires <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span >an installed Odoo</span></a>, and <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p>
        </div>
        </section>
        <section id="a-simple-module">
            <h2>A Simple Module</h2>
            <p>Let's start with a simple Odoo module holding basic web component configuration and letting us test the web framework.</p>
            <p>The example module is available online and can be downloaded using the following command:</p>
            <div class="highlight-console">
                <div class="highlight"><pre><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
            </div>
            <p>This will create a <code>petstore</code> folder wherever you executed the command. You then need to add that folder to Odoo's
                <a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, create a new database and install the <code>oepetstore</code> module.</p>
            <p>If you browse the <code>petstore</code> folder, you should see the following content:</p>
            <div class="highlight-text">
                <div class="highlight"><pre>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __openerp__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
            </div>
            <p>The module already holds various server customizations. We'll come back to these later, for now let's focus on the web-related content, in the <code>static</code> folder.
            </p>
            <p>Files used in the &quot;web&quot; side of an Odoo module must be placed in a <code>static</code> folder so they are available to a web browser, files outside that folder can not be fetched by browsers. The <code>src/css</code>, <code>src/js</code>                and <code>src/xml</code> sub-folders are conventional and not strictly necessary.</p>
            <dl><dt><code >oepetstore/static/css/petstore.css</code></dt>
                <dd>currently empty, will hold the <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> for pet store content</dd><dt><code >oepetstore/static/xml/petstore.xml</code></dt>
                <dd>Mostly empty, will hold <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a> templates</dd><dt><code >oepetstore/static/js/petstore.js</code></dt>
                <dd>
                    <p>The most important (and interesting) part, contains the logic of the application (or at least its web-browser side) as javascript. It should currently look like:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                    </div>
                </dd>
            </dl>
            <p>Which only prints a small message in the browser's console.</p>
            <div role="alert" class="alert-warning alert">
                <p class="alert-title">Warning</p>
                <p>All JavaScript files are concatenated and <a href="../glossary.html#term-minified" class="internal alert-link reference"><span class="std std-term xref">minified</span></a> to improve application load time.</p>
                <p>One of the drawback is debugging becomes more difficult as individual files disappear and the code is made significantly less readable. It is possible to disable this process by enabling the &quot;developer mode&quot;: log into your Odoo
                    instance (user <em>admin</em> password
                    <em>admin</em> by default) open the user menu (in the top-right corner of the Odoo screen) and select <span class="guilabel">About Odoo</span> then <span class="guilabel">Activate
the developer mode</span>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block">
                <p>This will reload the web client with optimizations disabled, making development and debugging significantly more comfortable.</p>
            </div>
        </section>
        <section id="odoo-javascript-module">
            <h2>Odoo JavaScript Module</h2>
            <p>Javascript doesn't have built-in modules. As a result variables defined in different files are all mashed together and may conflict. This has given rise to various module patterns used to build clean namespaces and limit risks of naming conflicts.</p>
            <p>The Odoo framework uses one such pattern to define modules within web addons, in order to both namespace code and correctly order its loading.</p>
            <p><code>oepetstore/static/js/petstore.js</code> contains a module declaration:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
            </div>
            <p>In Odoo web, modules are declared as functions set on the global <code>openerp</code> variable. The function's name must be the same as the addon (in this case
                <code>oepetstore</code>) so the framework can find it, and automatically initialize it.</p>
            <p>When the web client loads your module it will call the root function and provide two parameters:</p>
            <ul>
                <li>the first parameter is the current instance of the Odoo web client, it gives access to various capabilities defined by the Odoo (translations, network services) as well as objects defined by the core or by other modules.
                </li>
                <li>the second parameter is your own local namespace automatically created by the web client. Objects and variables which should be accessible from outside your module (either because the Odoo web client needs to call them or because others
                    may want to customize them) should be set inside that namespace.
                </li>
            </ul>
        </section>
        <section id="classes">
            <h2>Classes</h2>
            <p>Much as modules, and contrary to most object-oriented languages, javascript does not build in <em>classes</em><a href="#id4" class="footnote-ref" id="id1">1</a> although it provides roughly equivalent (if lower-level and more verbose) mechanisms.</p>
            <p>For simplicity and developer-friendliness Odoo web provides a class system based on John Resig's <a href="http://ejohn.org/blog/simple-javascript-inheritance/" class="external reference">Simple JavaScript Inheritance</a>.</p>
            <p>New classes are defined by calling the <code class="js-func xref js">extend()</code> method of <code class="js-class xref js">openerp.web.Class()</code>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>The <code class="js-func xref js">extend()</code> method takes a dictionary describing the new class's content (methods and static attributes). In this case, it will only have a <code>say_hello</code> method which takes no parameters.</p>
            <p>Classes are instantiated using the <code>new</code> operator:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
            </div>
            <p>And attributes of the instance can be accessed via <code>this</code>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
            </div>
            <p>Classes can provide an initializer to perform the initial setup of the instance, by defining an <code>init()</code> method. The initializer receives the parameters passed when using the <code>new</code> operator:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
            </div>
            <p>It is also possible to create subclasses from existing (used-defined) classes by calling <code class="js-func xref js">extend()</code> on the parent class, as is done to subclass <code class="js-class xref js">Class()</code>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
            </div>
            <p>When overriding a method using inheritance, you can use <code>this._super()</code> to call the original method:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
            </div>
            <div role="alert" class="alert-warning alert">
                <p class="alert-title">Warning</p>
                <p><code>_super</code> is not a standard method, it is set on-the-fly to the next method in the current inheritance chain, if any. It is only defined during the <em>synchronous</em> part of a method call, for use in asynchronous handlers
                    (after network calls or in <code>setTimeout</code> callbacks) a reference to its value should be retained, it should not be accessed via <code>this</code>:</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                </div>
            </div>
        </section>
        <section id="widgets-basics">
            <h2>Widgets Basics</h2>
            <p>The Odoo web client bundles <a href="http://jquery.org" class="external reference">jQuery</a> for easy DOM manipulation. It is useful and provides a better API than standard <a href="http://www.w3.org/TR/DOM-Level-3-Core/" class="external reference">W3C DOM</a>
                <a
                    href="#dombugs" class="footnote-ref" id="id2">2</a>, but insufficient to structure complex applications leading to difficult maintenance.
            </p>
            <p>Much like object-oriented desktop UI toolkits (e.g. <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a> or <a href="http://www.gtk.org"
                    class="external reference">GTK</a>), Odoo Web makes specific components responsible for sections of a page. In Odoo web, the base for such components is the <a href="../reference/javascript.html#openerp.Widget" class="internal reference"
                    title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> class, a component specialized in handling a page section and displaying information for the user.</p>
        </section>
        <section id="your-first-widget">
            <h3>Your First Widget</h3>
            <p>The initial demonstration module already provides a basic widget:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>It extends <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> and overrides the standard method
                <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>, which — much like the previous <code>MyClass</code> — does little for
                now.</p>
            <p>This line at the end of the file:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
            </div>
            <p>registers our basic widget as a client action. Client actions will be explained later, for now this is just what allows our widget to be called and displayed when we select the
                <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span> menu.</p>
            <div role="alert" class="alert-warning alert">
                <p class="alert-title">Warning</p>
                <p>because the widget will be called from outside our module, the web client needs its &quot;fully qualified&quot; name, not the local version.</p>
            </div>
        </section>
        <section id="display-content">
            <h3>Display Content</h3>
            <p>Widgets have a number of methods and features, but the basics are simple:</p>
            <ul>
                <li>set up a widget</li>
                <li>format the widget's data</li>
                <li>display the widget</li>
            </ul>
            <p>The <code>HomePage</code> widget already has a <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> method. That method is part
                of the normal widget lifecycle and automatically called once the widget is inserted in the page. We can use it to display some content.
            </p>
            <p>All widgets have a <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> which represents the section of page they're in charge of (as
                a <a href="http://jquery.org" class="external reference">jQuery</a> object). Widget content should be inserted there. By default,
                <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> is an empty <code>&lt;div&gt;</code> element.</p>
            <p>A <code>&lt;div&gt;</code> element is usually invisible to the user if it has no content (or without specific styles giving it a size) which is why nothing is displayed on the page when <code>HomePage</code> is launched.</p>
            <p>Let's add some content to the widget's root element, using jQuery:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>That message will now appear when you open <span class="menuselection">Pet Store
‣ Pet Store ‣ Home Page</span></p>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>to refresh the javascript code loaded in Odoo Web, you will need to reload the page. There is no need to restart the Odoo server.</p>
            </div>
            <p>The <code>HomePage</code> widget is used by Odoo Web and managed automatically. To learn how to use a widget &quot;from scratch&quot; let's create a new one:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>We can now add our <code>GreetingsWidget</code> to the <code>HomePage</code> by using the
                <code>GreetingsWidget</code>'s <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a> method:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <ul>
                <li><code>HomePage</code> first adds its own content to its DOM root</li>
                <li><code>HomePage</code> then instantiates <code>GreetingsWidget</code></li>
                <li>Finally it tells <code>GreetingsWidget</code> where to insert itself, delegating part of its <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a>                    to the <code>GreetingsWidget</code>.</li>
            </ul>
            <p>When the <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a> method is called, it asks the widget to insert itself at
                the specified position and to display its content. The <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> method will be
                called during the call to <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>.</p>
            <p>To see what happens under the displayed interface, we will use the browser's DOM Explorer. But first let's alter our widgets slightly so we can more easily find where they are, by <a href="../reference/javascript.html#openerp.Widget.className"
                    class="internal reference" title="openerp.Widget.className"><code class="js-attr xref js">adding a class to their root elements</code></a>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>If you can find the relevant section of the DOM (right-click on the text then <span class="guilabel">Inspect Element</span>), it should look like this:</p>
            <div class="highlight-html">
                <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello dear Odoo user!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>We are so happy to see you again in this menu!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <p>Which clearly shows the two <code>&lt;div&gt;</code> elements automatically created by
                <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, because we added some classes on them.</p>
            <p>We can also see the two message-holding divs we added ourselves</p>
            <p>Finally, note the <code>&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> element which represents the <code>GreetingsWidget</code> instance is <em>inside</em> the
                <code>&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> which represents the <code>HomePage</code> instance, since we appended</p>
        </section>
        <section id="widget-parents-and-children">
            <h3>Widget Parents and Children</h3>
            <p>In the previous part, we instantiated a widget using this syntax:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
            </div>
            <p>The first argument is <code>this</code>, which in that case was a <code>HomePage</code> instance. This tells the widget being created which other widget is its
                <em>parent</em>.</p>
            <p>As we've seen, widgets are usually inserted in the DOM by another widget and
                <em>inside</em> that other widget's root element. This means most widgets are &quot;part&quot; of another widget, and exist on behalf of it. We call the container the
                <em>parent</em>, and the contained widget the <em>child</em>.</p>
            <p>Due to multiple technical and conceptual reasons, it is necessary for a widget to know who is its parent and who are its children.</p>
            <dl><dt><code class="js-func xref js">getParent()</code></dt>
                <dd>
                    <p>can be used to get the parent of a widget:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                </dd><dt><code class="js-func xref js">getChildren()</code></dt>
                <dd>
                    <p>can be used to get a list of its children:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                </dd>
            </dl>
            <p>When overriding the <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> method of a widget it is
                <em>of the utmost importance</em> to pass the parent to the <code>this._super()</code> call, otherwise the relation will not be set up correctly:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>Finally, if a widget does not have a parent (e.g. because it's the root widget of the application), <code>null</code> can be provided as parent:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
            </div>
        </section>
        <section id="destroying-widgets">
            <h3>Destroying Widgets</h3>
            <p>If you can display content to your users, you should also be able to erase it. This is done via the <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>                method:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
            </div>
            <p>When a widget is destroyed it will first call
                <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a> on all its children. Then it erases itself from the DOM. If you
                have set up permanent structures in
                <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> or <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference"
                    title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> which must be explicitly cleaned up (because the garbage collector will not handle them), you can override <a href="../reference/javascript.html#openerp.Widget.destroy"
                    class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>.</p>
            <div role="alert" class="alert-danger alert">
                <p class="alert-title">Danger</p>
                <p>when overriding <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal alert-link reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>, <code>_super()</code>
                    <em>must always</em> be called otherwise the widget and its children are not correctly cleaned up leaving possible memory leaks and &quot;phantom events&quot;, even if no error is displayed</p>
            </div>
        </section>
        <section id="the-qweb-template-engine">
            <h2>The QWeb Template Engine</h2>
            <p>In the previous section we added content to our widgets by directly manipulating (and adding to) their DOM:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
            </div>
            <p>This allows generating and displaying any type of content, but gets unwieldy when generating significant amounts of DOM (lots of duplication, quoting issues, ...)</p>
            <p>As many other environments, Odoo's solution is to use a <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">template engine</a>. Odoo's template engine is called <a href="../reference/qweb.html#reference-qweb"
                    class="internal reference"><span >QWeb</span></a>.</p>
            <p>QWeb is an XML-based templating language, similar to <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a>                or <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. It has the following characteristics:
            </p>
            <ul>
                <li>It's implemented fully in JavaScript and rendered in the browser</li>
                <li>Each template file (XML files) contains multiple templates</li>
                <li>It has special support in Odoo Web's <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, though it can be used outside of Odoo's web
                    client (and it's possible to use
                    <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> without relying on QWeb)</li>
            </ul>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>The rationale behind using QWeb instead of existing javascript template engines is the extensibility of pre-existing (third-party) templates, much like Odoo <a href="../reference/views.html#reference-views" class="internal alert-link reference"><span >views</span></a>.</p>
                <p>Most javascript template engines are text-based which precludes easy structural extensibility where an XML-based templating engine can be generically altered using e.g. XPath or CSS and a tree-alteration DSL (or even just XSLT). This flexibility
                    and extensibility is a core characteristic of Odoo, and losing it was considered unacceptable.</p>
            </div>
        </section>
        <section id="using-qweb">
            <h3>Using QWeb</h3>
            <p>First let's define a simple QWeb template in the almost-empty
                <code>oepetstore/static/src/xml/petstore.xml</code> file:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
            </div>
            <p>Now we can use this template inside of the <code>HomePage</code> widget. Using the
                <code>QWeb</code> loader variable defined at the top of the page, we can call to the template defined in the XML file:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p><code class="js-func xref js">QWeb.render()</code> looks for the specified template, renders it to a string and returns the result.</p>
            <p>However, because <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> has special integration for QWeb the template can be set directly on
                the widget via its
                <a href="../reference/javascript.html#openerp.Widget.template" class="internal reference" title="openerp.Widget.template"><code class="js-attr xref js">template</code></a> attribute:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>Although the result looks similar, there are two differences between these usages:
            </p>
            <ul>
                <li>with the second version, the template is rendered right before
                    <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> is called</li>
                <li>in the first version the template's content is added to the widget's root element, whereas in the second version the template's root element is directly <em>set as</em> the widget's root element. Which is why the &quot;greetings&quot;
                    sub-widget also gets a red background</li>
            </ul>
            <div role="alert" class="alert-warning alert">
                <p class="alert-title">Warning</p>
                <p>templates should have a single non-<code>t</code> root element, especially if they're set as a widget's
                    <a href="../reference/javascript.html#openerp.Widget.template" class="internal alert-link reference" title="openerp.Widget.template"><code class="js-attr xref js">template</code></a>. If there are multiple &quot;root elements&quot;, results are undefined (usually only the first root element will be used and the others will be ignored)</p>
            </div>
        </section>
        <section id="qweb-context">
            <h4>QWeb Context</h4>
            <p>QWeb templates can be given data and can contain basic display logic.</p>
            <p>For explicit calls to <code class="js-func xref js">QWeb.render()</code>, the template data is passed as second parameter:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
            </div>
            <p>with the template modified to:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
            </div>
            <p>will result in:</p>
            <div class="highlight-html">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Klaus<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <p>When using <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>'s integration it is not possible to provide additional data to the template.
                The template will be given a single
                <code>widget</code> context variable, referencing the widget being rendered right before <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>                is called (the widget's state will essentially be that set up by <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a>):</p>
            <div
                class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                </div>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                </div>
                <p>Result:</p>
                <div class="highlight-html">
                    <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Mordecai<span class="nt">&lt;/div&gt;</span>
</pre></div>
                </div>
        </section>
        <section id="template-declaration">
            <h4>Template Declaration</h4>
            <p>We've seen how to <em>render</em> QWeb templates, let's now see the syntax of the templates themselves.</p>
            <p>A QWeb template is composed of regular XML mixed with QWeb <em>directives</em>. A QWeb directive is declared with XML attributes starting with <code>t-</code>.</p>
            <p>The most basic directive is <code>t-name</code>, used to declare new templates in a template file:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
            </div>
            <p><code>t-name</code> takes the name of the template being defined, and declares that it can be called using <code class="js-func xref js">QWeb.render()</code>. It can only be used at the top-level of a template file.</p>
        </section>
        <section id="escaping">
            <h4>Escaping</h4>
            <p>The <code>t-esc</code> directive can be used to output text:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
            </div>
            <p>It takes a Javascript expression which is evaluated, the result of the expression is then HTML-escaped and inserted in the document. Since it's an expression it's possible to provide just a variable name as above, or a more complex expression
                like a computation:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
            </div>
            <p>or method calls:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
            </div>
        </section>
        <section id="outputting-html">
            <h4>Outputting HTML</h4>
            <p>To inject HTML in the page being rendered, use <code>t-raw</code>. Like <code>t-esc</code> it takes an arbitrary Javascript expression as parameter, but it does not perform an HTML-escape step.</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
            </div>
            <div role="alert" class="alert-danger alert">
                <p class="alert-title">Danger</p>
                <p><code>t-raw</code> <em>must not</em> be used on any data which may contain non-escaped user-provided content as this leads to <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">cross-site scripting</a>                    vulnerabilities
                </p>
            </div>
        </section>
        <section id="conditionals">
            <h4>Conditionals</h4>
            <p>QWeb can have conditional blocks using <code>t-if</code>. The directive takes an arbitrary expression, if the expression is falsy (<code>false</code>, <code>null</code>, <code>0</code> or an empty string) the whole block is suppressed, otherwise
                it is displayed.</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>QWeb doesn't have an &quot;else&quot; structure, use a second <code>t-if</code> with the original condition inverted. You may want to store the condition in a local variable if it's a complex or expensive expression.</p>
            </div>
        </section>
        <section id="iteration">
            <h4>Iteration</h4>
            <p>To iterate on a list, use <code>t-foreach</code> and <code>t-as</code>. <code>t-foreach</code> takes an expression returning a list to iterate on <code>t-as</code> takes a variable name to bind to each item during iteration.</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p><code>t-foreach</code> can also be used with numbers and objects (dictionaries)
                </p>
            </div>
        </section>
        <section id="defining-attributes">
            <h4>Defining attributes</h4>
            <p>QWeb provides two related directives to define computed attributes:
                <code class="samp">t-att-<em >name</em></code> and <code class="samp">t-attf-<em >name</em></code>. In either case, <em>name</em> is the name of the attribute to create (e.g. <code>t-att-id</code> defines the attribute
                <code>id</code> after rendering).</p>
            <p><code>t-att-</code> takes a javascript expression whose result is set as the attribute's value, it is most useful if all of the attribute's value is computed:
            </p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <p><code>t-attf-</code> takes a <em>format string</em>. A format string is literal text with interpolation blocks inside, an interpolation block is a javascript expression between <code>{{</code> and <code>}}</code>, which will be replaced by
                the result of the expression. It is most useful for attributes which are partially literal and partially computed such as a class:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
        </section>
        <section id="calling-other-templates">
            <h4>Calling other templates</h4>
            <p>Templates can be split into sub-templates (for simplicity, maintainability, reusability or to avoid excessive markup nesting).</p>
            <p>This is done using the <code>t-call</code> directive, which takes the name of the template to render:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
            </div>
            <p>rendering the <code>A</code> template will result in:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
            </div>
            <p>Sub-templates inherit the rendering context of their caller.</p>
        </section>
        <section id="to-learn-more-about-qweb">
            <h4>To Learn More About QWeb</h4>
            <p>For a QWeb reference, see <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p>
        </section>
        <section id="exercise">
            <h4>Exercise</h4>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Usage of QWeb in Widgets</p>
                <p>Create a widget whose constructor takes two parameters aside from
                    <code>parent</code>: <code>product_names</code> and <code>color</code>.</p>
                <ul>
                    <li><code>product_names</code> should an array of strings, each one the name of a product
                    </li>
                    <li><code>color</code> is a string containing a color in CSS color format (ie:
                        <code>#000000</code> for black).</li>
                </ul>
                <p>The widget should display the given product names one under the other, each one in a separate box with a background color with the value of
                    <code>color</code> and a border. You should use QWeb to render the HTML. Any necessary CSS should be in <code>oepetstore/static/src/css/petstore.css</code>.</p>
                <p>Use the widget in <code>HomePage</code> with half a dozen products.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span><span class="p">(</span>
                <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;graphic card&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">],</span> <span class="s2">&quot;#00FF00&quot;</span><span class="p">);</span>
            <span class="nx">products</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ProductsWidget&quot;</span><span class="p">,</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">products</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">products</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ProductsWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;widget.products&quot;</span> <span class="na">t-as=</span><span class="s">&quot;product&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oe_products_item&quot;</span>
                      <span class="na">t-attf-style=</span><span class="s">&quot;background-color: {{ widget.color }};&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;product&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;br/&gt;</span>
            <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                </div>
                <div class="highlight-css">
                    <div class="highlight"><pre><span class="nc">.oe_products_item</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                </div>
                <a href="../_images/qweb.png" class="internal alert-link reference"><img src="../_images/qweb.png" class="img-responsive center-block"></a>
            </div>
        </section>
        <section id="widget-helpers">
            <h2>Widget Helpers</h2></section>
        <section id="widget-s-jquery-selector">
            <h3><code >Widget</code>'s jQuery Selector</h3>
            <p>Selecting DOM elements within a widget can be performed by calling the
                <code>find()</code> method on the widget's DOM root:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
            </div>
            <p>But because it's a common operation, <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> provides an equivalent shortcut through the
                <a
                    href="../reference/javascript.html#openerp.Widget._S_" class="internal reference" title="openerp.Widget.$"><code class="js-func xref js">$()</code></a> method:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <div role="alert" class="alert-warning alert">
                <p class="alert-title">Warning</p>
                <p>The global jQuery function <code>$()</code> should <em>never</em> be used unless it is absolutely necessary: selection on a widget's root are scoped to the widget and local to it, but selections with <code>$()</code> are global to the
                    page/application and may match parts of other widgets and views, leading to odd or dangerous side-effects. Since a widget should generally act only on the DOM section it owns, there is no cause for global selection.</p>
            </div>
        </section>
        <section id="easier-dom-events-binding">
            <h3>Easier DOM Events Binding</h3>
            <p>We have previously bound DOM events using normal jQuery event handlers (e.g.
                <code>.click()</code> or <code>.change()</code>) on widget elements:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>While this works it has a few issues:</p>
            <ol>
                <li>it is rather verbose</li>
                <li>it does not support replacing the widget's root element at runtime as the binding is only performed when <code>start()</code> is run (during widget initialization)
                </li>
                <li>it requires dealing with <code>this</code>-binding issues</li>
            </ol>
            <p>Widgets thus provide a shortcut to DOM event binding via
                <a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">events</code></a>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p><a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">events</code></a> is an object (mapping) of an event to the function or method to call when
                the event is triggered:</p>
            <ul>
                <li>the key is an event name, possibly refined with a CSS selector in which case only if the event happens on a selected sub-element will the function or method run: <code>click</code> will handle all clicks within the widget, but
                    <code>click .my_button</code> will only handle clicks in elements bearing the
                    <code>my_button</code> class</li>
                <li>
                    <p>the value is the action to perform when the event is triggered</p>
                    <p>It can be either a function:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <p>or the name of a method on the object (see example above).</p>
                    <p>In either case, the <code>this</code> is the widget instance and the handler is given a single parameter, the <a href="http://api.jquery.com/category/events/event-object/" class="external reference">jQuery event object</a> for the
                        event.</p>
                </li>
            </ul>
        </section>
        <section id="widget-events-and-properties">
            <h2>Widget Events and Properties</h2></section>
        <section id="events">
            <h3>Events</h3>
            <p>Widgets provide an event system (separate from the DOM/jQuery event system described above): a widget can fire events on itself, and other widgets (or itself) can bind themselves and listen for these events:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>This widget acts as a facade, transforming user input (through DOM events) into a documentable internal event to which parent widgets can bind themselves.
            </p>
            <p><code class="js-func xref js">trigger()</code> takes the name of the event to trigger as its first (mandatory) argument, any further arguments are treated as event data and passed directly to listeners.</p>
            <p>We can then set up a parent event instantiating our generic widget and listening to the <code>user_chose</code> event using <code class="js-func xref js">on()</code>:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p><code class="js-func xref js">on()</code> binds a function to be called when the event identified by <code>event_name</code> is. The <code>func</code> argument is the function to call and <code>object</code> is the object to which that function
                is related if it is a method. The bound function will be called with the additional arguments of <code class="js-func xref js">trigger()</code> if it has any. Example:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
            </div>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>Triggering events on an other widget is generally a bad idea. The main exception to that rule is <code>openerp.web.bus</code> which exists specifically to broadcasts evens in which any widget could be interested throughout the Odoo web
                    application.</p>
            </div>
        </section>
        <section id="properties">
            <h3>Properties</h3>
            <p>Properties are very similar to normal object attributes in that they allow storing data on a widget instance, however they have the additional feature that they trigger events when set:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
            </div>
            <ul>
                <li><code class="js-func xref js">set()</code> sets the value of a property and triggers
                    <code class="samp">change:<em >propname</em></code> (where <em>propname</em> is the property name passed as first parameter to <code class="js-func xref js">set()</code>) and <code>change</code></li>
                <li><code class="js-func xref js">get()</code> retrieves the value of a property.</li>
            </ul>
        </section>
        <section id="id3">
            <h3>Exercise</h3>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Widget Properties and Events</p>
                <p>Create a widget <code>ColorInputWidget</code> that will display 3 <code>&lt;input
type=&quot;text&quot;&gt;</code>. Each of these <code>&lt;input&gt;</code> is dedicated to type a hexadecimal number from 00 to FF. When any of these <code>&lt;input&gt;</code> is modified by the user the widget must query the content of the three
                    <code>&lt;input&gt;</code>, concatenate their values to have a complete CSS color code (ie: <code>#00FF00</code>) and put the result in a property named <code>color</code>. Please note the jQuery <code>change()</code> event that you
                    can bind on any HTML
                    <code>&lt;input&gt;</code> element and the <code>val()</code> method that can query the current value of that <code>&lt;input&gt;</code> could be useful to you for this exercise.</p>
                <p>Then, modify the <code>HomePage</code> widget to instantiate <code>ColorInputWidget</code> and display it. The <code>HomePage</code> widget should also display an empty rectangle. That rectangle must always, at any moment, have the same
                    background color as the color in the <code>color</code> property of the
                    <code>ColorInputWidget</code> instance.</p>
                <p>Use QWeb to generate all HTML.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ColorInputWidget&quot;</span><span class="p">,</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;input_changed&#39;</span>
        <span class="p">},</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input_changed</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">input_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#&quot;</span><span class="p">,</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_red&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_green&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_blue&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color_changed</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">color_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_div&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">));</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ColorInputWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Red: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_red&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Green: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_green&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Blue: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_blue&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_color_div&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                </div>
                <div class="highlight-css">
                    <div class="highlight"><pre><span class="nc">.oe_color_div</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                </div>
            </div>
        </section>
        <section id="modify-existing-widgets-and-classes">
            <h2>Modify existing widgets and classes</h2>
            <p>The class system of the Odoo web framework allows direct modification of existing classes using the <code class="js-func xref js">include()</code> method:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
            </div>
            <p>This system is similar to the inheritance mechanism, except it will alter the target class in-place instead of creating a new class.</p>
            <p>In that case, <code>this._super()</code> will call the original implementation of a method being replaced/redefined. If the class already had sub-classes, all calls to <code>this._super()</code> in sub-classes will call the new implementations
                defined in the call to <code class="js-func xref js">include()</code>. This will also work if some instances of the class (or of any of its sub-classes) were created prior to the call to <code class="js-func xref js">include()</code>.</p>
        </section>
        <section id="translations">
            <h2>Translations</h2>
            <p>The process to translate text in Python and JavaScript code is very similar. You could have noticed these lines at the beginning of the
                <code>petstore.js</code> file:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
            </div>
            <p>These lines are simply used to import the translation functions in the current JavaScript module. They are used thus:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
            </div>
            <p>In Odoo, translations files are automatically generated by scanning the source code. All piece of code that calls a certain function are detected and their content is added to a translation file that will then be sent to the translators. In
                Python, the function is <code>_()</code>. In JavaScript the function is
                <code class="js-func xref js">_t()</code> (and also <code class="js-func xref js">_lt()</code>).</p>
            <p><code>_t()</code> will return the translation defined for the text it is given. If no translation is defined for that text, it will return the original text as-is.</p>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>To inject user-provided values in translatable strings, it is recommended to use <a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a> with named arguments <em>after</em>                    the translation:</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
                </div>
                <p>This makes translatable strings more readable to translators, and gives them more flexibility to reorder or ignore parameters.</p>
            </div>
            <p><code class="js-func xref js">_lt()</code> (&quot;lazy translate&quot;) is similar but somewhat more complex: instead of translating its parameter immediately, it returns an object which, when converted to a string, will perform the translation.</p>
            <p>It is used to define translatable terms before the translations system is initialized, for class attributes for instance (as modules are loaded before the user's language is configured and translations are downloaded).</p>
        </section>
        <section id="communication-with-the-odoo-server">
            <h2>Communication with the Odoo Server</h2></section>
        <section id="contacting-models">
            <h3>Contacting Models</h3>
            <p>Most operations with Odoo involve communicating with <em>models</em> implementing business concern, these models will then (potentially) interact with some storage engine (usually <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p>
            <p>Although <a href="http://jquery.org" class="external reference">jQuery</a> provides a <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> function for network interactions, communicating with Odoo requires additional
                metadata whose setup before every call would be verbose and error-prone. As a result, Odoo web provides higher-level communication primitives.</p>
            <p>To demonstrate this, the file <code>petstore.py</code> already contains a small model with a sample method:</p>
            <div class="highlight-python">
                <div class="highlight"><pre><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">:</span> <span class="s">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
            </div>
            <p>This declares a model with two fields, and a method <code>my_method()</code> which returns a literal dictionary.</p>
            <p>Here is a sample widget that calls <code>my_method()</code> and displays the result:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>The class used to call Odoo models is <a href="../reference/javascript.html#openerp.Model" class="internal reference" title="openerp.Model"><code class="js-class xref js">openerp.Model()</code></a>. It is instantiated with the Odoo model's
                name as first parameter (
                <code>oepetstore.message_of_the_day</code> here).</p>
            <p><code class="js-func xref js">call()</code> can be used to call any (public) method of an Odoo model. It takes the following positional arguments:</p>
            <dl><dt><code >name</code></dt>
                <dd>The name of the method to call, <code>my_method</code> here</dd><dt><code >args</code></dt>
                <dd>
                    <p>an array of <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">positional arguments</a> to provide to the method. Because the example has no positional argument to provide, the <code>args</code>                        parameter is not provided.
                    </p>
                    <p>Here is an other example with positional arguments:</p>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                    </div>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                    </div>
                </dd><dt><code >kwargs</code></dt>
                <dd>
                    <p>a mapping of <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">keyword arguments</a> to pass. The example provides a single named argument <code>context</code>.</p>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                    </div>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                    </div>
                </dd>
            </dl>
            <p><code class="js-func xref js">call()</code> returns a deferred resolved with the value returned by the model's method as first argument.</p>
        </section>
        <section id="compoundcontext">
            <h3>CompoundContext</h3>
            <p>The previous section used a <code>context</code> argument which was not explained in the method call:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
            </div>
            <p>The context is like a &quot;magic&quot; argument that the web client will always give to the server when calling a method. The context is a dictionary containing multiple keys. One of the most important key is the language of the user, used
                by the server to translate all the messages of the application. Another one is the time zone of the user, used to compute correctly dates and times if Odoo is used by people in different countries.</p>
            <p>The <code>argument</code> is necessary in all methods, otherwise bad things could happen (such as the application not being translated correctly). That's why, when you call a model's method, you should always provide that argument. The solution
                to achieve that is to use <code class="js-class xref js">openerp.web.CompoundContext()</code>.</p>
            <p><code class="js-class xref js">CompoundContext()</code> is a class used to pass the user's context (with language, time zone, etc...) to the server as well as adding new keys to the context (some models' methods use arbitrary keys added to
                the context). It is created by giving to its constructor any number of dictionaries or other <code class="js-class xref js">CompoundContext()</code> instances. It will merge all those contexts before sending them to the server.</p>
            <div
                class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
                </div>
                <div class="highlight-python">
                    <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;lang&#39;</span><span class="p">:</span> <span class="s">&#39;en_US&#39;</span><span class="p">,</span> <span class="s">&#39;new_key&#39;</span><span class="p">:</span> <span class="s">&#39;key_value&#39;</span><span class="p">,</span> <span class="s">&#39;tz&#39;</span><span class="p">:</span> <span class="s">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
                </div>
                <p>You can see the dictionary in the argument <code>context</code> contains some keys that are related to the configuration of the current user in Odoo plus the
                    <code>new_key</code> key that was added when instantiating
                    <code class="js-class xref js">CompoundContext()</code>.</p>
        </section>
        <section id="queries">
            <h3>Queries</h3>
            <p>While <a href="../reference/javascript.html#openerp.Model.call" class="internal reference" title="openerp.Model.call"><code class="js-func xref js">call()</code></a> is sufficient for any interaction with Odoo models, Odoo Web provides a helper
                for simpler and clearer querying of models (fetching of records based on various conditions):
                <a href="../reference/javascript.html#openerp.Model.query" class="internal reference" title="openerp.Model.query"><code class="js-func xref js">query()</code></a> which acts as a shortcut for the common combination of <a href="../reference/orm.html#openerp.models.Model.search"
                    class="internal reference" title="openerp.models.Model.search"><code class="py py-meth xref">search()</code></a> and :
                <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>. It provides a clearer syntax to search and read models:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>versus:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
            </div>
            <ul>
                <li><code class="js-func xref js">query()</code> takes an optional list of fields as parameter (if no field is provided, all fields of the model are fetched). It returns a <a href="../reference/javascript.html#openerp.web.Query" class="internal reference"
                        title="openerp.web.Query"><code class="js-class xref js">openerp.web.Query()</code></a> which can be further customized before being executed</li>
                <li><a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> represents the query being built. It is immutable, methods to customize the
                    query actually return a modified copy, so it's possible to use the original and the new version side-by-side. See
                    <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> for its customization options.</li>
            </ul>
            <p>When the query is set up as desired, simply call
                <a href="../reference/javascript.html#openerp.web.Query.all" class="internal reference" title="openerp.web.Query.all"><code class="js-func xref js">all()</code></a> to execute it and return a deferred to its result. The result is the same
                as
                <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>'s, an array of dictionaries where each dictionary is a requested record,
                with each requested field a dictionary key.</p>
        </section>
        <section id="exercises">
            <h2>Exercises</h2>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Message of the Day</p>
                <p>Create a <code>MessageOfTheDay</code> widget displaying the last record of the
                    <code>oepetstore.message_of_the_day</code> model. The widget should fetch its record as soon as it is displayed.</p>
                <p>Display the widget in the Pet Store home page.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MessageOfTheDay&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                </div>
                <div class="highlight-css">
                    <div class="highlight"><pre><span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                </div>
            </div>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Pet Toys List</p>
                <p>Create a <code>PetToysList</code> widget displaying 5 toys (using their name and their images).</p>
                <p>The pet toys are not stored in a new model, instead they're stored in
                    <code>product.product</code> using a special category <em>Pet Toys</em>. You can see the pre-generated toys and add new ones by going to
                    <span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. You will probably need to explore <code>product.product</code> to create the right domain to select just pet toys.</p>
                <p>In Odoo, images are generally stored in regular fields encoded as
                    <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML supports displaying images straight from base64 with
                    <code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p>
                <p>The <code>PetToysList</code> widget should be displayed on the home page on the right of the <code>MessageOfTheDay</code> widget. You will need to make some layout with CSS to achieve this.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_left&#39;</span><span class="p">)),</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_right&#39;</span><span class="p">))</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;MessageOfTheDay&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;oepetstore.message_of_the_day&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
                <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                    <span class="p">});</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_left&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToysList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoyslist&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-att-src=</span><span class="s">&quot;&#39;data:image/jpg;base64,&#39;+item.image&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                </div>
                <div class="highlight-css">
                    <div class="highlight"><pre><span class="nc">.oe_petstore_homepage</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_left</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_right</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoyslist</span> <span class="p">{</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoy</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                </div>
            </div>
        </section>
        <section id="existing-web-components">
            <h2>Existing web components</h2></section>
        <section id="the-action-manager">
            <h3>The Action Manager</h3>
            <p>In Odoo, many operations start from an <a href="../reference/actions.html#reference-actions" class="internal reference"><span >action</span></a>: opening a menu item (to a view), printing a report, ...</p>
            <p>Actions are pieces of data describing how a client should react to the activation of a piece of content. Actions can be stored (and read through a model) or they can be generated on-the fly (locally to the client by javascript code, or remotely
                by a method of a model).</p>
            <p>In Odoo Web, the component responsible for handling and reacting to these actions is the <em>Action Manager</em>.</p>
        </section>
        <section id="using-the-action-manager">
            <h4>Using the Action Manager</h4>
            <p>The action manager can be invoked explicitly from javascript code by creating a dictionary describing <a href="../reference/actions.html#reference-actions" class="internal reference"><span >an action</span></a> of the right type, and calling
                an action manager instance with it.</p>
            <p><code class="js-func xref js">do_action()</code> is a shortcut of <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> looking up the &quot;current&quot;
                action manager and executing the action:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
            </div>
            <p>The most common action <code>type</code> is <code>ir.actions.act_window</code> which provides views to a model (displays a model in various manners), its most common attributes are:</p>
            <dl><dt><code >res_model</code></dt>
                <dd>The model to display in views</dd><dt><code >res_id</code> (optional)</dt>
                <dd>For form views, a preselected record in <code>res_model</code></dd><dt><code >views</code></dt>
                <dd>Lists the views available through the action. A list of
                    <code>[view_id, view_type]</code>, <code>view_id</code> can either be the database identifier of a view of the right type, or <code>false</code> to use the view by default for the specified type. View types can not be present multiple
                    times. The action will open the first view of the list by default.</dd><dt><code >target</code></dt>
                <dd>Either <code>current</code> (the default) which replaces the &quot;content&quot; section of the web client by the action, or <code>new</code> to open the action in a dialog box.</dd><dt><code >context</code></dt>
                <dd>Additional context data to use within the action.</dd>
            </dl>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Jump to Product</p>
                <p>Modify the <code>PetToysList</code> component so clicking on a toy replaces the homepage by the toy's form view.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .oe_petstore_pettoy&#39;</span><span class="o">:</span> <span class="s1">&#39;selected_item&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
            <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                <span class="p">});</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">selected_item</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s1">&#39;product.product&#39;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span> <span class="na">t-att-data-id=</span><span class="s">&quot;item.id&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-attf-src=</span><span class="s">&quot;data:image/jpg;base64,{{item.image}}&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                </div>
            </div>
        </section>
        <section id="client-actions">
            <h3>Client Actions</h3>
            <p>Throughout this guide, we used a simple <code>HomePage</code> widget which the web client automatically starts when we select the right menu item. But how did the Odoo web know to start this widget? Because the widget is registered as a <em>client action</em>.</p>
            <p>A client action is (as its name implies) an action type defined almost entirely in the client, in javascript for Odoo web. The server simply sends an action tag (an arbitrary name), and optionally adds a few parameters, but beyond that <em>everything</em>                is handled by custom client code.</p>
            <p>Our widget is registered as the handler for the client action through this:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
            </div>
            <p><code>instance.web.client_actions</code> is a <code class="js-class xref js">Registry()</code> in which the action manager looks up client action handlers when it needs to execute one. The first parameter of <code class="js-class xref js">add()</code>                is the name (tag) of the client action, and the second parameter is the path to the widget from the Odoo web client root.</p>
            <p>When a client action must be executed, the action manager looks up its tag in the registry, walks the specified path and displays the widget it finds at the end.</p>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <p>a client action handler can also be a regular function, in whch case it'll be called and its result (if any) will be interpreted as the next action to execute.</p>
            </div>
            <p>On the server side, we had simply defined an <code>ir.actions.client</code> action:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
            </div>
            <p>and a menu opening the action:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
            </div>
        </section>
        <section id="architecture-of-the-views">
            <h3>Architecture of the Views</h3>
            <p>Much of Odoo web's usefulness (and complexity) resides in views. Each view type is a way of displaying a model in the client.</p>
        </section>
        <section id="the-view-manager">
            <h4>The View Manager</h4>
            <p>When an <code>ActionManager</code> instance receive an action of type
                <code>ir.actions.act_window</code>, it delegates the synchronization and handling of the views themselves to a <em>view manager</em>, which will then set up one or multiple views depending on the original action's requirements:</p>
            <a href="../_images/viewarchitecture.svg"
                class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a>
        </section>
        <section id="the-views">
            <h4>The Views</h4>
            <p>Most <a href="../reference/views.html#reference-views" class="internal reference"><span >Odoo views</span></a> are implemented through a subclass of <code class="js-class xref js">openerp.web.View()</code> which provides a bit of generic basic
                structure for handling events and displaying model information.</p>
            <p>The <em>search view</em> is considered a view type by the main Odoo framework, but handled separately by the web client (as it's a more permanent fixture and can interact with other views, which regular views don't do).</p>
            <p>A view is responsible for loading its own description XML (using
                <a href="../reference/orm.html#openerp.models.Model.fields_view_get" class="internal reference" title="openerp.models.Model.fields_view_get"><code class="py xref py-class">fields_view_get</code></a>) and any other data source it needs.
                To that purpose, views are provided with an optional view identifier set as the <code class="js-attr xref js">view_id</code> attribute.</p>
            <p>Views are also provided with a <code class="js-class xref js">DataSet()</code> instance which holds most necessary model information (the model name and possibly various record ids).</p>
            <p>Views may also want to handle search queries by overriding
                <code class="js-func xref js">do_search()</code>, and updating their
                <code class="js-class xref js">DataSet()</code> as necessary.</p>
        </section>
        <section id="the-form-view-fields">
            <h3>The Form View Fields</h3>
            <p>A common need is the extension of the web form view to add new ways of displaying fields.</p>
            <p>All built-in fields have a default display implementation, a new form widget may be necessary to correctly interact with a new field type (e.g. a <a href="../glossary.html#term-gis" class="internal reference"><span class="std std-term xref">GIS</span></a>                field) or to provide new representations and ways to interact with existing field types (e.g. validate
                <a href="../reference/orm.html#openerp.fields.Char" class="internal reference" title="openerp.fields.Char"><code class="py xref py-class">Char</code></a> fields which should contain email addresses and display them as email links).</p>
            <p>To explicitly specify which form widget should be used to display a field, simply use the <code>widget</code> attribute in the view's XML description:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
            </div>
            <div role="alert" class="alert-info alert">
                <p class="alert-title">Note</p>
                <ul>
                    <li>the same widget is used in both &quot;view&quot; (read-only) and &quot;edition&quot; modes of a form view, it's not possible to use a widget in one and an other widget in the other</li>
                    <li>and a given field (name) can not be used multiple times in the same form</li>
                    <li>a widget may ignore the current mode of the form view and remain the same in both view and edition</li>
                </ul>
            </div>
            <p>Fields are instantiated by the form view after it has read its XML description and constructed the corresponding HTML representing that description. After that, the form view will communicate with the field objects using some methods. These
                methods are defined by the <code>FieldInterface</code> interface. Almost all fields inherit the <code>AbstractField</code> abstract class. That class defines some default mechanisms that need to be implemented by most fields.</p>
            <p>Here are some of the responsibilities of a field class:</p>
            <ul>
                <li>The field class must display and allow the user to edit the value of the field.</li>
                <li>
                    <p>It must correctly implement the 3 field attributes available in all fields of Odoo. The <code>AbstractField</code> class already implements an algorithm that dynamically calculates the value of these attributes (they can change at
                        any moment because their value change according to the value of other fields). Their values are stored in <em>Widget Properties</em> (the widget properties were explained earlier in this guide). It is the responsibility of each
                        field class to check these widget properties and dynamically adapt depending of their values. Here is a description of each of these attributes:
                    </p>
                    <ul>
                        <li><code>required</code>: The field must have a value before saving. If <code>required</code> is <code>true</code> and the field doesn't have a value, the method
                            <code>is_valid()</code> of the field must return <code>false</code>.</li>
                        <li><code>invisible</code>: When this is <code>true</code>, the field must be invisible. The
                            <code>AbstractField</code> class already has a basic implementation of this behavior that fits most fields.</li>
                        <li><code>readonly</code>: When <code>true</code>, the field must not be editable by the user. Most fields in Odoo have a completely different behavior depending on the value of <code>readonly</code>. As example, the <code>FieldChar</code>                            displays an HTML <code>&lt;input&gt;</code> when it is editable and simply displays the text when it is read-only. This also means it has much more code it would need to implement only one behavior, but this is necessary to
                            ensure a good user experience.
                        </li>
                    </ul>
                </li>
                <li>Fields have two methods, <code>set_value()</code> and <code>get_value()</code>, which are called by the form view to give it the value to display and get back the new value entered by the user. These methods must be able to handle the
                    value as given by the Odoo server when a <code>read()</code> is performed on a model and give back a valid value for a <code>write()</code>. Remember that the JavaScript/Python data types used to represent the values given by <code>read()</code>                    and given to
                    <code>write()</code> is not necessarily the same in Odoo. As example, when you read a many2one, it is always a tuple whose first value is the id of the pointed record and the second one is the name get (ie: <code>(15, &quot;Agrolait&quot;)</code>).
                    But when you write a many2one it must be a single integer, not a tuple anymore. <code>AbstractField</code> has a default implementation of these methods that works well for simple data type and set a widget property named
                    <code>value</code>.</li>
            </ul>
            <p>Please note that, to better understand how to implement fields, you are strongly encouraged to look at the definition of the <code>FieldInterface</code> interface and the <code>AbstractField</code> class directly in the code of the Odoo web
                client.
            </p>
        </section>
        <section id="creating-a-new-type-of-field">
            <h4>Creating a New Type of Field</h4>
            <p>In this part we will explain how to create a new type of field. The example here will be to re-implement the <code>FieldChar</code> class and progressively explain each part.</p>
        </section>
        <section id="simple-read-only-field">
            <h5>Simple Read-Only Field</h5>
            <p>Here is a first implementation that will only display text. The user will not be able to modify the content of the field.</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
            </div>
            <p>In this example, we declare a class named <code>FieldChar2</code> inheriting from
                <code>AbstractField</code>. We also register this class in the registry
                <code>instance.web.form.widgets</code> under the key <code>char2</code>. That will allow us to use this new field in any form view by specifying <code>widget=&quot;char2&quot;</code> in the
                <code>&lt;field/&gt;</code> tag in the XML declaration of the view.</p>
            <p>In this example, we define a single method: <code>render_value()</code>. All it does is display the widget property <code>value</code>. Those are two tools defined by the
                <code>AbstractField</code> class. As explained before, the form view will call the method <code>set_value()</code> of the field to set the value to display. This method already has a default implementation in <code>AbstractField</code>                which simply sets the widget property <code>value</code>. <code>AbstractField</code> also watch the
                <code>change:value</code> event on itself and calls the <code>render_value()</code> when it occurs. So, <code>render_value()</code> is a convenience method to implement in child classes to perform some operation each time the value of
                the field changes.</p>
            <p>In the <code>init()</code> method, we also define the default value of the field if none is specified by the form view (here we assume the default value of a
                <code>char</code> field should be an empty string).</p>
        </section>
        <section id="read-write-field">
            <h5>Read-Write Field</h5>
            <p>Read-only fields, which only display content and don't allow the user to modify it can be useful, but most fields in Odoo also allow editing. This makes the field classes more complicated, mostly because fields are supposed to handle both
                editable and non-editable mode, those modes are often completely different (for design and usability purpose) and the fields must be able to switch between modes at any moment.</p>
            <p>To know in which mode the current field should be, the <code>AbstractField</code> class sets a widget property named <code>effective_readonly</code>. The field should watch for changes in that widget property and display the correct mode accordingly.
                Example:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
            </div>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
            </div>
            <p>In the <code>start()</code> method (which is called immediately after a widget has been appended to the DOM), we bind on the event <code>change:effective_readonly</code>. That allows us to redisplay the field each time the widget property
                <code>effective_readonly</code> changes. This event handler will call
                <code>display_field()</code>, which is also called directly in <code>start()</code>. This
                <code>display_field()</code> was created specifically for this field, it's not a method defined in <code>AbstractField</code> or any other class. We can use this method to display the content of the field depending on the current mode.</p>
            <p>From now on the conception of this field is typical, except there is a lot of verifications to know the state of the <code>effective_readonly</code> property:</p>
            <ul>
                <li>In the QWeb template used to display the content of the widget, it displays an <code>&lt;input type=&quot;text&quot; /&gt;</code> if we are in read-write mode and nothing in particular in read-only mode.</li>
                <li>In the <code>display_field()</code> method, we have to bind on the <code>change</code> event of the <code>&lt;input type=&quot;text&quot; /&gt;</code> to know when the user has changed the value. When it happens, we call the <code>internal_set_value()</code>                    method with the new value of the field. This is a convenience method provided by the
                    <code>AbstractField</code> class. That method will set a new value in the <code>value</code> property but will not trigger a call to <code>render_value()</code> (which is not necessary since the <code>&lt;input type=&quot;text&quot; /&gt;</code>                    already contains the correct value).
                </li>
                <li>In <code>render_value()</code>, we use a completely different code to display the value of the field depending if we are in read-only or in read-write mode.</li>
            </ul>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Create a Color Field</p>
                <p>Create a <code>FieldColor</code> class. The value of this field should be a string containing a color code like those used in CSS (example: <code>#FF0000</code> for red). In read-only mode, this color field should display a little block
                    whose color corresponds to the value of the field. In read-write mode, you should display an <code>&lt;input type=&quot;color&quot; /&gt;</code>. That type of <code>&lt;input /&gt;</code> is an HTML5 component that doesn't work in
                    all browsers but works well in Google Chrome. So it's OK to use as an exercise.</p>
                <p>You can use that widget in the form view of the <code>message_of_the_day</code> model for its field named <code>color</code>. As a bonus, you can change the
                    <code>MessageOfTheDay</code> widget created in the previous part of this guide to display the message of the day with the background color indicated in the
                    <code>color</code> field.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldColor</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;effective_readonly&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldColor&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_field_color_content&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldColor&#39;</span><span class="p">);</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldColor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color_content&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;color&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                </div>
                <div class="highlight-css">
                    <div class="highlight"><pre><span class="nc">.oe_field_color_content</span> <span class="p">{</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                </div>
            </div>
        </section>
        <section id="the-form-view-custom-widgets">
            <h3>The Form View Custom Widgets</h3>
            <p>Form fields are used to edit a single field, and are intrinsically linked to a field. Because this may be limiting, it is also possible to create
                <em>form widgets</em> which are not so restricted and have less ties to a specific lifecycle.
            </p>
            <p>Custom form widgets can be added to a form view through the <code>widget</code> tag:</p>
            <div class="highlight-xml">
                <div class="highlight"><pre><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
            </div>
            <p>This type of widget will simply be created by the form view during the creation of the HTML according to the XML definition. They have properties in common with the fields (like the <code>effective_readonly</code> property) but they are not
                assigned a precise field. And so they don't have methods like
                <code>get_value()</code> and <code>set_value()</code>. They must inherit from the <code>FormWidget</code> abstract class.</p>
            <p>Form widgets can interact with form fields by listening for their changes and fetching or altering their values. They can access form fields through their <code class="js-attr xref js">field_manager</code> attribute:</p>
            <div class="highlight-javascript">
                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
            </div>
            <p><code class="js-attr xref js">FormWidget</code> is generally the
                <code class="js-class xref js">FormView()</code> itself, but features used from it should be limited to those defined by <code class="js-class xref js">FieldManagerMixin()</code>, the most useful being:</p>
            <ul>
                <li><code class="js-func xref js">get_field_value(field_name)()</code> which returns the value of a field.</li>
                <li><code class="js-func xref js">set_values(values)()</code> sets multiple field values, takes a mapping of <code>{field_name: value_to_set}</code></li>
                <li>An event <code class="samp">field_changed:<em >field_name</em></code> is triggered any time the value of the field called <code>field_name</code> is changed</li>
            </ul>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Show Coordinates on Google Map</p>
                <p>Add two fields to <code>product.product</code> storing a latitude and a longitude, then create a new form widget to display the latitude and longitude of a product's origin on a map</p>
                <p>To display the map, use Google Map's embedding:</p>
                <div class="highlight-html">
                    <div class="highlight"><pre><span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span> <span class="na">src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/iframe&gt;</span>
</pre></div>
                </div>
                <p>where <code>XXX</code> should be replaced by the latitude and <code>YYY</code> by the longitude.
                </p>
                <p>Display the two position fields and a map widget using them in a new notebook page of the product's form view.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                </div>
            </div>
            <div role="alert" class="alert-exercise alert">
                <p class="alert-title">Exercise</p>
                <p>Get the Current Coordinate</p>
                <p>Add a button resetting the product's coordinates to the location of the user, you can get these coordinates using the
                    <a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">javascript geolocation API</a>.</p>
                <p>Now we would like to display an additional button to automatically set the coordinates to the location of the current user.</p>
                <p>To get the coordinates of the user, an easy way is to use the geolocation JavaScript API. <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">See the online documentation to know how to use it</a>.</p>
                <p>Please also note that the user should not be able to click on that button when the form view is in read-only mode. So, this custom widget should handle correctly the <code>effective_readonly</code> property just like any field. One way
                    to do this would be to make the button disappear when <code>effective_readonly</code> is true.</p>
                <div class="highlight-javascript">
                    <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;received_position&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">sup</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">received_position</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">set_values</span><span class="p">({</span>
            <span class="s2">&quot;provider_latitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
            <span class="s2">&quot;provider_longitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                </div>
                <div class="highlight-xml">
                    <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;button&gt;</span>Get My Current Coordinate<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                </div>
            </div>
            <div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> as a separate concept from instances. In many languages classes are full-fledged objects and themselves instance (of metaclasses) but there remains two fairly
                separate hierarchies between classes and instances</div>
            <div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> as well as papering over cross-browser differences, although this has become less necessary over time</div>
        </section>

        </article>
        </div>

        <div id="mask"></div>
    </main>

    <div class="floating_action_container">
        <a id="floating_action" class="ripple" href="#">
            <i class="mdi-action-explore"></i>
        </a>
        <div id="floating_action_menu">
            <span class="bubble"></span>
            <ul class="list-group content">
                <li class="list-group-item ripple"><a>Cras justo odio</a></li>
                <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
                <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
                <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
                <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
            </ul>
        </div>
    </div>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter42690849 = new Ya.Metrika({
                    id: 42690849,
                    clickmap: true,
                    trackLinks: true,
                    accurateTrackBounce: true,
                    webvisor: true,
                    trackHash: true
                });
            } catch (e) {}
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function() {
                n.parentNode.insertBefore(s, n);
            };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else {
            f();
        }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/42690849" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>

</html>
