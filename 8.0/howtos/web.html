<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Building Interface Extensions &mdash; перевод на русский язык документации odoo 8.0</title>

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="перевод на русский язык документации odoo 8.0" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Web Service API" href="../api_integration.html" />
    <link rel="prev" title="Building a Module" href="./backend.html" />
</head>

<body role="document">
    <header class="">
        <figure class="card top">
            <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
        </figure>
    </header>
    <nav id="main_navbar" class="navbar ">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-main">
                    <span class="sr-only">Навигация</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <nav class="nav navbar-nav navbar-left">
                    <li id="main-back">
                        <a href="../index.html" class="mdi-navigation-arrow-back"></a>
                    </li>
                    <li>
                        <h1 id="main_title">Создание расширений пользовательского интерфейса</h1>
                    </li>
                </nav>
            </div>

            <nav class="collapse navbar-collapse navbar-main navbar-right" role="navigation">

                <ul class="navbar-nav navbar-right nav">
                    <li class="versions">
                        <a class="dropdown-toggle" data-toggle="dropdown">
                8.0 <span class="caret"></span>
              </a>
                        <ul class="dropdown-menu" role="menu">

                            <li><a href="https://www.odoo.com/documentation/9.0/howtos/web.html">9.0</a></li>

                        </ul>
                    </li>
                </ul>

                <ul class="current navbar-nav navbar-right nav">
                    <li class="toctree-l1 current dropdown"><a data-toggle="dropdown" href="../tutorials.html" class="dropdown-toggle internal reference">Руководства</a>
                        <ul class="current dropdown-menu">
                            <li class="toctree-l2"><a href="themes.html" class="internal reference">Создание своей темы</a></li>
                            <li class="toctree-l2"><a href="website.html" class="internal reference">Создание вебсайта</a></li>
                            <li class="toctree-l2"><a href="backend.html" class="current internal reference">Создание модуля</a></li>
                            <li class="current toctree-l2"><a href="" class="internal reference">Создание расширений для интерфейса</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1"><a href="../api_integration.html" class="internal reference">Web Service API</a>
                        <ul></ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../setup.html" class="dropdown-toggle internal reference">Настройка</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../setup/install.html" class="internal reference">Установка Odoo</a></li>
                            <li class="toctree-l2"><a href="../setup/deploy.html" class="internal reference">Развертывание Odoo</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../reference.html" class="dropdown-toggle internal reference">Справка</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../reference/orm.html" class="internal reference">ORM API</a></li>
                            <li class="toctree-l2"><a href="../reference/data.html" class="internal reference">Файлы с данными</a></li>
                            <li class="toctree-l2"><a href="../reference/actions.html" class="internal reference">Действия</a></li>
                            <li class="toctree-l2"><a href="../reference/views.html" class="internal reference">Представления</a></li>
                            <li class="toctree-l2"><a href="../reference/module.html" class="internal reference">Модули</a></li>
                            <li class="toctree-l2"><a href="../reference/cmdline.html" class="internal reference">Интерфейс коммандной строки: odoo.py</a></li>
                            <li class="toctree-l2"><a href="../reference/security.html" class="internal reference">Безопасность в Odoo</a></li>
                            <li class="toctree-l2"><a href="../reference/testing.html" class="internal reference">Тестирование модулей</a></li>
                            <li class="toctree-l2"><a href="../reference/http.html" class="internal reference">Web Controllers</a></li>
                            <li class="toctree-l2"><a href="../reference/qweb.html" class="internal reference">QWeb</a></li>
                            <li class="toctree-l2"><a href="../reference/javascript.html" class="internal reference">Javascript</a></li>
                            <li class="toctree-l2"><a href="../reference/translations.html" class="internal reference">Перевод Модулей</li>
                      <li class="toctree-l2"><a href="../reference/reports.html" class="internal reference">Печатные формы(Отчеты) на QWeb</a></li>
                            <li class="toctree-l2"><a href="../reference/workflows.html" class="internal reference">Бизнес-процессы</a></li>
                            <li class="toctree-l2"><a href="../reference/guidelines.html" class="internal reference">Методические рекомендации по Odoo</a></li>
                            <li class="toctree-l2"><a href="../reference/upgrade_api.html" class="internal reference">API для обновления</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../business.html" class="dropdown-toggle internal reference">Business Mementoes</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/accounting.html" class="external reference">Accounting Memento (US GAAP)</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/double-entry.html" class="external reference">Double-Entry Inventory</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/valuation.html" class="external reference">Inventory Valuations</a></li>
                        </ul>
            </nav>
        </div>
    </nav>


    <main class="container ">

        <div class="row">

            <aside>
                <div class="navbar-aside text-center">
                    <div class="logo_box">
                        <span class="logo"></span> Документация
                    </div>
                    <ul class="list-group text-left nav">
                        <li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">Простой модуль</a></li>
                        <li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo JavaScript модуль</a></li>
                        <li class="list-group-item"><a href="#classes" class="ripple internal reference">Классы</a></li>
                        <li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">Основы Widget</a>
                            <ul>
                                <li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">Ваш первый Widget</a></li>
                                <li class="list-group-item"><a href="#display-content" class="ripple internal reference">Отображение контента</a></li>
                                <li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Родительские и дочерние объекты Widget</a></li>
                                <li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">Уничтожение Widget</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">Генератор шаблонов QWeb</a>
                            <ul>
                                <li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">Использование QWeb</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">QWeb контекст</a></li>
                                        <li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">Объеявление шаблона</a></li>
                                        <li class="list-group-item"><a href="#escaping" class="ripple internal reference">Escaping</a></li>
                                        <li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">Вывод HTML</a></li>
                                        <li class="list-group-item"><a href="#conditionals" class="ripple internal reference">Conditionals</a></li>
                                        <li class="list-group-item"><a href="#iteration" class="ripple internal reference">Iteration</a></li>
                                        <li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">Defining attributes</a></li>
                                        <li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">Calling other templates</a></li>
                                        <li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">To Learn More About QWeb</a></li>
                                        <li class="list-group-item"><a href="#exercise" class="ripple internal reference">Exercise</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">Widget Helpers</a>
                            <ul>
                                <li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference"><code >Widget</code>'s jQuery Selector</a></li>
                                <li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">Easier DOM Events Binding</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">Widget Events and Properties</a>
                            <ul>
                                <li class="list-group-item"><a href="#events" class="ripple internal reference">Events</a></li>
                                <li class="list-group-item"><a href="#properties" class="ripple internal reference">Properties</a></li>
                                <li class="list-group-item"><a href="#id3" class="ripple internal reference">Exercise</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">Modify existing widgets and classes</a></li>
                        <li class="list-group-item"><a href="#translations" class="ripple internal reference">Translations</a></li>
                        <li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">Communication with the Odoo Server</a>
                            <ul>
                                <li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">Contacting Models</a></li>
                                <li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li>
                                <li class="list-group-item"><a href="#queries" class="ripple internal reference">Queries</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#exercises" class="ripple internal reference">Exercises</a></li>
                        <li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">Existing web components</a>
                            <ul>
                                <li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">The Action Manager</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">Using the Action Manager</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#client-actions" class="ripple internal reference">Client Actions</a></li>
                                <li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">Architecture of the Views</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">The View Manager</a></li>
                                        <li class="list-group-item"><a href="#the-views" class="ripple internal reference">The Views</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">The Form View Fields</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">Creating a New Type of Field</a>
                                            <ul>
                                                <li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">Simple Read-Only Field</a></li>
                                                <li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">Read-Write Field</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">The Form View Custom Widgets</a></li>
                            </ul>
                        </li>
                    </ul>

                    <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/8.0/doc/howtos/web.rst" class="gith-link">
              Доступно на GitHub
          </a></p>

                </div>
            </aside>

            <article class="doc-body ">


                <section id="building-interface-extensions">
                    <p>Это руководство о том, как создавать модули для Odoo веб клиента.</p>
                    <p>Для того, чтобы создавать вебсайт с помощью Odoo, смотрите <a href="website.html" class="internal reference"><em >Создание вебсайта</em></a>; для того чтобы добавить новые бизнес возможности или расширить существующие в Odoo бизнес
                        системы, смотрите <a href="backend.html" class="internal reference"><em >Создание модуля</em></a>.</p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Это руководство предполагает знание:</p>
                        <ul>
                            <li>Основы и рекомендации по использованию Javascript</li>
                            <li><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li>
                            <li><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li>
                        </ul>
                        <p>так требеуется <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span >установленная система Odoo</span></a>, и <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p>
                    </div>
                </section>
                <section id="a-simple-module">
                    <h2>Простой модуль</h2>
                    <p>Давайте наченем с простого модуля, который содержит базовую конфигурацию веб компонентов и позволяет нам тестировать веб-фреймворк.</p>
                    <p>пример доступен онлайн и может быть скачан с помощью следующей команды:</p>
                    <div class="highlight-console">
                        <div class="highlight"><pre><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
                    </div>
                    <p>Данное действие создаст <code>petstore</code> каталог. Далее вам необходимо добавить этот каталог в
                        <a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, для Odoo, создать новую базу данных и установить модуль<code>oepetstore</code>.</p>
                    <p>Если вы просмотрие <code>petstore</code> каталог, вы увидете следующие содержимое:</p>
                    <div class="highlight-text">
                        <div class="highlight"><pre>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __openerp__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
                    </div>
                    <p>Модуль уже содержит некоторые изменения серверной части. мы вернемся к этому чуть позже, а сейчас давайть сфокусируеся на содержимом каталога <code>static</code>, который связан непосрественно с веб отображением.
                    </p>
                    <p>Файлы используемые в &quot;web&quot; части Odoo модуля должны быть помещены в каталог <code>static</code>, для того, чтобы они стали доступны из веб-браузереа файлы, находящиеся вне этого каталога, не могут быть получены браузером
                        напрямую. Подкаталоги <code>src/css</code>, <code>src/js</code> and <code>src/xml</code> не обязаны иметь строго аналогичные названия и имееют такие именя исключительно для удобства разработки.</p>
                    <dl><dt><code >oepetstore/static/css/petstore.css</code></dt>
                        <dd>пока пуст, будет содержать <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> для контента магазина для животных </dd><dt><code >oepetstore/static/xml/petstore.xml</code></dt>
                        <dd>Так же почти пуст, будет содержать <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a> шаблон</dd><dt><code >oepetstore/static/js/petstore.js</code></dt>
                        <dd>
                            <p>Наиболее важная (и интерестная) часть, содержит логику приложения (или по крайнен мере его веб-браузерную часть) как javascript. Должна выглядеть следующим образом:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p>Она выводит небольшое сообщение в коносоль веб-браузера.</p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Все JavaScript файлы объеденены и <a href="../glossary.html#term-minified" class="internal alert-link reference"><span class="std std-term xref">сжаты</span></a> для снижения времени загрузки приложения.</p>
                        <p>Одним из недостатков такого подхода является то, что отладка становится более сложной отдельные файлы исчезают и код становится практически не читаемым. Есть возможность отключить данных процесс путем включения &quot;режима разработчика&quot;:
                            авторизируйтесь в вашей Odoo системе (логин <em>admin</em> пароль
                            <em>admin</em> по умолчанию) откройте меню пользователя (в правом верхнем углу Odoo экрана) и выбирете <span class="guilabel">About Odoo</span> а затем <span class="guilabel">Activate
the developer mode</span>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block">
                        <p>Данный механизм перезагрузит клиент с отключенными механизмами оптимизации, что позволит вести разработку и отладку более комфортно.</p>
                    </div>
                </section>
                <section id="odoo-javascript-module">
                    <h2>Odoo JavaScript модуль</h2>
                    <p>Чистый Javascript сам по себе не имеет встроенных модулей. В результате чего переменные определенные в разных файлах могут смешиваться и конфиликтовать. Такая ситуация привела к тому, что стали появляться различные шаблоны модулей,
                        использование которых помзовляет создавать чистые пространства имен с минимальными рисками конфликтов.</p>
                    <p>Фреймворк Odoo использует такого рода шаблоны для определения модулей внутри своих веб расширений, для уопорядочивания как пространства имен так и правильного порядка загрузки.</p>
                    <p><code>oepetstore/static/js/petstore.js</code> содержит объявление модуля:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <p>В веб части Odoo, модули объявляются как функции присвоенные глобальной переменной <code>openerp</code>. Имя функции должно быть таким же как и расширения(модуля) (в данном случае
                        <code>oepetstore</code>) для того чтобы фреймворк смог найти ее и автоматически инициализировать.</p>
                    <p>Когда веб клиент загружает ваш модуль он вызывает корневую(root) функцию и передают ей два параметра:</p>
                    <ul>
                        <li>первый параметр это текущий экземпляр(инстанс) Odoo веб клиента, это предоставляет доступ к различным возможностям определенными Odoo (переводы, сетевые службы), а так же объектам определенным ядром или другими модулями.
                        </li>
                        <li>второй параметр это ваше собственное пространство имен, которое автомтически созадется самим веб клиентом. Список объектов и переменных, которые должны быть доступны вне вашего модуля (либо из-за того что Odoo веб клиенту необходимо
                            вызывать их, либо другие хотят кастомизировать их) должны быть установлены внутри этого пространства имен.
                        </li>
                    </ul>
                </section>
                <section id="classes">
                    <h2>Классы</h2>
                    <p>В отличие от модулей и вопреки большинству объекто-ориентированных языков, javascript не построен на классах <em>classes</em><a href="#id4" class="footnote-ref" id="id1">1</a> хотя и предоставляет приблизительно эквивалентные (если
                        низкоуровневые и более многословные) мехнанизмы.</p>
                    <p>Для простоты и удобства разработчиков веб часть Odoo предоставляет систему классовн основанную на <a href="http://ejohn.org/blog/simple-javascript-inheritance/" class="external reference">Простое наследование JavaScript</a>.</p>
                    <p>Новые классы определяются вызовом <code class="js-func xref js">extend()</code> метода класса <code class="js-class xref js">openerp.web.Class()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Метод <code class="js-func xref js">extend()</code> принимает словарь, словарь нового класса, в котором содержится описание всего содержимого (методов и статических атрибутов). В данном случаае класс будет иметь только метод <code>say_hello</code>                        который не принимает параметров.</p>
                    <p>Экземпляры класс создаются с помощью оператора <code>new</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Доступ к атрибута экземпляра может быть получен через <code>this</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Классы могут предоставлять инициализатор для выполнения первоначальной настройки экземпляра, через определение метода <code>init()</code>. Инициализатор принимает параметры, переданны при использовании оператора <code>new</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Так же существует возможность создавать подклассы из существующих (использованны-определенных) классов путем вызова <code class="js-func xref js">extend()</code> для родительского класса, как это делается для подкласса <code class="js-class xref js">Class()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>При переопределении метода с использованием наследования вы можете использовать <code>this._super()</code> для вызова оригинального метода:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p><code>_super</code> не является стандарнтым методом, он устанавливаентся "на лету" к следущему метод в текущей цепочке наследования, если таковая имеется. Он определяется только во время <em>синхронных</em> части вызова метода,
                            для вызова в асинхронных обработчиках (после сетевых вызово или в обратных вызовах <code>setTimeout</code>) ссылку на его значение следует хранить, она не будет доступна через <code>this</code>:</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="widgets-basics">
                    <h2>Основы работы с Widget</h2>
                    <p>Odoo веб клиент привязан к <a href="http://jquery.org" class="external reference">jQuery</a> для простой манипуляции DOM моделью. Он полезен и предоставляет API лучше чем стандартный
                        <a href="http://www.w3.org/TR/DOM-Level-3-Core/"
                            class="external reference">W3C DOM</a>
                            <a href="#dombugs" class="footnote-ref" id="id2">2</a>, но не достаточный для структурирования комплексных приложений, что приводит к сложностям в обслуживании.
                    </p>
                    <p>Подобно объектно-ориентированным инструментариям пользовательского интерфейса (например <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a>                        или <a href="http://www.gtk.org" class="external reference">GTK</a>), Odoo Web назначает отдельные компоненты ответственными за отдельные секции страницы. В Odoo web, базой для таких компонентов является класс
                        <a href="../reference/javascript.html#openerp.Widget"
                            class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, специализирующийся на обработке раздела страницы и отображении информации для пользователя.</p>
                </section>
                <section id="your-first-widget">
                    <h3>Ваш первый Widget</h3>
                    <p>В начальном демонстрационном модуле уже есть базовый виджет:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Она расширяет <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> и переопределяет стандартный метод
                        <a href="../reference/javascript.html#openerp.Widget.start"
                            class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>, который как и предыдущий <code>MyClass</code> — пока еще мало что делает.</p>
                    <p>Эта строка в конце файла:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre>
</div>
                    </div>
                    <p>регистрирует наш простой виджет как действие клиента. Действия клиента будут объяснены позже, на данный момент это позволяет нашему виджету быть вызванным и показанным когда мы выбираем пункт меню
                        <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span>
                    </p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>т.к. виджет будет вызываться вне нашего модуля, веб клиенту необходимо его &quot;fully qualified&quot; имя, а не локальная его версия.</p>
                    </div>
                </section>
                <section id="display-content">
                    <h3>Отображение контента</h3>
                    <p>Виджеты имеют ряд методов и функций, но основы просты:</p>
                    <ul>
                        <li>настройка виджета</li>
                        <li>формат данных виджета</li>
                        <li>отображение виджета</li>
                    </ul>
                    <p>Виджет <code>HomePage</code> уже имеет метод <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>. Этот метод является частью жизненного цикла обычного виджета и автоматически вызывается после добавления виджета на страницу. Мы можем использовать его для отображения необходимого нам контента.</p>
                    <p>Все виджеты имеют<a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> который представляет раздел страницы, за который они отвечают (как <a href="http://jquery.org" class="external reference">jQuery</a> объект). Содержимое виджета должно быть вставлено туда. По умолчанию <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> является пустым элементом <code>&lt;div&gt;</code>.</p>
                    <p>Элемент <code>&lt;div&gt;</code> обычно невидим для пользователя, если у него нет контента (или нет определенных стилей, задающих его размер) which поэтому при запуске <code>HomePage</code> ничего не отображается на странице.</p>
                    <p>Давайте добавим немного контента в root элемент виджета, используя jQuery:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Это сообщение появится когда вы откроете пункт меню<span class="menuselection">Pet Store
‣ Pet Store ‣ Home Page</span></p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>для обновления javascript кода, который загружен в Odoo Web, вам необходимо обновить страницу. Нет необходимости перезагружать сервер Odoo.</p>
                    </div>
                    <p>Виджет <code>HomePage</code> используется и управляется Odoo Web автоматически. Для того, чтобы узнать как создавать виджеты &quot;с нуля&quot; давайте создадим новый:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Тпеперь мы можем добавить наш <code>GreetingsWidget</code> к <code>HomePage</code> используя метод
                        <code>GreetingsWidget</code>'s <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <ul>
                        <li>сначала <code>HomePage</code> добавляет свое содержимое в корень DOM </li>
                        <li>затем <code>HomePage</code> создает экземпляр <code>GreetingsWidget</code></li>
                        <li>И в конце он сообщает <code>GreetingsWidget</code> куда вставлять себя, делегируя часть своего <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> <code>GreetingsWidget</code>.</li>
                    </ul>
                    <p>Когда вызывается метод <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>, он просит виджет вставить себя в указанную позицию  и отобразить свой контент. Метод<a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> будет вызываться во время вызова <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>.</p>
                    <p>Чтобы увидеть, что происходит под отображаемым интерфейсом, мы будем использовать DOM Explorer браузера. Но сначала давайте немного изменим наши виджеты, чтобы мы могли легче находить, где они находятся,
                        <a href="../reference/javascript.html#openerp.Widget.className"
                            class="internal reference" title="openerp.Widget.className"><code class="js-attr xref js">добавив класс к их корневым элементам:</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Если вы можете найти соответствующий раздел DOM (щелкните правой кнопкой мыши тексте, затем  выберите <span class="guilabel">Исследовать Элемент</span>), и вы должны увидеть нечто похожее на:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello dear Odoo user!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>We are so happy to see you again in this menu!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Который четко показывает два элемента<code>&lt;div&gt;</code> автоматически созданных <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, потому что мы добавили несколько классов в них.</p>
                    <p>Мы также можем увидеть два div элемента с прикрепленными к ним сообщениями, которые мы добавили сами</p>
                    <p>Наконец, обратите внимание, что элемент<code>&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> который представляет экземпляр <code>GreetingsWidget</code> находящийся <em>внутри</em> <code>&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> предоставленного экземпляра <code>HomePage</code></p>
                </section>
                <section id="widget-parents-and-children">
                    <h3>Родительские и дочерние объекты Widget</h3>
                    <p>В предыдущей части мы создали экземпляр виджета, используя этот синтаксис:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>Первым аргументом является <code>this</code>, который в данном случае был экземпляром <code>HomePage</code>. Это говорит виджету созданному другим виджетом, что он является его <em>родителем</em>.</p>
                    <p>Как мы видели, виджеты обычно вставляются в DOM другими виджетами и As we've seen, widgets are usually inserted in the DOM by another widget and
                        <em>внутри</em> корнегового элемента виджета.  Это означает, что большинство виджетов являются &quot;частью&quot; другого виджета, и существуют от его имени. Мы вызываем <em>родительский</em> контейнер, и помещяем в него <em>дочерний</em> виджет.</p>
                    <p>Из-за многочисленных технических и концептуальных причин виджету необходимо знать, кто его родительские и кто его дочерние объекты</p>
                    <dl><dt><code class="js-func xref js">getParent()</code></dt>
                        <dd>
                            <p>может быть использовано для получения родительского объекта виджета:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                            </div>
                        </dd><dt><code class="js-func xref js">getChildren()</code></dt>
                        <dd>
                            <p>может быть использовано для получения дочернего объекта виджета:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p>При переопределении метода <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> виджета <em>очень важно</em> передать родительскому элементу вызов <code>this._super()</code>, иначе это отношение будет установлено неверно:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>В конце концов если виджет не имеет родительского объекта (т.к. это корневой виджет приложения), в качестве родител может быть указан <code>null</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
                    </div>
                </section>
                <section id="destroying-widgets">
                    <h3>Уничтожение виджетов</h3>
                    <p>Если вы можете показать контент вашим пользователям, то вы так же должны имень возможность его удалить. Это достигается с помощью метода <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
                    </div>
                    <p>Когда виджет уничтожается, он сначала вызывает функцию
                        <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a> всем своим дочерним объектам. А уже потом удаляет себя из DOM.
                        Если вы установили постоянные структуры в
                        <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> или
                        <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference"
                            title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> которые должны быть явно очищены (потому что сборщик мусора не будет их обрабатывать), вы можете переопределить
                            <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference"
                                title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>.</p>
                    <div role="alert" class="alert-danger alert">
                        <p class="alert-title">Осторожно</p>
                        <p>при переопределении <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal alert-link reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>, <code>_super()</code>
                            <em>должен всегда</em> вызываться иначе виджет и дочерние элементы не будут очищены правильно, оставляя возможные утечки памяти и &quot;фантомные события&quot;, даже если ошибка не отображается</p>
                    </div>
                </section>
                <section id="the-qweb-template-engine">
                    <h2>Генератор шаблонов QWeb</h2>
                    <p>В предыдущем разделе мы добавляли контент к нашим виджетам, непосредственно манипулируя (и добавляя) их DOM:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>Такой подход позволяет генерировать и отображать любой тип контента, но становится громоздким при генерации значительных объемов DOM (много повторяющихся действий, проблемы с цитированием, ...))</p>
                    <p>Как и во многих других средах, решение Odoo заключается в использовании <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">генератора шаблонов</a>. Генератор шаблонов для Odoo называется QWeb.
                        <a href="../reference/qweb.html#reference-qweb"
                            class="internal reference"><span>QWeb</span></a>.</p>
                    <p>QWeb это язык шаблонов на базе XML, такой же как <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a>                        or <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. Он имеет следующие характеристики:
                    </p>
                    <ul>
                        <li>Он полностью написан на JavaScript и рендерится в браузере</li>
                        <li>каждый файл шаблона (XML файлы) может содержать несколько шаблонов</li>
                        <li>Он имеет специальную поддержку со стороны Odoo Web  <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, хотя он может использоватся и вне Odoo веб клиента (и возможно использовать<a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> не полагаясь на QWeb)</li>
                    </ul>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Обоснованием использования QWeb вместо существующих генераторов шаблонов для javascript является расширяемость уже существующих ( а так же произеденных сторонними разработчиками) шаблонов <a href="../reference/views.html#reference-views" class="internal alert-link reference"><span >представлений</span></a>.</p>
                        <p>Большинство генераторов шаблонов javascript основаны на простом тексте, что исключает упрощенную структурную расширяемость, там где основанный на XML генератор шаблонов может быть расширен такими средствами как XPath или CSS и DSL (или даже XSLT). Гибкость и расширяемость такого рода является основной характеристикой Odoo, и ее утрата считается неприемлемой</p>
                    </div>
                </section>
                <section id="using-qweb">
                    <h3>Использование QWeb</h3>
                    <p>Для начала давайте определим простой QWeb шаблон в почти пустом файле
                        <code>oepetstore/static/src/xml/petstore.xml</code>:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                    </div>
                    <p>Теперь мы можем использовать этот шаблон внутри виджета <code>HomePage</code>. Используя переменную загрузчика <code>QWeb</code> определенную в верхней части страницы, мы можем вызвать шаблон определенный в XML файле:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><code class="js-func xref js">QWeb.render()</code> ищет определенный шаблон преобразовывает в строку и возвращает результат.</p>
                    <p>Однако, поскольку <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> имеет специальную интеграцию для QWeb, шаблон можно установить непосредственно в виджете через его атрибут <a href="../reference/javascript.html#openerp.Widget.template" class="internal reference" title="openerp.Widget.template"><code class="js-attr xref js">шаблона</code></a> :</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Хотя результат выглядит похожим, между этими подходами есть два различия:
                    </p>
                    <ul>
                        <li>во второй версией, шаблон выдается непосредственно перед вызовом
                            <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a></li>
                        <li>в первой версии содержимое шаблона добавляется к корневому элементу виджета, тогда как во второй версии корневой элемент шаблона сразу <em>устанавливается как</em> корневой элемент виджета. Вот почему вспомогательный виджет  &quot;привествия&quot; также получает красный фон</li>
                    </ul>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Шаблоны должны иметь один корневой элемент без-<code>t</code>, особенно если они установлены как <a href="../reference/javascript.html#openerp.Widget.template" class="internal alert-link reference" title="openerp.Widget.template"><code class="js-attr xref js">шаблоны</code> виджета </a>. Если емееся несколько &quot;корневых элементов&quot;, результаты не определены (обычно используется только первый корневой элемент, а остальные будут игнорироваться)</p>
                    </div>
                </section>
                <section id="qweb-context">
                    <h4>QWeb контекст</h4>
                    <p>Шаблонам QWeb могут быть предоставлены данные и они могут содержать базовую логику отображения.</p>
                    <p>Для явных вызовов <code class="js-func xref js">QWeb.render()</code>, данные шаблона передаются как второй параметр:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
                    </div>
                    <p>с измененным шаблоном::</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>будет следующий результат:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Klaus<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>При использовании интеграции <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> не представляется возможным предоставить дополнительные данные шаблону. Шаблон будет иметь единственную контекстную переменную <code>виджетов</code>, ссылающуюся на виджет, отображаемый непосредственно перед вызовом метода <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> (состояние виджета будет по существу состоять в том, что установлено<a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a>):</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Result:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Mordecai<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="template-declaration">
                    <h4>Объявление шаблона</h4>
                    <p>Мы увидели как <em>происходит визуализация</em> шаблона QWeb, теперь давайте посмотри синтаксис самих шаблонов.</p>
                    <p>Шаблон QWeb состоит из обычного XML, смешанного с <em>дериктивами</em> QWeb. Директива QWeb объявляется с атрибутами XML, начинающимися с <code>t-</code>.</p>
                    <p>Самая простая директива это <code>t-name</code>, используемая для объявления новых шаблонов используемых в файле:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                    </div>
                    <p><code>t-name</code> принимает имя определяемого шаблона и объявляет таким образом, что его можно вызвать с помощью <code class="js-func xref js">QWeb.render()</code>. Его можно использовать только на верхнем уровне файла шаблона.</p>
                </section>
                <section id="escaping">

                    <h4>Вывод данных</h4>
                    <p>Директива <code>t-esc</code> может быть использована для вывода текста:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Он принимает вычисляемно выражение Javascript, а затем его результат помещается в HTML-код и вставляется в документ. Поскольку это выражение, то можно указать только имя переменной, как показано выше, или более сложное выражение, например какое либо вычисление:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>или вызов метода:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="outputting-html">
                    <h4>Вывод HTML</h4>
                    <p>Чтобы внедрить HTML-код на отображаемую страницу, используйте <code>t-raw</code>. Подобно <code>t-esc</code> он принимает произвольное Javascript-выражение как параметр, но не выполняет шаг HTML-escape.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-danger alert">
                        <p class="alert-title">Осторожно</p>
                        <p><code>t-raw</code> <em>не должен</em> использоваться для данных, которые могут содержать небезопасный пользовательский контент так как это приводит к уязвимостям <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">межсайтового скриптинга</a>
                        </p>
                    </div>
                </section>
                <section id="conditionals">
                    <h4>Состояния</h4>
                    <p>QWeb может иметь состояния используя блок <code>t-if</code>. Директива принимает произвольное выражение, если выражение не существует (<code>false</code>, <code>null</code>, <code>0</code> или пустая строка) весь блок подавляется, в противном случае он отображается.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>QWeb не имеет &quot;else&quot; структутуры, используйте второй <code>t-if</code> с инвертированным первоначальным условием. Вы можете захотеть сохранить условие в локальной переменной, если это сложное или дорогое выражение.</p>
                    </div>
                </section>
                <section id="iteration">
                    <h4>Перебор значений</h4>
                    <p>Для перебора значений по списку используйте<code>t-foreach</code> и <code>t-as</code>. <code>t-foreach</code> принимает выражение, возвращающее список для итерации по <code>t-as</code> беря имя переменной для привязки к каждому элементу во время итерации.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p><code>t-foreach</code> так же может быть использован с числами и объектами (словарями)
                        </p>
                    </div>
                </section>
                <section id="defining-attributes">
                    <h4>Определение атрибутов</h4>
                    <p>QWeb предоставляет две связанные директивы для определения вычисленных атрибутов:
                        <code class="samp">t-att-<em >name</em></code> и <code class="samp">t-attf-<em >name</em></code>.  В любом случае, <em>name</em> это имя создаваемого атрибута(например <code>t-att-id</code> определяет
                        <code>id</code> атрибута после визуализации).</p>
                    <p><code>t-att-</code>  принимает выражение javascript, результат которого устанавливается как значение атрибута, наиболее полезно, если вычисляется все значение атрибута:
                    </p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p><code>t-attf-</code> принимает <em>строковый формат</em>. Строковый формат это текст с интерполяционными блоками внутриo интерполяционный блок - это javascript-выражение между <code>{{</code> и <code>}}</code>, который будет заменен результатом выражения. Это особенно полезно для атрибутов, которые частично имеют текстовые значения и частично вычисляемые, например класс:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="calling-other-templates">
                    <h4>Вызов других шаблонов</h4>
                    <p>Шаблоны можно разбить на подшаблоны (для простоты, управляемости, многократного использования или во избежание чрезмерной перегрузки разметки).</p>
                    <p>Это реализовано с помощью <code>t-call</code> директивы, которая принимает имя шаблона для визуализации:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>визуализация <code>A</code> а шаблона даст результат:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Суб-шаблоны наследуют контекст при визуализации вызывающего их объекта..</p>
                </section>
                <section id="to-learn-more-about-qweb">
                    <h4>Для более глубокого изучения QWeb</h4>
                    <p>Для подробной справки по QWeb смотрите <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p>
                </section>
                <section id="exercise">
                    <h4>Упражнение</h4>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Использование QWeb в Widget</p>
                        <p>Создайте виджет, конструктор которого имеет два параметра помимо
                            <code>родителя</code>: <code>product_names</code> и <code>color</code>.</p>
                        <ul>
                            <li><code>product_names</code> должен быть массивом строк, каждая из которых - название продукта
                            </li>
                            <li><code>color</code> строка содержащая цвет в CSS цветовом формате (например:
                                <code>#000000</code> для черного).</li>
                        </ul>
                        <p>Виджет должен отображать названия продуктов друг под другом, каждый в отдельном поле с цветом фона и значением
                            <code>color</code> и границы. Вы должны использовать QWeb для визуализации HTML. Все что касается CSS должно находится  в <code>oepetstore/static/src/css/petstore.css</code>.</p>
                        <p>Используйте виджет в <code>HomePage</code> с полдюжиной продуктов.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span><span class="p">(</span>
                <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;graphic card&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">],</span> <span class="s2">&quot;#00FF00&quot;</span><span class="p">);</span>
            <span class="nx">products</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ProductsWidget&quot;</span><span class="p">,</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">products</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">products</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ProductsWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;widget.products&quot;</span> <span class="na">t-as=</span><span class="s">&quot;product&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oe_products_item&quot;</span>
                      <span class="na">t-attf-style=</span><span class="s">&quot;background-color: {{ widget.color }};&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;product&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;br/&gt;</span>
            <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_products_item</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <a href="../_images/qweb.png" class="internal alert-link reference"><img src="../_images/qweb.png" class="img-responsive center-block"></a>
                    </div>
                </section>
                <section id="widget-helpers">
                    <h2>Помощники для Widget</h2></section>
                <section id="widget-s-jquery-selector">
                    <h3>jQuery Selector для <code >Widget</code></h3>
                    <p>Выбор элементов DOM внутри виджетов можно выполнить, вызвав метод find ()
                        <code>find()</code> в корне DOM виджета:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
                    </div>
                    <p>Но поскольку это обычная операция, <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> предоставляет эквивалентный ярлык через метод the
                        <a href="../reference/javascript.html#openerp.Widget._S_" class="internal reference" title="openerp.Widget.$"><code class="js-func xref js">$()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Глобальная функция jQuery <code>$()</code> <em>никогда</em>  не должна использоваться, если она абсолютно не нужна: выбор в корне виджета относится к виджету и локален к нему, но выбор с <code>$()</code> является глобальным для страницы / приложения и может соответствовать частям других виджетов и представлений, поэтому его использование можем привести к случайным или опасным побочным эффектам. Поскольку виджет вообще должен действовать только в разделе DOM, который он имеет, поэтому нет причин для применения механизмов глобального выбора.</p>
                    </div>
                </section>
                <section id="easier-dom-events-binding">
                    <h3>Простое связывание DOM событий</h3>
                    <p>Ранее мы связывали события DOM с помощью обычных обработчиков событий jQuery (например,
                        <code>.click()</code> или <code>.change()</code>) на элементах виджета:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Хотя это метод и работает, у него есть несколько проблем:</p>
                    <ol>
                        <li>он довольно многословный</li>
                        <li>он не поддерживает замену корневого элемента виджета во время выполнения, поскольку привязка выполняется только при запуске <code>start()</code> (во время инициализации виджета)
                        </li>
                        <li>он требует ршения <code>this</code>-связанных проблем</li>
                    </ol>
                    <p>Таким образом, виджеты предоставляют ярлык привязки события DOM через
                        <a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">события</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">События</code></a> - это объект (отображение) события в функцию или метод для вызова, когда событие инициируется:
</p>
                    <ul>
                        <li>ключ - это имя события, которое может быть уточнено с помощью селектора CSS, и в этом случае, только если событие произойдет в выбранном подэлементе, будет выполняться функция или метод: <code>click</code> будет обрабатывать все клики внутри виджета, но
                            <code>click .my_button</code> будет обрабатывать только клики в элементах с классом <code>my_button</code></li>
                        <li>
                            <p>значение - это действие, которое должно выполняться при срабатывании события</p>
                            <p>это может быть либо функция:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
                            </div>
                            <p>или имя метода объекта (см. пример выше).</p>
                            <p>В любом случае <code>this</code> является экземпляром виджета, а обработчику предоставляется единственный параметр <a href="http://api.jquery.com/category/events/event-object/" class="external reference">объект события jQuery</a>                                для события.
                            </p>
                        </li>
                    </ul>
                </section>
                <section id="widget-events-and-properties">
                    <h2>События и свойства виджета</h2></section>
                <section id="events">
                    <h3>События</h3>
                    <p>Виджеты предоставляют систему событий (отдельно от системы событий DOM / jQuery, описанной выше): виджет может сам запускать события, а другие виджеты (или он сам) могут связываться к вышеуказанному виджету и прослушивать эти события:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Этот виджет выступает в роли фасада, преобразуя входные данные пользователя (через события DOM) во внутреннее событие, для которого родительские виджеты могут связывать себя.
                    </p>
                    <p><code class="js-func xref js">trigger()</code> берет имя события для запуска в качестве его первого (обязательного) аргумента, любые дополнительные аргументы рассматриваются как данные события и передаются непосредственно слушателям.</p>
                    <p>Затем мы можем настроить родительское событие, создающее экземпляр нашего общего виджета, и прослушивать событие  <code>user_chose</code> спользуя метод <code class="js-func xref js">on()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><code class="js-func xref js">on()</code> связывает функцию, вызываемую, когда событие, идентифицировано <code>event_name</code>. Аргумент <code>func</code> это функция для вызова <code>object</code> - объект, которым связана эта функция, если это метод. Связанная функция будет вызываться с дополнительными аргументами  <code class="js-func xref js">trigger()</code> Если она есть. Пример:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Запуск событий на другом виджетах, как правило, плохая идея. Главным исключением из этого правила является <code>openerp.web.bus</code> который существует специально для трансляций, в которых любой виджет может интересоваться всем веб-приложением Odoo.
                        </p>
                    </div>
                </section>
                <section id="properties">
                    <h3>Свойства</h3>
                    <p>Свойства очень похожи на обычные атрибуты объектов, поскольку они позволяют хранить данные в экземпляре виджетов, однако у них есть дополнительная функция, при которой они запускают события при установке:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <ul>
                        <li><code class="js-func xref js">set()</code> устанавливает значение свойства и запускает
                            <code class="samp">change:<em >propname</em></code> (где <em>propname</em>  это имя свойства, переданное в качестве первого параметра для <code class="js-func xref js">set()</code>) and <code>change</code></li>
                        <li><code class="js-func xref js">get()</code> получает значение свойства.</li>
                    </ul>
                </section>
                <section id="id3">
                    <h3>Упражнение</h3>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Свойства и события виджета</p>
                        <p>Создайте виджет<code>ColorInputWidget</code> который будет отображать 3 <code>&lt;input type=&quot;text&quot;&gt;</code>. Каждый из этих <code>&lt;input&gt;</code>  предназначен для ввода шестнадцатеричного числа от 00 до FF. Когда какой-либо из этих <code>&lt;input&gt;</code> изменяется пользователем, виджет должен запрашивать содержимое трех
                            <code>&lt;input&gt;</code>, соединять их значения, чтобы иметь полный цветовой код CSS (например: <code>#00FF00</code>) и поместить результат в свойство с именем <code>color</code>. Обратите внимание, что событие jQuery <code>change()</code> которое вы можете привязать к любому элементу HTML <code>&lt;input&gt;</code> и метод <code>val()</code>который может запрашивать текущее значение этого <code>&lt;input&gt;</code> могут быть полезны для вас в этом упражнении.</p>
                            <p>Затем измените виджет <code>HomePage</code> чтобы создать экземпляр <code>ColorInputWidget</code> и отобразите его. Виджет <code>HomePage</code> также должен отображать пустой прямоугольник.Этот прямоугольник должен всегда, в любой момент, иметь тот же цвет фона, что и цвет в свойстве <code>color</code> экземпляра <code>ColorInputWidget</code> .</p>
                        <p>Используйте QWeb для генерации всего HTML.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ColorInputWidget&quot;</span><span class="p">,</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;input_changed&#39;</span>
        <span class="p">},</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input_changed</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">input_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#&quot;</span><span class="p">,</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_red&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_green&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_blue&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color_changed</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">color_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_div&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">));</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ColorInputWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Red: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_red&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Green: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_green&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Blue: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_blue&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_color_div&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_color_div</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="modify-existing-widgets-and-classes">
                    <h2>Изменение существующих виджетов и классов</h2>
                    <p>Система классов веб-фреймворка Odoo позволяет напрямую модифицировать существующие классы с помощью метода <code class="js-func xref js">include()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
                    </div>
                    <p>Эта система похожа на механизм наследования, за исключением того, что она изменит целевой класс прямо на месте вместо того, чтобы создавать новый.</p>
                    <p>В этом случае  <code>this._super()</code> будет вызывать оригинальную реализацию заменяемого / переопределяемого метода. Если у класса уже есть подклассы, все вызовы <code>this._super()</code> в подклассах вызовут новые реализации, определенные в вызове <code class="js-func xref js">include()</code>. Это также будет работать, если некоторые экземпляры класса (или любого из его подклассов) были созданы до вызова <code class="js-func xref js">include()</code>.</p>
                </section>
                <section id="translations">
                    <h2>Система переводов на другие языки</h2>
                    <p>Процесс преобразования текста в код Python и JavaScript очень похож. Вы могли заметить эти строки в начале файла <code>petstore.js</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
                    </div>
                    <p>Эти строки просто используются для импорта функций перевода в текущий модуль JavaScript. Они используются следующим образом:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
                    </div>
                    <p>В Odoo файлы переводов автоматически генерируются путем сканирования исходного кода. Обнаружен весь кусок кода, вызывающий определенную функцию, и их содержимое добавляется в файл перевода, который затем отправляется переводчикам. В Python, это функция <code>_()</code>. В JavaScript это функция <code class="js-func xref js">_t()</code> (и еще <code class="js-func xref js">_lt()</code>).</p>
                    <p>Функция <code>_t()</code> возвращает перевод, определенный для текста, который задан. Если для этого текста не определен перевод, то она вернет исходный текст как есть.</p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Чтобы вводить пользовательские значения в переносимые строки, рекомендуется использовать<a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a> с именованными аргументами <em>после</em> перевода:</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
                        </div>
                        <p>Это делает переводы более удобочитаемыми для переводчиков и дает им большую гибкость для изменения порядка или игнорирования параметров.</p>
                    </div>
                    <p><code class="js-func xref js">_lt()</code> (&quot;ленивый перевод&quot;) похож, но несколько более сложен: вместо перевода его параметра сразу, он возвращает объект, который при преобразовании в строку будет выполнять перевод.</p>
                    <p>Данный механизм используется для определения переводимых терминов до инициализации системы переводов, например, для атрибутов класса (поскольку модули загружаются до того, как язык пользователя настроен и загружены переводы)</p>
                </section>
                <section id="communication-with-the-odoo-server">
                    <h2>Связь с сервером Odoo</h2></section>
                <section id="contacting-models">
                    <h3>Взаимодействие с моделями данных</h3>
                    <p>Большинство операций с Odoo связаны со взаимодействием с <em>моделями данных</em>, реализующими бизнес-логику, и эти модели данных будут (потенциально) взаимодействовать с какой либо системой хранения (обычно <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p>
                    <p>Хотя <a href="http://jquery.org" class="external reference">jQuery</a> и предоставляет функцию <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> для сетевого взаимодейтсвия, для связи с Odoo требуются дополнительные метаданные настройка которых перед каждым вызовом будет многословной и подверженной ошибкам. В результат веб клиент Odoo предоставляет примитивы связи более высокого уровня.</p>
                    <p> Чтобы продемонстрировать это, файл  <code>petstore.py</code> aуже содержит небольшую модель с примером метода:</p>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">:</span> <span class="s">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
                    </div>
                    <p>В этом примере объявлена модель данных с двумя полями, и методом <code>my_method()</code> который возвращает словарь литералов.</p>
                    <p>Вот пример виджета, который вызывает  <code>my_method()</code> и отображает результат:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Класс, используемый для вызова моделей Odoo<a href="../reference/javascript.html#openerp.Model" class="internal reference" title="openerp.Model"><code class="js-class xref js">openerp.Model()</code></a>.Он создается с именем модели Odoo в качестве первого параметра (
                        <code>oepetstore.message_of_the_day</code> в нашем случае).</p>
                    <p><code class="js-func xref js">call()</code> можно использовать для вызова любого (публичного) метода модели Odoo. Он принимает следующие позиционные аргументы:</p>
                    <dl><dt><code >name</code></dt>
                        <dd>Имя вызваемого метода, <code>my_method</code></dd><dt><code >args</code></dt>
                        <dd>
                            <p>массив <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">позиционных аргументов</a> для предоставления метода.Поскольку пример не имеет позиционного аргумента, параметр <code>args</code> не предоставляется.
                            </p>
                            <p>Вот другой пример с позиционными аргументами:</p>
                            <div class="highlight-python">
                                <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                            </div>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                            </div>
                        </dd><dt><code >kwargs</code></dt>
                        <dd>
                            <p>a mapping of <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">keyword arguments</a> to pass. The example provides a single named argument <code>context</code>.</p>
                            <div class="highlight-python">
                                <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                            </div>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p><code class="js-func xref js">call()</code> returns a deferred resolved with the value returned by the model's method as first argument.</p>
                </section>
                <section id="compoundcontext">
                    <h3>CompoundContext</h3>
                    <p>The previous section used a <code>context</code> argument which was not explained in the method call:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
                    </div>
                    <p>The context is like a &quot;magic&quot; argument that the web client will always give to the server when calling a method. The context is a dictionary containing multiple keys. One of the most important key is the language of the user,
                        used by the server to translate all the messages of the application. Another one is the time zone of the user, used to compute correctly dates and times if Odoo is used by people in different countries.</p>
                    <p>The <code>argument</code> is necessary in all methods, otherwise bad things could happen (such as the application not being translated correctly). That's why, when you call a model's method, you should always provide that argument.
                        The solution to achieve that is to use <code class="js-class xref js">openerp.web.CompoundContext()</code>.</p>
                    <p><code class="js-class xref js">CompoundContext()</code> is a class used to pass the user's context (with language, time zone, etc...) to the server as well as adding new keys to the context (some models' methods use arbitrary keys
                        added to the context). It is created by giving to its constructor any number of dictionaries or other <code class="js-class xref js">CompoundContext()</code> instances. It will merge all those contexts before sending them to the
                        server.</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
                    </div>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;lang&#39;</span><span class="p">:</span> <span class="s">&#39;en_US&#39;</span><span class="p">,</span> <span class="s">&#39;new_key&#39;</span><span class="p">:</span> <span class="s">&#39;key_value&#39;</span><span class="p">,</span> <span class="s">&#39;tz&#39;</span><span class="p">:</span> <span class="s">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
                    </div>
                    <p>You can see the dictionary in the argument <code>context</code> contains some keys that are related to the configuration of the current user in Odoo plus the
                        <code>new_key</code> key that was added when instantiating
                        <code class="js-class xref js">CompoundContext()</code>.</p>
                </section>
                <section id="queries">
                    <h3>Queries</h3>
                    <p>While <a href="../reference/javascript.html#openerp.Model.call" class="internal reference" title="openerp.Model.call"><code class="js-func xref js">call()</code></a> is sufficient for any interaction with Odoo models, Odoo Web provides
                        a helper for simpler and clearer querying of models (fetching of records based on various conditions):
                        <a href="../reference/javascript.html#openerp.Model.query" class="internal reference" title="openerp.Model.query"><code class="js-func xref js">query()</code></a> which acts as a shortcut for the common combination of
                        <a href="../reference/orm.html#openerp.models.Model.search"
                            class="internal reference" title="openerp.models.Model.search"><code class="py py-meth xref">search()</code></a> and :
                            <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>. It provides a clearer syntax to search and read models:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>versus:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
                    </div>
                    <ul>
                        <li><code class="js-func xref js">query()</code> takes an optional list of fields as parameter (if no field is provided, all fields of the model are fetched). It returns a
                            <a href="../reference/javascript.html#openerp.web.Query" class="internal reference"
                                title="openerp.web.Query"><code class="js-class xref js">openerp.web.Query()</code></a> which can be further customized before being executed</li>
                        <li><a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> represents the query being built. It is immutable, methods to customize
                            the query actually return a modified copy, so it's possible to use the original and the new version side-by-side. See
                            <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> for its customization options.</li>
                    </ul>
                    <p>When the query is set up as desired, simply call
                        <a href="../reference/javascript.html#openerp.web.Query.all" class="internal reference" title="openerp.web.Query.all"><code class="js-func xref js">all()</code></a> to execute it and return a deferred to its result. The result
                        is the same as
                        <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>'s, an array of dictionaries where each dictionary is a requested
                        record, with each requested field a dictionary key.</p>
                </section>
                <section id="exercises">
                    <h2>Exercises</h2>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Message of the Day</p>
                        <p>Create a <code>MessageOfTheDay</code> widget displaying the last record of the
                            <code>oepetstore.message_of_the_day</code> model. The widget should fetch its record as soon as it is displayed.</p>
                        <p>Display the widget in the Pet Store home page.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MessageOfTheDay&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Pet Toys List</p>
                        <p>Create a <code>PetToysList</code> widget displaying 5 toys (using their name and their images).</p>
                        <p>The pet toys are not stored in a new model, instead they're stored in
                            <code>product.product</code> using a special category <em>Pet Toys</em>. You can see the pre-generated toys and add new ones by going to
                            <span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. You will probably need to explore <code>product.product</code> to create the right domain to select just pet toys.</p>
                        <p>In Odoo, images are generally stored in regular fields encoded as
                            <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML supports displaying images straight from base64 with
                            <code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p>
                        <p>The <code>PetToysList</code> widget should be displayed on the home page on the right of the <code>MessageOfTheDay</code> widget. You will need to make some layout with CSS to achieve this.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_left&#39;</span><span class="p">)),</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_right&#39;</span><span class="p">))</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;MessageOfTheDay&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;oepetstore.message_of_the_day&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
                <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                    <span class="p">});</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_left&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToysList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoyslist&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-att-src=</span><span class="s">&quot;&#39;data:image/jpg;base64,&#39;+item.image&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_petstore_homepage</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_left</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_right</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoyslist</span> <span class="p">{</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoy</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="existing-web-components">
                    <h2>Existing web components</h2></section>
                <section id="the-action-manager">
                    <h3>The Action Manager</h3>
                    <p>In Odoo, many operations start from an <a href="../reference/actions.html#reference-actions" class="internal reference"><span >action</span></a>: opening a menu item (to a view), printing a report, ...</p>
                    <p>Actions are pieces of data describing how a client should react to the activation of a piece of content. Actions can be stored (and read through a model) or they can be generated on-the fly (locally to the client by javascript code,
                        or remotely by a method of a model).</p>
                    <p>In Odoo Web, the component responsible for handling and reacting to these actions is the <em>Action Manager</em>.</p>
                </section>
                <section id="using-the-action-manager">
                    <h4>Using the Action Manager</h4>
                    <p>The action manager can be invoked explicitly from javascript code by creating a dictionary describing <a href="../reference/actions.html#reference-actions" class="internal reference"><span >an action</span></a> of the right type, and
                        calling an action manager instance with it.</p>
                    <p><code class="js-func xref js">do_action()</code> is a shortcut of <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> looking up
                        the &quot;current&quot; action manager and executing the action:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>The most common action <code>type</code> is <code>ir.actions.act_window</code> which provides views to a model (displays a model in various manners), its most common attributes are:</p>
                    <dl><dt><code >res_model</code></dt>
                        <dd>The model to display in views</dd><dt><code >res_id</code> (optional)</dt>
                        <dd>For form views, a preselected record in <code>res_model</code></dd><dt><code >views</code></dt>
                        <dd>Lists the views available through the action. A list of
                            <code>[view_id, view_type]</code>, <code>view_id</code> can either be the database identifier of a view of the right type, or <code>false</code> to use the view by default for the specified type. View types can not be present
                            multiple times. The action will open the first view of the list by default.</dd><dt><code >target</code></dt>
                        <dd>Either <code>current</code> (the default) which replaces the &quot;content&quot; section of the web client by the action, or <code>new</code> to open the action in a dialog box.</dd><dt><code >context</code></dt>
                        <dd>Additional context data to use within the action.</dd>
                    </dl>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Jump to Product</p>
                        <p>Modify the <code>PetToysList</code> component so clicking on a toy replaces the homepage by the toy's form view.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .oe_petstore_pettoy&#39;</span><span class="o">:</span> <span class="s1">&#39;selected_item&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
            <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                <span class="p">});</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">selected_item</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s1">&#39;product.product&#39;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span> <span class="na">t-att-data-id=</span><span class="s">&quot;item.id&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-attf-src=</span><span class="s">&quot;data:image/jpg;base64,{{item.image}}&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="client-actions">
                    <h3>Client Actions</h3>
                    <p>Throughout this guide, we used a simple <code>HomePage</code> widget which the web client automatically starts when we select the right menu item. But how did the Odoo web know to start this widget? Because the widget is registered
                        as a <em>client action</em>.</p>
                    <p>A client action is (as its name implies) an action type defined almost entirely in the client, in javascript for Odoo web. The server simply sends an action tag (an arbitrary name), and optionally adds a few parameters, but beyond
                        that <em>everything</em> is handled by custom client code.</p>
                    <p>Our widget is registered as the handler for the client action through this:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p><code>instance.web.client_actions</code> is a <code class="js-class xref js">Registry()</code> in which the action manager looks up client action handlers when it needs to execute one. The first parameter of <code class="js-class xref js">add()</code>                        is the name (tag) of the client action, and the second parameter is the path to the widget from the Odoo web client root.</p>
                    <p>When a client action must be executed, the action manager looks up its tag in the registry, walks the specified path and displays the widget it finds at the end.</p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Note</p>
                        <p>a client action handler can also be a regular function, in whch case it'll be called and its result (if any) will be interpreted as the next action to execute.</p>
                    </div>
                    <p>On the server side, we had simply defined an <code>ir.actions.client</code> action:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
                    </div>
                    <p>and a menu opening the action:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="architecture-of-the-views">
                    <h3>Architecture of the Views</h3>
                    <p>Much of Odoo web's usefulness (and complexity) resides in views. Each view type is a way of displaying a model in the client.</p>
                </section>
                <section id="the-view-manager">
                    <h4>The View Manager</h4>
                    <p>When an <code>ActionManager</code> instance receive an action of type
                        <code>ir.actions.act_window</code>, it delegates the synchronization and handling of the views themselves to a <em>view manager</em>, which will then set up one or multiple views depending on the original action's requirements:</p>
                    <a href="../_images/viewarchitecture.svg" class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a>
                </section>
                <section id="the-views">
                    <h4>The Views</h4>
                    <p>Most <a href="../reference/views.html#reference-views" class="internal reference"><span >Odoo views</span></a> are implemented through a subclass of <code class="js-class xref js">openerp.web.View()</code> which provides a bit of generic
                        basic structure for handling events and displaying model information.</p>
                    <p>The <em>search view</em> is considered a view type by the main Odoo framework, but handled separately by the web client (as it's a more permanent fixture and can interact with other views, which regular views don't do).</p>
                    <p>A view is responsible for loading its own description XML (using
                        <a href="../reference/orm.html#openerp.models.Model.fields_view_get" class="internal reference" title="openerp.models.Model.fields_view_get"><code class="py xref py-class">fields_view_get</code></a>) and any other data source it
                        needs. To that purpose, views are provided with an optional view identifier set as the <code class="js-attr xref js">view_id</code> attribute.</p>
                    <p>Views are also provided with a <code class="js-class xref js">DataSet()</code> instance which holds most necessary model information (the model name and possibly various record ids).</p>
                    <p>Views may also want to handle search queries by overriding
                        <code class="js-func xref js">do_search()</code>, and updating their
                        <code class="js-class xref js">DataSet()</code> as necessary.</p>
                </section>
                <section id="the-form-view-fields">
                    <h3>The Form View Fields</h3>
                    <p>A common need is the extension of the web form view to add new ways of displaying fields.</p>
                    <p>All built-in fields have a default display implementation, a new form widget may be necessary to correctly interact with a new field type (e.g. a <a href="../glossary.html#term-gis" class="internal reference"><span class="std std-term xref">GIS</span></a>                        field) or to provide new representations and ways to interact with existing field types (e.g. validate
                        <a href="../reference/orm.html#openerp.fields.Char" class="internal reference" title="openerp.fields.Char"><code class="py xref py-class">Char</code></a> fields which should contain email addresses and display them as email links).</p>
                    <p>To explicitly specify which form widget should be used to display a field, simply use the <code>widget</code> attribute in the view's XML description:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Note</p>
                        <ul>
                            <li>the same widget is used in both &quot;view&quot; (read-only) and &quot;edition&quot; modes of a form view, it's not possible to use a widget in one and an other widget in the other</li>
                            <li>and a given field (name) can not be used multiple times in the same form</li>
                            <li>a widget may ignore the current mode of the form view and remain the same in both view and edition</li>
                        </ul>
                    </div>
                    <p>Fields are instantiated by the form view after it has read its XML description and constructed the corresponding HTML representing that description. After that, the form view will communicate with the field objects using some methods.
                        These methods are defined by the <code>FieldInterface</code> interface. Almost all fields inherit the <code>AbstractField</code> abstract class. That class defines some default mechanisms that need to be implemented by most fields.</p>
                    <p>Here are some of the responsibilities of a field class:</p>
                    <ul>
                        <li>The field class must display and allow the user to edit the value of the field.</li>
                        <li>
                            <p>It must correctly implement the 3 field attributes available in all fields of Odoo. The <code>AbstractField</code> class already implements an algorithm that dynamically calculates the value of these attributes (they can change
                                at any moment because their value change according to the value of other fields). Their values are stored in <em>Widget Properties</em> (the widget properties were explained earlier in this guide). It is the responsibility
                                of each field class to check these widget properties and dynamically adapt depending of their values. Here is a description of each of these attributes:
                            </p>
                            <ul>
                                <li><code>required</code>: The field must have a value before saving. If <code>required</code> is <code>true</code> and the field doesn't have a value, the method
                                    <code>is_valid()</code> of the field must return <code>false</code>.</li>
                                <li><code>invisible</code>: When this is <code>true</code>, the field must be invisible. The
                                    <code>AbstractField</code> class already has a basic implementation of this behavior that fits most fields.</li>
                                <li><code>readonly</code>: When <code>true</code>, the field must not be editable by the user. Most fields in Odoo have a completely different behavior depending on the value of <code>readonly</code>. As example, the <code>FieldChar</code>                                    displays an HTML <code>&lt;input&gt;</code> when it is editable and simply displays the text when it is read-only. This also means it has much more code it would need to implement only one behavior, but this is necessary
                                    to ensure a good user experience.
                                </li>
                            </ul>
                        </li>
                        <li>Fields have two methods, <code>set_value()</code> and <code>get_value()</code>, which are called by the form view to give it the value to display and get back the new value entered by the user. These methods must be able to handle
                            the value as given by the Odoo server when a <code>read()</code> is performed on a model and give back a valid value for a <code>write()</code>. Remember that the JavaScript/Python data types used to represent the values given
                            by <code>read()</code> and given to
                            <code>write()</code> is not necessarily the same in Odoo. As example, when you read a many2one, it is always a tuple whose first value is the id of the pointed record and the second one is the name get (ie: <code>(15, &quot;Agrolait&quot;)</code>).
                            But when you write a many2one it must be a single integer, not a tuple anymore. <code>AbstractField</code> has a default implementation of these methods that works well for simple data type and set a widget property named
                            <code>value</code>.</li>
                    </ul>
                    <p>Please note that, to better understand how to implement fields, you are strongly encouraged to look at the definition of the <code>FieldInterface</code> interface and the <code>AbstractField</code> class directly in the code of the
                        Odoo web client.
                    </p>
                </section>
                <section id="creating-a-new-type-of-field">
                    <h4>Creating a New Type of Field</h4>
                    <p>In this part we will explain how to create a new type of field. The example here will be to re-implement the <code>FieldChar</code> class and progressively explain each part.</p>
                </section>
                <section id="simple-read-only-field">
                    <h5>Simple Read-Only Field</h5>
                    <p>Here is a first implementation that will only display text. The user will not be able to modify the content of the field.</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>In this example, we declare a class named <code>FieldChar2</code> inheriting from
                        <code>AbstractField</code>. We also register this class in the registry
                        <code>instance.web.form.widgets</code> under the key <code>char2</code>. That will allow us to use this new field in any form view by specifying <code>widget=&quot;char2&quot;</code> in the
                        <code>&lt;field/&gt;</code> tag in the XML declaration of the view.</p>
                    <p>In this example, we define a single method: <code>render_value()</code>. All it does is display the widget property <code>value</code>. Those are two tools defined by the
                        <code>AbstractField</code> class. As explained before, the form view will call the method <code>set_value()</code> of the field to set the value to display. This method already has a default implementation in <code>AbstractField</code>                        which simply sets the widget property <code>value</code>. <code>AbstractField</code> also watch the
                        <code>change:value</code> event on itself and calls the <code>render_value()</code> when it occurs. So, <code>render_value()</code> is a convenience method to implement in child classes to perform some operation each time the value
                        of the field changes.</p>
                    <p>In the <code>init()</code> method, we also define the default value of the field if none is specified by the form view (here we assume the default value of a
                        <code>char</code> field should be an empty string).</p>
                </section>
                <section id="read-write-field">
                    <h5>Read-Write Field</h5>
                    <p>Read-only fields, which only display content and don't allow the user to modify it can be useful, but most fields in Odoo also allow editing. This makes the field classes more complicated, mostly because fields are supposed to handle
                        both editable and non-editable mode, those modes are often completely different (for design and usability purpose) and the fields must be able to switch between modes at any moment.</p>
                    <p>To know in which mode the current field should be, the <code>AbstractField</code> class sets a widget property named <code>effective_readonly</code>. The field should watch for changes in that widget property and display the correct
                        mode accordingly. Example:
                    </p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>In the <code>start()</code> method (which is called immediately after a widget has been appended to the DOM), we bind on the event <code>change:effective_readonly</code>. That allows us to redisplay the field each time the widget property
                        <code>effective_readonly</code> changes. This event handler will call
                        <code>display_field()</code>, which is also called directly in <code>start()</code>. This
                        <code>display_field()</code> was created specifically for this field, it's not a method defined in <code>AbstractField</code> or any other class. We can use this method to display the content of the field depending on the current
                        mode.</p>
                    <p>From now on the conception of this field is typical, except there is a lot of verifications to know the state of the <code>effective_readonly</code> property:</p>
                    <ul>
                        <li>In the QWeb template used to display the content of the widget, it displays an <code>&lt;input type=&quot;text&quot; /&gt;</code> if we are in read-write mode and nothing in particular in read-only mode.</li>
                        <li>In the <code>display_field()</code> method, we have to bind on the <code>change</code> event of the <code>&lt;input type=&quot;text&quot; /&gt;</code> to know when the user has changed the value. When it happens, we call the <code>internal_set_value()</code>                            method with the new value of the field. This is a convenience method provided by the
                            <code>AbstractField</code> class. That method will set a new value in the <code>value</code> property but will not trigger a call to <code>render_value()</code> (which is not necessary since the <code>&lt;input type=&quot;text&quot; /&gt;</code>                            already contains the correct value).
                        </li>
                        <li>In <code>render_value()</code>, we use a completely different code to display the value of the field depending if we are in read-only or in read-write mode.</li>
                    </ul>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Create a Color Field</p>
                        <p>Create a <code>FieldColor</code> class. The value of this field should be a string containing a color code like those used in CSS (example: <code>#FF0000</code> for red). In read-only mode, this color field should display a little
                            block whose color corresponds to the value of the field. In read-write mode, you should display an <code>&lt;input type=&quot;color&quot; /&gt;</code>. That type of <code>&lt;input /&gt;</code> is an HTML5 component that doesn't
                            work in all browsers but works well in Google Chrome. So it's OK to use as an exercise.</p>
                        <p>You can use that widget in the form view of the <code>message_of_the_day</code> model for its field named <code>color</code>. As a bonus, you can change the
                            <code>MessageOfTheDay</code> widget created in the previous part of this guide to display the message of the day with the background color indicated in the
                            <code>color</code> field.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldColor</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;effective_readonly&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldColor&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_field_color_content&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldColor&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldColor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color_content&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;color&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_field_color_content</span> <span class="p">{</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="the-form-view-custom-widgets">
                    <h3>The Form View Custom Widgets</h3>
                    <p>Form fields are used to edit a single field, and are intrinsically linked to a field. Because this may be limiting, it is also possible to create
                        <em>form widgets</em> which are not so restricted and have less ties to a specific lifecycle.
                    </p>
                    <p>Custom form widgets can be added to a form view through the <code>widget</code> tag:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
                    </div>
                    <p>This type of widget will simply be created by the form view during the creation of the HTML according to the XML definition. They have properties in common with the fields (like the <code>effective_readonly</code> property) but they
                        are not assigned a precise field. And so they don't have methods like
                        <code>get_value()</code> and <code>set_value()</code>. They must inherit from the <code>FormWidget</code> abstract class.</p>
                    <p>Form widgets can interact with form fields by listening for their changes and fetching or altering their values. They can access form fields through their <code class="js-attr xref js">field_manager</code> attribute:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p><code class="js-attr xref js">FormWidget</code> is generally the
                        <code class="js-class xref js">FormView()</code> itself, but features used from it should be limited to those defined by <code class="js-class xref js">FieldManagerMixin()</code>, the most useful being:</p>
                    <ul>
                        <li><code class="js-func xref js">get_field_value(field_name)()</code> which returns the value of a field.</li>
                        <li><code class="js-func xref js">set_values(values)()</code> sets multiple field values, takes a mapping of <code>{field_name: value_to_set}</code></li>
                        <li>An event <code class="samp">field_changed:<em >field_name</em></code> is triggered any time the value of the field called <code>field_name</code> is changed</li>
                    </ul>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Show Coordinates on Google Map</p>
                        <p>Add two fields to <code>product.product</code> storing a latitude and a longitude, then create a new form widget to display the latitude and longitude of a product's origin on a map</p>
                        <p>To display the map, use Google Map's embedding:</p>
                        <div class="highlight-html">
                            <div class="highlight"><pre><span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span> <span class="na">src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/iframe&gt;</span>
</pre></div>
                        </div>
                        <p>where <code>XXX</code> should be replaced by the latitude and <code>YYY</code> by the longitude.
                        </p>
                        <p>Display the two position fields and a map widget using them in a new notebook page of the product's form view.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Exercise</p>
                        <p>Get the Current Coordinate</p>
                        <p>Add a button resetting the product's coordinates to the location of the user, you can get these coordinates using the
                            <a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">javascript geolocation API</a>.</p>
                        <p>Now we would like to display an additional button to automatically set the coordinates to the location of the current user.</p>
                        <p>To get the coordinates of the user, an easy way is to use the geolocation JavaScript API. <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">See the online documentation to know how to use it</a>.</p>
                        <p>Please also note that the user should not be able to click on that button when the form view is in read-only mode. So, this custom widget should handle correctly the <code>effective_readonly</code> property just like any field.
                            One way to do this would be to make the button disappear when <code>effective_readonly</code> is true.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;received_position&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">sup</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">received_position</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">set_values</span><span class="p">({</span>
            <span class="s2">&quot;provider_latitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
            <span class="s2">&quot;provider_longitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;button&gt;</span>Get My Current Coordinate<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                    <div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> as a separate concept from instances. In many languages classes are full-fledged objects and themselves instance (of metaclasses) but there remains
                        two fairly separate hierarchies between classes and instances</div>
                    <div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> as well as papering over cross-browser differences, although this has become less necessary over time</div>
                </section>

            </article>
        </div>

        <div id="mask"></div>
    </main>

    <div class="floating_action_container">
        <a id="floating_action" class="ripple" href="#">
            <i class="mdi-action-explore"></i>
        </a>
        <div id="floating_action_menu">
            <span class="bubble"></span>
            <ul class="list-group content">
                <li class="list-group-item ripple"><a>Cras justo odio</a></li>
                <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
                <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
                <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
                <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
            </ul>
        </div>
    </div>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter42690849 = new Ya.Metrika({
                        id: 42690849,
                        clickmap: true,
                        trackLinks: true,
                        accurateTrackBounce: true,
                        webvisor: true,
                        trackHash: true
                    });
                } catch (e) {}
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function() {
                    n.parentNode.insertBefore(s, n);
                };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else {
                f();
            }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/42690849" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
</body>

</html>
