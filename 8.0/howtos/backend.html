<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Создание модуля &mdash; перевод на русский язык документации odoo 8.0</title>

  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />

  <script type="text/javascript" src="../_static/jquery.js"></script>
  <script type="text/javascript" src="../_static/underscore.js"></script>
  <script type="text/javascript" src="../_static/doctools.js"></script>
  <script type="text/javascript" src="../_static/patchqueue.js"></script>
  <script type="text/javascript" src="../_static/jquery.min.js"></script>
  <script type="text/javascript" src="../_static/bootstrap.js"></script>
  <script type="text/javascript" src="../_static/doc.js"></script>
  <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
  <link rel="top" title="odoo 8.0 documentation" href="./index.html" />
  <link rel="up" title="Tutorials" href="./tutorials.html" />
  <link rel="next" title="Building Interface Extensions" href="web.html" />
  <link rel="prev" title="Building a Website" href="website.html" />
</head>

<body role="document">
  <header class="">
    <figure class="card top">
      <span class="card-img" style="background-image: url('../_static/banners/build_a_module.jpg');"></span>
    </figure>
  </header>
  <nav id="main_navbar" class="navbar ">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-main">
          <span class="sr-only">Навигация</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <nav class="nav navbar-nav navbar-left">
          <li id="main-back">
            <a href="./index.html" class="mdi-navigation-arrow-back"></a>
          </li>
          <li>
            <h1 id="main_title">Создание модуля</h1>
          </li>
        </nav>
      </div>

      <nav class="collapse navbar-collapse navbar-main navbar-right" role="navigation">

        <ul class="navbar-nav navbar-right nav">
          <li class="versions">
            <a class="dropdown-toggle" data-toggle="dropdown">
                8.0 <span class="caret"></span>
              </a>
            <ul class="dropdown-menu" role="menu">

              <li><a href="https://www.odoo.com/documentation/9.0/howtos/backend.html">9.0</a></li>

            </ul>
          </li>
        </ul>

        <ul class="current navbar-nav navbar-right nav">
          <li class="toctree-l1 current dropdown"><a data-toggle="dropdown" href="./tutorials.html" class="dropdown-toggle internal reference">Руководства</a>
            <ul class="current dropdown-menu">
              <li class="toctree-l2"><a href="../howtos/themes.html" class="internal reference">Создание своей темы</a></li>
              <li class="toctree-l2"><a href="../howtos/website.html" class="internal reference">Создание вебсайта</a></li>
              <li class="current toctree-l2"><a href="" class="current internal reference">Создание модуля</a></li>
              <li class="toctree-l2"><a href="../howtos/web.html" class="internal reference">Создание расширений для интерфейса</a></li>
            </ul>
          </li>
          <li class="toctree-l1"><a href="../api_integration.html" class="internal reference">Web Service API</a>
            <ul></ul>
          </li>
          <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../setup.html" class="dropdown-toggle internal reference">Настройка</a>
            <ul class="dropdown-menu">
              <li class="toctree-l2"><a href="../setup/install.html" class="internal reference">Установка Odoo</a></li>
              <li class="toctree-l2"><a href="../setup/deploy.html" class="internal reference">Развертывание Odoo</a></li>
            </ul>
          </li>
          <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../reference.html" class="dropdown-toggle internal reference">Справка</a>
            <ul class="dropdown-menu">
              <li class="toctree-l2"><a href="../reference/orm.html" class="internal reference">ORM API</a></li>
              <li class="toctree-l2"><a href="../reference/data.html" class="internal reference">Файлы с данными</a></li>
              <li class="toctree-l2"><a href="../reference/actions.html" class="internal reference">Действия</a></li>
              <li class="toctree-l2"><a href="../reference/views.html" class="internal reference">Представления</a></li>
              <li class="toctree-l2"><a href="../reference/module.html" class="internal reference">Модули</a></li>
              <li class="toctree-l2"><a href="../reference/cmdline.html" class="internal reference">Интерфейс коммандной строки: odoo.py</a></li>
              <li class="toctree-l2"><a href="../reference/security.html" class="internal reference">Безопасность в Odoo</a></li>
              <li class="toctree-l2"><a href="../reference/testing.html" class="internal reference">Тестирование модулей</a></li>
              <li class="toctree-l2"><a href="../reference/http.html" class="internal reference">Web Controllers</a></li>
              <li class="toctree-l2"><a href="../reference/qweb.html" class="internal reference">QWeb</a></li>
              <li class="toctree-l2"><a href="../reference/javascript.html" class="internal reference">Javascript</a></li>
              <li class="toctree-l2"><a href="../reference/translations.html" class="internal reference">Перевод Модулей</li>
              <li class="toctree-l2"><a href="../reference/reports.html" class="internal reference">Печатные формы(Отчеты) на QWeb</a></li>
              <li class="toctree-l2"><a href="../reference/workflows.html" class="internal reference">Бизнес-процессы</a></li>
              <li class="toctree-l2"><a href="../reference/guidelines.html" class="internal reference">Методические рекомендации по Odoo</a></li>
              <li class="toctree-l2"><a href="../reference/upgrade_api.html" class="internal reference">API для обновления</a></li>
            </ul>
          </li>
          <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="./business.html" class="dropdown-toggle internal reference">Business Mementoes</a>
            <ul class="dropdown-menu">
              <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/accounting.html" class="external reference">Accounting Memento (US GAAP)</a></li>
              <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/double-entry.html" class="external reference">Double-Entry Inventory</a></li>
              <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/valuation.html" class="external reference">Inventory Valuations</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </nav>


  <main class="container ">

    <div class="row">

      <aside>
        <div class="navbar-aside text-center">
          <div class="logo_box">
            <span class="logo"></span> Документация
          </div>
          <ul class="list-group text-left nav">
            <li class="list-group-item"><a href="#start-stop-the-odoo-server" class="ripple internal reference">Запустить/Остановить Odoo сервер</a></li>
            <li class="list-group-item"><a href="#build-an-odoo-module" class="ripple internal reference">Создание Odoo модуля</a>
              <ul>
                <li class="list-group-item"><a href="#composition-of-a-module" class="ripple internal reference">Состав модуля</a></li>
                <li class="list-group-item"><a href="#module-structure" class="ripple internal reference">Структура модуля</a></li>
                <li class="list-group-item"><a href="#object-relational-mapping" class="ripple internal reference">Объектно-реляционное отображение</a></li>
                <li class="list-group-item"><a href="#model-fields" class="ripple internal reference">Поля моделей данных</a>
                  <ul>
                    <li class="list-group-item"><a href="#common-attributes" class="ripple internal reference">Common Attributes</a></li>
                    <li class="list-group-item"><a href="#simple-fields" class="ripple internal reference">Простые поля</a></li>
                    <li class="list-group-item"><a href="#reserved-fields" class="ripple internal reference">Зарезервированные поля</a></li>
                    <li class="list-group-item"><a href="#special-fields" class="ripple internal reference">Специальные поля</a></li>
                  </ul>
                </li>
                <li class="list-group-item"><a href="#data-files" class="ripple internal reference">Data files</a></li>
                <li class="list-group-item"><a href="#actions-and-menus" class="ripple internal reference">Действия и Пункты меню</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#basic-views" class="ripple internal reference">Базовые представления</a>
              <ul>
                <li class="list-group-item"><a href="#generic-view-declaration" class="ripple internal reference">Generic view declaration</a></li>
                <li class="list-group-item"><a href="#tree-views" class="ripple internal reference">Представления вида Tree</a></li>
                <li class="list-group-item"><a href="#form-views" class="ripple internal reference">Представления вида Form</a></li>
                <li class="list-group-item"><a href="#search-views" class="ripple internal reference">Представления вида Search</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#relations-between-models" class="ripple internal reference">Отношения между полями</a>
              <ul>
                <li class="list-group-item"><a href="#relational-fields" class="ripple internal reference">Relational fields</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#inheritance" class="ripple internal reference">Наследование</a>
              <ul>
                <li class="list-group-item"><a href="#model-inheritance" class="ripple internal reference">Наследование моделей данных</a></li>
                <li class="list-group-item"><a href="#view-inheritance" class="ripple internal reference">Наследование представления</a>
                  <ul>
                    <li class="list-group-item"><a href="#domains" class="ripple internal reference">Домены</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#computed-fields-and-default-values" class="ripple internal reference">Расчитваемые поля и значения по умолчанию</a>
              <ul>
                <li class="list-group-item"><a href="#dependencies" class="ripple internal reference">Зависимости</a></li>
                <li class="list-group-item"><a href="#default-values" class="ripple internal reference">Значения по умолчанию</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#onchange" class="ripple internal reference">Onchange</a></li>
            <li class="list-group-item"><a href="#model-constraints" class="ripple internal reference">Ограничения моделей данных</a></li>
            <li class="list-group-item"><a href="#advanced-views" class="ripple internal reference">Расширенные представления</a>
              <ul>
                <li class="list-group-item"><a href="#id3" class="ripple internal reference">Представления вида Tree</a></li>
                <li class="list-group-item"><a href="#calendars" class="ripple internal reference">Представления вида Calendar</a></li>
                <li class="list-group-item"><a href="#id4" class="ripple internal reference">Представления вида Search</a></li>
                <li class="list-group-item"><a href="#gantt" class="ripple internal reference">Представления вида Gantt</a></li>
                <li class="list-group-item"><a href="#graph-views" class="ripple internal reference">Представления вида Graph</a></li>
                <li class="list-group-item"><a href="#kanban" class="ripple internal reference">Представления вида Kanban</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#workflows" class="ripple internal reference">Бизенс-процессы</a></li>
            <li class="list-group-item"><a href="#security" class="ripple internal reference">Безопасность</a>
              <ul>
                <li class="list-group-item"><a href="#group-based-access-control-mechanisms" class="ripple internal reference">Group-based access control mechanisms</a></li>
                <li class="list-group-item"><a href="#access-rights" class="ripple internal reference">Права доступа</a></li>
                <li class="list-group-item"><a href="#record-rules" class="ripple internal reference">Record rules</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#wizards" class="ripple internal reference">Мастера</a>
              <ul>
                <li class="list-group-item"><a href="#launching-wizards" class="ripple internal reference">Запуск мастера</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#internationalization" class="ripple internal reference">Перевод</a></li>
            <li class="list-group-item"><a href="#reporting" class="ripple internal reference">Создание отчетов</a>
              <ul>
                <li class="list-group-item"><a href="#printed-reports" class="ripple internal reference">Печатные формы</a></li>
                <li class="list-group-item"><a href="#dashboards" class="ripple internal reference">Панели вывода данных</a></li>
              </ul>
            </li>
            <li class="list-group-item"><a href="#webservices" class="ripple internal reference">WebServices</a>
              <ul>
                <li class="list-group-item"><a href="#xml-rpc-library" class="ripple internal reference">Библиотека XML-RPC</a></li>
                <li class="list-group-item"><a href="#json-rpc-library" class="ripple internal reference">Библиотека JSON-RPC</a></li>
              </ul>
            </li>
          </ul>

          <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/8.0/doc/howtos/backend.rst" class="gith-link">
              Edit on GitHub
          </a></p>

        </div>
      </aside>

      <article class="doc-body ">


        <section id="building-a-module">
          <div role="alert" class="alert-warning alert">
            <p class="alert-title">Внимание Запуск/Остановка сервера</p>
            <p>Требуется установленный <a href="./setup/install.html#setup-install" class="internal alert-link reference"><span>Odoo сервер</span></a></p>
          </div>
        </section>
        <section id="start-stop-the-odoo-server">
          <h2>Запустить/Остановить Odoo сервер</h2>
          <p>Odoo использует клиент-серверную архитектуру где клиентами являются web браузеры которые работают с Odoo сервером через RPC протокол.</p>
          <p>Бизнес-логика и расширения выполняются, как правило, на стороне сервера, так же поддерживаются клиентские "фишки" (например новое представление данных, такое как интерактивная карта) которые могут быть реализованы на клиенте.</p>
          <p>Для того, чтобы запустить сервер,вызовите команду <a href="./reference/cmdline.html#reference-cmdline" class="internal reference"><span>odoo.py</span></a> в командной строке, добавьте полный путь до файла,
            если необходимо:</p>
          <div class="highlight-python code bash">
            <div class="highlight"><pre><span class="n">odoo</span><span class="o">.</span><span class="n">py</span>
</pre></div>
          </div>
          <p>Сервер можно остановить двойным нажатием <code>Ctrl-C</code> в консоли, или убив соотвествующий процесс в операционной системе.
          </p>
        </section>
        <section id="build-an-odoo-module">
          <h2>Создание модуля в Odoo</h2>
          <p>Расширения как сервера, так и клиента представляют собой<em>модуль</em> который может быть загружен в <em>базу данных</em>.
          </p>
          <p>Odoo модули могут, как добавлять абсолютно новую бизнес-логику, так и расширять существующую: модуль может быть создан для того, чтобы добавить план счетов соотвествующей страны таким образом, чтобы Odoo мог поддерживать именно ваш тип бухгалтерского
            учета. В тоже время, другой модуль добавляет поддержку отображения состояния вашего автобусного парка в режиме реального времени </p>
          <p>Все в Odoo начинается и заканчивается модулем.</p>
        </section>
        <section id="composition-of-a-module">
          <h3>Состав модуля</h3>
          <p>Odoo модуль может содержать следующие элементы:</p>
          <dl><dt>Бизнес объекты</dt>
            <dd>объявленные как Python классы, эти ресурсы автоматически сохраняются в Odoo в соответствии с ее конфигурацией</dd><dt>Данные</dt>
            <dd>XML или CSV файлы объявляют метаданные (представления или бизнес-процессы), данные конфигурации (параметризация модулей), демонстрацию данных и многое другое</dd><dt>Web контроллеры</dt>
            <dd>Обрабатывают запросы от web браузеров</dd><dt>Статические ресурсы</dt>
            <dd>Картинки, CSS или javascript файлы которые используются веб интерфейсом или вебсайтом</dd>
          </dl>
        </section>
        <section id="module-structure">
          <h3>Структура модуля</h3>
          <p>Каждый модуль представляет собой каталог с файлами и находится в <em>Каталоге для модулей</em>. Путь к Каталогам для модулей назначается при помощи команды
            <a href="./reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">--addons-path</code></a>
          </p>
          <div role="alert" class="alert-info aphorism alert">
            <p class="alert-title">Замечание</p>
            <p>большинство параметров командной строки так же могут быть указаны в <a href="./reference/cmdline.html#reference-cmdline-config" class="internal alert-link reference"><span>файле конфигурации</span></a></p>
          </div>
          <p>Содержимое Odoo модуля описывается в его <a href="./reference/module.html#reference-module-manifest" class="internal reference"><span>манифесте</span></a>. Подробное описание манифеста находится  <a href="./reference/module.html#reference-module-manifest"
              class="internal reference"><span>здесь</span></a> .</p>
          <p>Модуль так же является
            <a href="http://docs.python.org/2/tutorial/modules.html#packages" class="external reference">Python пакетом</a> с <code>__init__.py</code> файлом, содержащим инструкции импорта для различных Python файлов в модуле.</p>
          <p>К примеру, если модуль имеет только <code>mymodule.py</code> файл <code>__init__.py</code> might contain:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mymodule</span>
</pre></div>
          </div>
          <p>Odoo предоставляет механизм, который помогает устновить новый модуль, <a href="./reference/cmdline.html#reference-cmdline-server" class="internal reference"><span>odoo.py</span></a> имеет команду <a href="./reference/cmdline.html#reference-cmdline-scaffold"
              class="internal reference"><span>scaffold</span></a> которая может создать пустой модуль:</p>
          <div class="highlight-console">
            <div class="highlight"><pre><span class="gp">$</span> odoo.py scaffold &lt;имя_модуля&gt; &lt;и\куда\его\положить&gt;
</pre></div>
          </div>
          <p>Команда создаст подкаталог для вашего модуля, и автоматически создаст группу стандартных файлов для модуля. Большинство из них содержит закоментированный Python код или XML. Об использование большинства этих файлов будет рассказано в данном руковостве.
            </p>
          <div role="alert" class="alert-exercise alert">
            <p class="alert-title">Упражнение</p>
            <p>Создение модуля</p>
            <p>Используйте коммандную строку для создания модуля Open Academy, и установки его в Odoo.</p>
            <ol>
              <li>Вызовите команду <code>odoo.py scaffold openacademy addons</code>.</li>
              <li>Адаптируйте файл манифеста к вашему модулю.</li>
              <li>Не беспокойтесь о содержании других файлов.</li>
            </ol>
            <div class="pq-patch"><em>openacademy/__openerp__.py</em>
              <div class="pq-section">
                <div class="highlight-python">
                  <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="p">{</span>
</span><span class="hll">    <span class="s">'name'</span><span class="p">:</span> <span class="s">"Open Academy"</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s">'summary'</span><span class="p">:</span> <span class="s">"""Manage trainings"""</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s">'description'</span><span class="p">:</span> <span class="s">"""</span>
</span><span class="hll"><span class="s">        Open Academy module for managing trainings:</span>
</span><span class="hll"><span class="s">            - training courses</span>
</span><span class="hll"><span class="s">            - training sessions</span>
</span><span class="hll"><span class="s">            - attendees registration</span>
</span><span class="hll"><span class="s">    """</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="s">'author'</span><span class="p">:</span> <span class="s">"Your Company"</span><span class="p">,</span>
</span><span class="hll">    <span class="s">'website'</span><span class="p">:</span> <span class="s">"http://www.yourcompany.com"</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="c"># Categories can be used to filter modules in modules listing</span>
</span><span class="hll">    <span class="c"># Check https://github.com/odoo/odoo/blob/master/openerp/addons/base/module/module_data.xml</span>
</span><span class="hll">    <span class="c"># for the full list</span>
</span><span class="hll">    <span class="s">'category'</span><span class="p">:</span> <span class="s">'Test'</span><span class="p">,</span>
</span><span class="hll">    <span class="s">'version'</span><span class="p">:</span> <span class="s">'0.1'</span><span class="p">,</span>
</span><span class="hll">
</span><span class="hll">    <span class="c"># any module necessary for this one to work correctly</span>
</span><span class="hll">    <span class="s">'depends'</span><span class="p">:</span> <span class="p">[</span><span class="s">'base'</span><span class="p">],</span>
</span><span class="hll">
</span><span class="hll">    <span class="c"># always loaded</span>
</span><span class="hll">    <span class="s">'data'</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="c"># 'security/ir.model.access.csv',</span>
</span><span class="hll">        <span class="s">'templates.xml'</span><span class="p">,</span>
</span><span class="hll">    <span class="p">],</span>
</span><span class="hll">    <span class="c"># only loaded in demonstration mode</span>
</span><span class="hll">    <span class="s">'demo'</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">        <span class="s">'demo.xml'</span><span class="p">,</span>
</span><span class="hll">    <span class="p">],</span>
</span><span class="hll"><span class="p">}</span>
</span></pre></div>
                </div>
              </div><em>openacademy/__init__.py</em>
              <div class="pq-section">
                <div class="highlight-python">
                  <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
</span></pre></div>
                </div>
              </div><em>openacademy/controllers.py</em>
              <div class="pq-section">
                <div class="highlight-python">
                  <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">http</span>
</span><span class="hll">
</span><span class="hll"><span class="c"># class Openacademy(http.Controller):</span>
</span><span class="hll"><span class="c">#     @http.route('/openacademy/openacademy/', auth='public')</span>
</span><span class="hll"><span class="c">#     def index(self, **kw):</span>
</span><span class="hll"><span class="c">#         return "Hello, world"</span>
</span><span class="hll">
</span><span class="hll"><span class="c">#     @http.route('/openacademy/openacademy/objects/', auth='public')</span>
</span><span class="hll"><span class="c">#     def list(self, **kw):</span>
</span><span class="hll"><span class="c">#         return http.request.render('openacademy.listing', {</span>
</span><span class="hll"><span class="c">#             'root': '/openacademy/openacademy',</span>
</span><span class="hll"><span class="c">#             'objects': http.request.env['openacademy.openacademy'].search([]),</span>
</span><span class="hll"><span class="c">#         })</span>
</span><span class="hll">
</span><span class="hll"><span class="c">#     @http.route('/openacademy/openacademy/objects/&lt;model("openacademy.openacademy"):obj&gt;/', auth='public')</span>
</span><span class="hll"><span class="c">#     def object(self, obj, **kw):</span>
</span><span class="hll"><span class="c">#         return http.request.render('openacademy.object', {</span>
</span><span class="hll"><span class="c">#             'object': obj</span>
</span><span class="hll"><span class="c">#         })</span>
</span></pre></div>
                </div>
              </div><em>openacademy/demo.xml</em>
              <div class="pq-section">
                <div class="highlight-xml">
                  <div class="highlight"><pre><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id="object0" model="openacademy.openacademy"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name="name"&gt;Object 0&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id="object1" model="openacademy.openacademy"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name="name"&gt;Object 1&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id="object2" model="openacademy.openacademy"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name="name"&gt;Object 2&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id="object3" model="openacademy.openacademy"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name="name"&gt;Object 3&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;record id="object4" model="openacademy.openacademy"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;field name="name"&gt;Object 4&lt;/field&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/record&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--  --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
                </div>
              </div><em>openacademy/models.py</em>
              <div class="pq-section">
                <div class="highlight-python">
                  <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
</span><span class="hll">
</span><span class="hll"><span class="c"># class openacademy(models.Model):</span>
</span><span class="hll"><span class="c">#     _name = 'openacademy.openacademy'</span>
</span><span class="hll">
</span><span class="hll"><span class="c">#     name = fields.Char()</span>
</span></pre></div>
                </div>
              </div><em>openacademy/security/ir.model.access.csv</em>
              <div class="pq-section">
                <div class="highlight-guess">
                  <div class="highlight"><pre><span class="hll">id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
</span><span class="hll">access_openacademy_openacademy,openacademy.openacademy,model_openacademy_openacademy,,1,0,0,0
</span></pre></div>
                </div>
              </div><em>openacademy/templates.xml</em>
              <div class="pq-section">
                <div class="highlight-xml+django">
                  <div class="highlight"><pre><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;template id="listing"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;ul&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;li t-foreach="objects" t-as="object"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;a t-attf-href="</span><span class="cp">{{</span> <span class="nv">root</span> <span class="cp">}}</span><span class="c">/objects/</span><span class="cp">{{</span> <span class="nv">object.id</span> <span class="cp">}}</span><span class="c">"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--         &lt;t t-esc="object.display_name"/&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;/a&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;/li&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/ul&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;/template&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;template id="object"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;h1&gt;&lt;t t-esc="object.display_name"/&gt;&lt;/h1&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;dl&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;t t-foreach="object._fields" t-as="field"&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;dt&gt;&lt;t t-esc="field"/&gt;&lt;/dt&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--       &lt;dd&gt;&lt;t t-esc="object[field]"/&gt;&lt;/dd&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--     &lt;/t&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--   &lt;/dl&gt; --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- &lt;/template&gt; --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section id="object-relational-mapping">
          <h3>Объектно-реляционное отображение</h3>
          <p>Ключевой компонент Odoo это <abbr title="Object-Relational Mapping">ORM</abbr> слой. Этот слой избавляет от необходимости писать самому <abbr title="Structured Query Language">SQL запросы</abbr> руками и предоставляет гибкие и безопасные сервисы
            <a
              href="#rawsql" class="footnote-ref" id="id1">2</a>.</p>
          <p>Бизнес объекты объявляются как Python классы расширяя
            <a href="./reference/orm.html#openerp.models.Model" class="internal reference" title="openerp.models.Model"><code class="py xref py-class">Модель данных</code></a> которая интегрирует их в automated persistence
            system.</p>
          <p> Модели данных могут быть сконфигурированы настройкой некоторого колиества атрибутов в их описании. Наиболее важный атрибут это
            <a href="./reference/orm.html#openerp.models.Model._name" class="internal reference" title="openerp.models.Model._name"><code class="py xref py-attr">_name</code></a> Он необходим и определяет название
            модели данных в системе Odoo. Вот пример минимального описания модели данных:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span>
<span class="k">class</span> <span class="nc">MinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'test.model'</span>
</pre></div>
          </div>
        </section>
        <section id="model-fields">
          <h3>Поля модели данных</h3>
          <p>Поля используются для того чтобы определить что именно может хранить модель данных и где она может это хранить. Поля определяются как атрибут в классе модели данных:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'test.model2'</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
          </div>
        </section>
        <section id="common-attributes">
          <h4>Базовые атрибуты</h4>
          <p>Так же как и модель данных, ее поля могут быть настроены путем передачи значений атрибутов в качестве параметров:
          </p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
          </div>
          <p>Некоторые атрибуты доступны для всех полей, вот наиболее распространенные из них:</p>
          <dl><dt><code class="py xref py-attr">string</code> (<code>unicode</code>, по умолчанию: имя_поля)</dt>
            <dd>Надпись для поля в UI (пользовательский интерфейс).</dd><dt><code class="py xref py-attr">required</code> (<code>bool</code>, по умолчанию: <code>False</code>)</dt>
            <dd>Если <code>True</code>, поле не может быть пустым оно должно иметь значение по умолчанию или всегд быть заполнено при создании записи.</dd><dt><code class="py xref py-attr">help</code> (<code>unicode</code>, по умолчанию: <code>''</code>)</dt>
            <dd>Портянка, показывает всплывающее поле с описанием объекта для пользователей в UI.</dd><dt><code class="py xref py-attr">index</code> (<code>bool</code>, по умолчанию: <code>False</code>)</dt>
            <dd>Просит у Odoo создать <a href="http://use-the-index-luke.com/sql/preface" class="external reference">индекс базы данных</a> для колонки</dd>
          </dl>
        </section>
        <section id="simple-fields">
          <h4>Простые поля</h4>
          <p>Есть два наиболее распространенных вида полей: "простые" поля которые являются атомарными (atomic) значениями и храняться непосредственно в таблице и "реляционные" поля, связывающие записи (одной и той же модели данных или разных моделей).</p>
          <p>Пример простого поля <a href="./reference/orm.html#openerp.fields.Boolean" class="internal reference" title="openerp.fields.Boolean"><code class="py xref py-class">Boolean</code></a>,
            <a href="./reference/orm.html#openerp.fields.Date" class="internal reference" title="openerp.fields.Date"><code class="py xref py-class">Date</code></a>, <a href="./reference/orm.html#openerp.fields.Char"
              class="internal reference" title="openerp.fields.Char"><code class="py xref py-class">Char</code></a>.</p>
        </section>
        <section id="reserved-fields">
          <h4>Зарезервированные поля</h4>
          <p>Odoo создает несколько полей, которые есть во всех моделях данных<a href="#autofields" class="footnote-ref" id="id2">1</a>. Эти поля управляются системой и их не нужно прописывать, но их можно прочитать если существует такая необходимость:</p>
          <dl><dt><code class="py xref py-attr">id</code> (<code class="py xref py-class">Id</code>)</dt>
            <dd>уникальные идентификатор записи в этой модели данных</dd><dt><code class="py xref py-attr">create_date</code> (<a href="./reference/orm.html#openerp.fields.Datetime" class="internal reference" title="openerp.fields.Datetime"><code class="py xref py-class">Datetime</code></a>)</dt>
            <dd>дата создания записи</dd><dt><code class="py xref py-attr">create_uid</code> (<a href="./reference/orm.html#openerp.fields.Many2one" class="internal reference" title="openerp.fields.Many2one"><code class="py xref py-class">Many2one</code></a>)</dt>
            <dd>пользователь, который создал запись</dd><dt><code class="py xref py-attr">write_date</code> (<a href="./reference/orm.html#openerp.fields.Datetime" class="internal reference" title="openerp.fields.Datetime"><code class="py xref py-class">Datetime</code></a>)</dt>
            <dd>дата последней модификации записи</dd><dt><code class="py xref py-attr">write_uid</code> (<a href="./reference/orm.html#openerp.fields.Many2one" class="internal reference" title="openerp.fields.Many2one"><code class="py xref py-class">Many2one</code></a>)</dt>
            <dd>пользователь, который модифицировал запись</dd>
          </dl>
        </section>
        <section id="special-fields">
          <h4>Специальные поля</h4>
          <p>По умолчанию Odoo так же требует поля <code>name</code> для всех моделей данных. Для различного отображения и поведения при задейстовавании механизма поиска. Поле, используемое для этих целей может быть отменено <a href="./reference/orm.html#openerp.models.Model._rec_name"
              class="internal reference" title="openerp.models.Model._rec_name"><code class="py xref py-attr">_rec_name</code></a>.</p>
          <div role="alert" class="alert-exercise alert">
            <p class="alert-title">Упражнение</p>
            <p>Определить модель данных</p>
            <p>Определите новую модель данных в модуле <em>Course</em> in the <em>openacademy</em>. Курс имеет небольшое описание. Курсы должны иметь названия.</p>
            <p>Отредактируйте файл <code>openacademy/models.py</code> для того, чтобы включить <em>Course</em> класс.</p>
            <div class="pq-patch"><em>openacademy/models.py</em>
              <div class="pq-section">
                <div class="highlight-python">
                  <div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="hll"><span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.course'</span>
</span>
<span class="hll">    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Название"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>
</span></pre></div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section id="data-files">
          <h3>Файлы данных</h3>
          <p>Odoo систем со сверхточным механизмом управления данными. Несмотря на то что ее поведение управляется при помощи кода
            <a href="http://python.org/" class="external reference">Python</a>, часть значений модуля находится в виде данных и поподает туда при загрузке.(Although behavior is customized using Python code part of a module's value is in the data it sets
            up when loaded).</p>
          <div role="alert" class="alert-info aphorism alert">
            <p class="alert-title">Замечание</p>
            <p>существуют модули которые существуют только для добавления данных в Odoo</p>
          </div>
          <p>Данные модуля описываются через <a href="./reference/data.html#reference-data" class="internal reference"><span>data files</span></a>, XML файлы с
            <code>&lt;record&gt;</code> элементами. Каждый <code>&lt;record&gt;</code> элемент создает или модифицирует записи в базе данных.</p>
          <div class="highlight-xml">
            <div class="highlight"><pre><span class="nt">&lt;openerp&gt;</span>
    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"{model name}"</span> <span class="na">id=</span><span class="s">"{record identifier}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"{a field name}"</span><span class="nt">&gt;</span>{значение}<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;openerp&gt;</span>
</pre></div>
          </div>
          <ul>
            <li><code>model</code> имя модели данных Odoo записи</li>
            <li><code>id</code> это <a href="./glossary.html#term-external-identifier" class="internal reference"><span class="std std-term xref">внешний идентификатор</span></a>, который позволяет видеть к какой записи
              эти данные относятся (без необходимости знать их идентификаторы в базе данных)</li>
            <li><code>&lt;field&gt;</code> элементы имеют параметр <code>name</code>, который является именем поля в модели данных (например <code>description</code>). Тело элемента и есть значение поля.</li>
          </ul>
          <p>Файлы данных должны быть описаны в файле манифеста, для того, чтобы они были загружены их нужно записать в <code>'data'</code> список (загрузка данных происходит всегда) или в <code>'demo'</code> список(загрузка данных происходит только в режиме "Загрузка демо-данных").</p>
          <div
            role="alert" class="alert-exercise alert">
            <p class="alert-title">Упражнение</p>
            <p>Описать демонстрационные данные</p>
            <p>Создать демонстрационные данные для заполнения модели данных <em>Курсы</em> некоторым количеством Курсов.</p>
            <p>Отредактируйте файл <code>openacademy/demo.xml</code> и вставьте необходимые данные.</p>
            <div class="pq-patch"><em>openacademy/demo.xml</em>
              <div class="pq-section">
                <div class="highlight-xml">
                  <div class="highlight"><pre><span class="nt">&lt;openerp&gt;</span>
    <span class="nt">&lt;data&gt;</span>
<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"openacademy.course"</span> <span class="na">id=</span><span class="s">"course0"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Курс 0<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">&gt;</span>Описание 0-го курса
</span><span class="hll">
</span><span class="hll">может иметь несколько строк
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"openacademy.course"</span> <span class="na">id=</span><span class="s">"course1"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Курс 1<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="c">&lt;!-- no description for this one --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"openacademy.course"</span> <span class="na">id=</span><span class="s">"course2"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Курс 2<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">&gt;</span>Описание Курса 2<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
                </div>
              </div>
            </div>
    </div>
    </section>
    <section id="actions-and-menus">
      <h3>Действия и пукты Меню</h3>
      <p>Действия и пункты Меню это регулярные записи в базе дынных, обычно описываютс через файлы данных. Действия могут быть инициированы тремя путями:</p>
      <ol>
        <li>нажатием на пункт меню (который связан с конкретным действием)</li>
        <li>нажатием на кнопки в формах представлений данных (если они связаны с конкретным действием)</li>
        <li>как контекстное действие над объектом</li>
      </ol>
      <p>Поскольку пункты меню могут иметь сложную структуру для их описания есть параметр <code>&lt;menuitem&gt;</code>. Это наиболее простой способ создать описание меню в <code>ir.ui.menu</code> и подключить его к соотвествующему действию.</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"action_list_ideas"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Идеи<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"menu_ideas"</span> <span class="na">parent=</span><span class="s">"menu_root"</span> <span class="na">name=</span><span class="s">"Идеи"</span> <span class="na">sequence=</span><span class="s">"10"</span>
          <span class="na">action=</span><span class="s">"action_list_ideas"</span><span class="nt">/&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-danger aphorism alert">
        <p class="alert-title">Осторожно</p>
        <p>Дейстиве должно быть задекларировано до соответствующему ему пункту меню в XML файле.</p>
        <p>Файлы данных выполняются последовательно, <code>id</code> действия должен присутствовать в базе данных до того момента, как пункт меню будет создан.</p>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Создайте новый пункт меню</p>
        <p>Создайте новый пункт меню для доступа к курсам и сессиям в заголовке OpenAcademy . Пользователь должен иметь возможность</p>
        <ul>
          <li>увидеть список всех курсов
            <li>создать/модифицировать курс</li>
        </ul>
        <ol>
          <li>Создать <code>openacademy/views/openacademy.xml</code> с действием и срабатыванием действия при нажатии на пункт меню</li>
          <li>Добавьте соответствующеи записи в списке <code>data</code> в файле <code>openacademy/__openerp__.py</code></li>
        </ol>
        <div class="pq-patch"><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="s">'data'</span><span class="p">:</span> <span class="p">[</span>
        <span class="c"># 'security/ir.model.access.csv',</span>
        <span class="s">'templates.xml'</span><span class="p">,</span>
<span class="hll">        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c"># будет загружено только в режиме "Загрузка демо-данных"</span>
    <span class="s">'demo'</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
</span><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- действие окна --&gt;</span>
</span><span class="hll">        <span class="c">&lt;!--</span>
</span><span class="hll"><span class="c">            следющий тэг определяет дейстиве для "действия окна",</span>
</span><span class="hll"><span class="c">            которое открывает представление данных либо их набор</span>
</span><span class="hll"><span class="c">        --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"course_list_action"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Курсы<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"help"</span> <span class="na">type=</span><span class="s">"html"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"oe_view_nocontent_create"</span><span class="nt">&gt;</span>Создайте первый курс
</span><span class="hll">                <span class="nt">&lt;/p&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- верхнее меню: нет родителей --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"main_openacademy_menu"</span> <span class="na">name=</span><span class="s">"Open Academy"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- Левое меню первого уровня необходимо перед</span>
</span><span class="hll"><span class="c">             использованием действия= attribute --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"openacademy_menu"</span> <span class="na">name=</span><span class="s">"Open Academy"</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">"main_openacademy_menu"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- следующий пункт меню появится *после*</span>
</span><span class="hll"><span class="c">             своего родителя openacademy_menu и *после* его</span>
</span><span class="hll"><span class="c">             действия course_list_action --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"courses_menu"</span> <span class="na">name=</span><span class="s">"Courses"</span> <span class="na">parent=</span><span class="s">"openacademy_menu"</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">"course_list_action"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- Полное расположение id:</span>
</span><span class="hll"><span class="c">             действие="openacademy.course_list_action"</span>
</span><span class="hll"><span class="c">             Не требуется когда расположено в том же самом модуле --&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="basic-views">
      <h2>Базовые представления данных (далее представления)</h2>
      <p>Представления определяют каким образом записи или модель данных будут отображены. Каждый тип представлений являет собой некий заранее оформленый вшнешний вид для данных, которые находятся в базе данных Odoo (например в виде списка записей или календаря, и т.д. …). Представления могут быть запрошены через вызов их типа (например
        <em>список контрагентов</em>) или напрямую через их идентификатор. Для общих запросов будет использовано представление с правильным типом и низким приоритетом (таким образом, представление с наименьшим приоритетом каждого типа, будет являться
        им поумолчанию.</p>
      <p><a href="./reference/views.html#reference-views-inheritance" class="internal reference"><span>Наследование представлений</span></a> allows altering views declared elsewhere (adding or removing content).</p>
    </section>
    <section id="generic-view-declaration">
      <h3>Стандартное использование представления</h3>
      <p>Представление создается как запись модели данных <code>ir.ui.view</code>. Тип преставления назначется корневым элементом поля <code>arch</code> :</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"view_id"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"priority"</span> <span class="na">eval=</span><span class="s">"16"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- содержимое преставления: &lt;form&gt;, &lt;tree&gt;, &lt;graph&gt;, ... --&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-danger aphorism alert">
        <p class="alert-title">Осторожно</p>
        <p>Содержимое представления это XML.</p>
        <p>Поле <code>arch</code> задекларировано как <code>type="xml"</code> для того, чтобы его правильно распознал парсер.</p>
      </div>
    </section>
    <section id="tree-views">
      <h3>Преставления в виде Tree</h3>
      <p>Преставления в виде Tree, так же называются преставлениями в виде списков, отражают записи в табличной форме.</p>
      <p>Их корневой элемент <code>&lt;tree&gt;</code>. Самая простоая форма преставления в виде tree это список всех полей таблицы, которые мы хотим показать на экране (каждое поле это колонка):</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Список идей"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
      </div>
    </section>
    <section id="form-views">
      <h3>Преставления в виде Form</h3>
      <p>Преставления в виде Form используются для создания и модификации единичных записей.</p>
      <p>Корневым элементом является <code>&lt;form&gt;</code>. Который состоит из высокоуровненвых элементов(группы, поля для записей) и интерактивных элементов (кнопки и поля):</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Форма для заполнения"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">"4"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">col=</span><span class="s">"2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">"General stuff"</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">col=</span><span class="s">"2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">"Даты"</span> <span class="na">colspan=</span><span class="s">"2"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"active"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"invent_date"</span> <span class="na">readonly=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;notebook</span> <span class="na">colspan=</span><span class="s">"4"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Описание"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">nolabel=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/page&gt;</span>
        <span class="nt">&lt;/notebook&gt;</span>

        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"состояние"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Настройте преставление в виде Form используя XML</p>
        <p>Создайте ваше собственное преставление в виде Form для объекта Курс.Что нужно показать: имя и описание курса.</p>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;openerp&gt;</span>
    <span class="nt">&lt;data&gt;</span>
<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"course_form_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>course.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Course Form"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;sheet&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/sheet&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- действие окна  --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            следющий тэг определяет дейстиве для "действия окна",</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Поля для записей</p>
        <p>В преставлении в виде Form для объекта Курс расположите поле для описания под закладкой, таким образом, что в дальнейшем можно будет добавить еще закладки с дополнительной информацией. </p>
        <p>Внесите следующие изменения в преставление в виде Form для объекта Курс:</p>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
<span class="hll">                        <span class="nt">&lt;notebook&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Описание"</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Записи"</span><span class="nt">&gt;</span>
</span><span class="hll">                                Это пример поля для записей
</span><span class="hll">                            <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/notebook&gt;</span>
</span>                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <p>В представлениях в виде Form возможно испльзование HTML тэгов для создания более гибких форм:</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Форма для заполнения"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">"Приянть"</span> <span class="na">type=</span><span class="s">"object"</span> <span class="na">name=</span><span class="s">"action_confirm"</span>
                <span class="na">states=</span><span class="s">"draft"</span> <span class="na">class=</span><span class="s">"oe_highlight"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">"Пометить как завершенное"</span> <span class="na">type=</span><span class="s">"object"</span> <span class="na">name=</span><span class="s">"action_done"</span>
                <span class="na">states=</span><span class="s">"confirmed"</span> <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">"Пометить как черновик"</span> <span class="na">type=</span><span class="s">"object"</span> <span class="na">name=</span><span class="s">"action_draft"</span>
                <span class="na">states=</span><span class="s">"confirmed,done"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"state"</span> <span class="na">widget=</span><span class="s">"statusbar"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;sheet&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"oe_title"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"name"</span> <span class="na">class=</span><span class="s">"oe_edit_only"</span> <span class="na">string=</span><span class="s">"Название"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;h1&gt;&lt;field</span> <span class="na">name=</span><span class="s">"name"</span> <span class="nt">/&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">"Основное"</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">"2"</span> <span class="na">col=</span><span class="s">"2"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">placeholder=</span><span class="s">"Описание идеи..."</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>
    <span class="nt">&lt;/sheet&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
      </div>
    </section>
    <section id="search-views">
      <h3>Преставления в виде Search</h3>
      <p>Преставления в виде Search настраивают поля search для связи с преставлением в виде списка (а так же другими совокупными представлениями). Их корневой элемент <code>&lt;search&gt;</code> и он состоит из полей определяющих какие поля могут участвовать в поиске:</p>
      <div
        class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;search&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
        </div>
        <p>Если не существует преставлений в виде Search, Odoo создает одно, которое позволяет поиск по полю <code>name</code>.</p>
        <div role="alert" class="alert-exercise alert">
          <p class="alert-title">Упражнение</p>
          <p>Поиск курсов</p>
          <p>Позволить поиск по курсам, основанный их названии или их описании.</p>
          <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
            <div class="pq-section">
              <div class="highlight-xml">
                <div class="highlight"><pre>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"course_search_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>course.search<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;search&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/search&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- действие окна  --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            следющий тэг определяет дейстиве для "действия окна",</span>
</pre></div>
              </div>
            </div>
          </div>
        </div>
    </section>
    <section id="relations-between-models">
      <h2>Отношения между моделями данных</h2>
      <p>Запись из одной модели данных может быть связана с записью в другой модели данных. Например запись коммерческого предложения связана с записью клиента, которая содержит данные о клиента; и она (запись клиента) так же связана с записями коммерческого
        предложения.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Создайте модель данных для занятий</p>
        <p>Для модуля Open Academy,мы рассматриваем модель данных <em>sessions</em>: Занятия это возникновение преподаваемого курса в заданное время для заданной аудитории.</p>
        <p>Создайте модель данных для <em>sessions</em>. Занятия имеют наименование, дату начала, длительность и количество посадочных мест. Добавьте действие и пункт меню для отображения на их на экране. Сделайте новую модель данных видимой через пукнты
          меню.</p>
        <ol>
          <li>Создайте Python класс <em>Session</em> in <code>openacademy/models.py</code>.</li>
          <li>Добавьте доступ к объекту sessions в <code>openacademy/view/openacademy.xml</code>.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Title"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>
<span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.session'</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
</span><span class="hll">    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s">"Duration in days"</span><span class="p">)</span>
</span><span class="hll">    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>        <span class="c">&lt;!-- Full id location:</span>
<span class="c">             action="openacademy.course_list_action"</span>
<span class="c">             It is not required when it is the same module --&gt;</span>
<span class="hll">
</span><span class="hll">        <span class="c">&lt;!-- преставление в виде form для занятий --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"session_form_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>session.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Session Form"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;sheet&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"start_date"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"duration"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"seats"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/sheet&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"session_list_action"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"session_menu"</span> <span class="na">name=</span><span class="s">"Sessions"</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">"openacademy_menu"</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">"session_list_action"</span><span class="nt">/&gt;</span>
</span>    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
        <div role="alert" class="alert-info alert">
          <p class="alert-title">Замечание</p>
          <p><code>digits=(6, 2)</code> определяет точность с плавающей запятой: 6 это общее количество цифр,а 2 количество цифр после запятой обратите внимание, что количество цифр после запятой максимум 4</p>
        </div>
      </div>
    </section>
    <section id="relational-fields">
      <h3>Реляционные поля</h3>
      <p>Реляционные поля связывают записи как внутри самой модели данных(иерархические), так и между записями в разных моделях данных.</p>
      <p>Типы реляционных полей:</p>
      <dl><dt><a href="./reference/orm.html#openerp.fields.Many2one" class="internal reference" title="openerp.fields.Many2one"><code class="py xref py-class">Many2one(other_model, ondelete='set null')</code></a></dt>
        <dd>
          <p>Простая ссылка на другой объект:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_id</span><span class="o">.</span><span class="n">name</span>
</pre></div>
          </div>
          <div role="alert" class="alert-info alert">
            <p class="alert-title">Смотрите также</p>
            <p><a href="http://www.postgresql.org/docs/9.3/static/tutorial-fk.html" class="external reference alert-link">внешние ключи</a></p>
          </div>
        </dd><dt><a href="./reference/orm.html#openerp.fields.One2many" class="internal reference" title="openerp.fields.One2many"><code class="py xref py-class">One2many(other_model, related_field)</code></a></dt>
        <dd>
          <p>Виртуальная связь обратная <a href="./reference/orm.html#openerp.fields.Many2one" class="internal reference" title="openerp.fields.Many2one"><code class="py xref py-class">Many2one</code></a>. Это <a href="./reference/orm.html#openerp.fields.One2many"
              class="internal reference" title="openerp.fields.One2many"><code class="py xref py-class">One2many</code></a> ведет себя как контейнер записей и предоставляет доступ (возможно пустой) к набору записей:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
          </div>
          <div role="alert" class="alert-danger alert">
            <p class="alert-title">Опасность</p>
            <p>В связи с тем, что <a href="./reference/orm.html#openerp.fields.One2many" class="internal alert-link reference" title="openerp.fields.One2many"><code class="py xref py-class">One2many</code></a> является
              виртуальной связью, просто
              <em>обязано</em> быть поле <a href="./reference/orm.html#openerp.fields.Many2one" class="internal alert-link reference" title="openerp.fields.Many2one"><code class="py xref py-class">Many2one</code></a>              в
              <code class="samp"><em>other_model</em></code>, и его имя <em>обязано</em> быть <code class="samp"><em>related_field</em></code></p>
          </div>
        </dd><dt><a href="./reference/orm.html#openerp.fields.Many2many" class="internal reference" title="openerp.fields.Many2many"><code class="py xref py-class">Many2many(other_model)</code></a></dt>
        <dd>
          <p>Двунаправленная множественная связь, любая запись на одной стороне может быть связаза с любым количеством записей на другой стороне. Ведет себя как контейнер записей, предоставляя доступ, возможно пустой, к набору записей:</p>
          <div class="highlight-python">
            <div class="highlight"><pre><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
          </div>
        </dd>
      </dl>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Many2one связи</p>
        <p>Используйте many2one, для изменения <em>Course</em> и <em>Session</em> моделий данных, для того чтобы отразить их связи с остальными моделями данных:</p>
        <ul>
          <li>Курс имеет <em>отвественного</em> пользователя; значение этого поля является записью во встроенной модели данных <code>res.users</code>.</li>
          <li>Занятия имеют <em>инструктора</em>; значение этого поля является записью во встроенной модели данных <code>res.partner</code>.</li>
          <li>Занятие относится к <em>course</em>; значение этого поля является записью в<code>openacademy.course</code> и является необходимым.</li>
          <li>Адаптируйте преставления</li>
        </ul>
        <ol>
          <li>Добавьте соотвествующие <code>Many2one</code> поля в модель данных, и </li>
          <li>и добавьте их в представления.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Title"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>

<span class="hll">    <span class="n">responsible_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.users'</span><span class="p">,</span>
</span><span class="hll">        <span class="n">ondelete</span><span class="o">=</span><span class="s">'set null'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Responsible"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="hll">
</span>
<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.session'</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s">"Duration in days"</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">)</span>
</span><span class="hll">    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span>
</span><span class="hll">        <span class="n">ondelete</span><span class="o">=</span><span class="s">'cascade'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Course"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
<span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"responsible_id"</span><span class="nt">/&gt;</span>
</span>                        <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;notebook&gt;</span>
                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Description"</span><span class="nt">&gt;</span>
</pre></div>
            </div>
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- перегружает автоматически сформированное представление в виде tree для курсов --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"course_tree_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>course.tree<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Course Tree"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"responsible_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="c">&lt;!-- действие окна --&gt;</span>
        <span class="c">&lt;!--</span>
<span class="c">            следющий тэг определяет дейстиве для "действия окна",</span>
</pre></div>
            </div>
            <div class="highlight-xml">
              <div class="highlight"><pre>                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Session Form"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
<span class="hll">                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"General"</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"instructor_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"Schedule"</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"start_date"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"duration"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"seats"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/group&gt;</span>
</span>                        <span class="nt">&lt;/group&gt;</span>
                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- Представление в виде tree/list для занятий --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"session_tree_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>session.tree<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Session Tree"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"session_list_action"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Обратные связи one2many </p>
        <p>Используя поле one2many, модифицируйте модеь данных для отображения связей между курсами и занятиями.</p>
        <ol>
          <li>Измените <code>Course</code> Python класс, и </li>
          <li> добавьте поле для представления в виде Form для курса.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">responsible_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.users'</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s">'set null'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Responsible"</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
</span><span class="hll">        <span class="s">'openacademy.session'</span><span class="p">,</span> <span class="s">'course_id'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Sessions"</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Description"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/page&gt;</span>
<span class="hll">                            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Sessions"</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"session_ids"</span><span class="nt">&gt;</span>
</span><span class="hll">                                    <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Registered sessions"</span><span class="nt">&gt;</span>
</span><span class="hll">                                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"instructor_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                                    <span class="nt">&lt;/tree&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;/field&gt;</span>
</span>                            <span class="nt">&lt;/page&gt;</span>
                        <span class="nt">&lt;/notebook&gt;</span>
                    <span class="nt">&lt;/sheet&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Множественные many2many связи</p>
        <p>Используя поле many2many, модифицируйте <em>Session</em> модель данных, чтобы связать каждое занятие с <em>присутствующими</em>. Присутствующие будут представлены в виде записей контрагентов, поэтому мы свяжем их со встроенной моделью данных <code>res.partner</code>.
          Внесите соответствющие изменения в представления.</p>
        <ol>
          <li>Модифицируйте <code>Session</code> Python класс, и</li>
          <li>добавьте поле представления в виде Form.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">)</span>
    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s">'cascade'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Course"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="hll">    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"seats"</span><span class="nt">/&gt;</span>
                            <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
<span class="hll">                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
</span>                    <span class="nt">&lt;/sheet&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="inheritance">
      <h2>Наследование</h2></section>
    <section id="model-inheritance">
      <h3>Наследование моделей данных</h3>
      <p>Odoo предлагает механизм <em>наследования</em> в двух вариантах для расширения существующей модели данных путем создания дополнительного модуля.</p>
      <p>Первый механизм наследования позволяет модулю модифицировать поведение модели данных принадлежащей в другом модуле:</p>
      <ul>
        <li>добавлять поля к модели данных,</li>
        <li>перегружать определения полей в модели данных,</li>
        <li>добавлять ограничения в модеь данных,</li>
        <li>добавлять методы в модель данных,</li>
        <li>перегружать существующие методы в модели данных.</li>
      </ul>
      <p>Второй механизм наследования (делегирования) позволяет связывать записи модели данных с записями родительской модели данных, и предоставляет прозрачный доступ к полям родительской записи.</p><img src="src/inheritance_methods.png" class="img-responsive center-block">
      <div
        role="alert" class="alert-info alert">
        <p class="alert-title">Смотрите также</p>
        <ul>
          <li><a href="./reference/orm.html#openerp.models.Model._inherit" class="internal alert-link reference" title="openerp.models.Model._inherit"><code class="py xref py-attr">_inherit</code></a></li>
          <li><a href="./reference/orm.html#openerp.models.Model._inherits" class="internal alert-link reference" title="openerp.models.Model._inherits"><code class="py xref py-attr">_inherits</code></a></li>
        </ul>
        </div>
    </section>
    <section id="view-inheritance">
      <h3>Наследование представления</h3>
      <p> Помимо модификации существующих представлений (путем перезаписи), Odoo позволяет наследовать представления где дочерние "расширения" представлений могут быть быть закреплены над корневыми представлениями и могут добавлять или удалять содержимое
        своего родителя.</p>
      <p>Расширение представления соотносится со своим родителем, используя поле <code>inherit_id</code>, и во отличии от одиночного представления его поле <code>arch</code> состоит из любого количества элементов <code>xpath</code> elements предоставляя
        возможность выбора альтернативного наполнения родительского представления:</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="c">&lt;!-- улучшеный список категорий идей --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">"idea_category_list2"</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>id.category.list2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>idea.category<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inherit_id"</span> <span class="na">ref=</span><span class="s">"id_category_list"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- поиск описания и добавления нужного поля</span>
<span class="c">             idea_ids after it --&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">"//field[@name='description']"</span> <span class="na">position=</span><span class="s">"after"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"idea_ids"</span> <span class="na">string=</span><span class="s">"Number of ideas"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
      </div>
      <dl><dt><code>expr</code></dt>
        <dd>Выражение <a href="http://w3.org/TR/xpath" class="external reference">XPath</a> выбирает определенный элемент родительского представления.</dd><dt><code>position</code></dt>
        <dd>
          <p>Команда для применения к конкретному элементу:</p>
          <dl><dt><code>inside</code></dt>
            <dd>присоединяет тело внутри контейнера <code>xpath</code> после выбранного элемента</dd><dt><code>replace</code></dt>
            <dd>заменяет выбранный элемент<code>xpath</code> контейнером </dd><dt><code>before</code></dt>
            <dd>вставляет контейнер <code>xpath</code> как неотъемлемую часть в начале выбранного элемента</dd><dt><code>after</code></dt>
            <dd>вставляет контейнер <code>xpaths</code>как неотъемлемую часть в конце выбранного элемента</dd>
            <dt><code>attributes</code></dt>
            <dd> предоставляет альтенативные атрибуты выбранного элемента используя специальную команду
              <code>attribute</code> внутри контейнера <code>xpath</code></dd>
          </dl>
        </dd>
      </dl>
      <div role="alert" class="alert-info alert">
        <p class="alert-title">Совет</p>
        <p>При выборе одиночного элемента атрибут <code>position</code> может быть напрямую назначен искомому элементу. В примере указаны два наследования с одинаковым результатам.</p>
        <div class="highlight-xml">
          <div class="highlight"><pre><span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">"//field[@name='description']"</span> <span class="na">position=</span><span class="s">"after"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"idea_ids"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/xpath&gt;</span>

<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">position=</span><span class="s">"after"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"idea_ids"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Измените существующий проект</p>
        <ul>
          <li>Используя модель наследования, измените существующую модель <em>Partner</em> , добавив туда поле boolean
            <code>instructor</code> , и поле many2many, соответствующее внутрисессионному отношению Partner</li>
          <li>Используя просмотр наследуемое представление, отобразите эти поля в отображении partner.</li>
        </ul>
        <div role="alert" class="alert-info alert">
          <p class="alert-title">Заметка</p>
          <p>Этот способ дает возможность разработчику просмотреть представление, найти его внешний ID и место для нового поля.</p>
        </div>
        <ol>
          <li>Создайте файл <code>openacademy/partner.py</code> , импортируйте его в
            <code>__init__.py</code></li>
          <li>Создайте файл <code>openacademy/views/partner.xml</code> и добавьте его в
            <code>__openerp__.py</code></li>
        </ol>
        <div class="pq-patch"><em>openacademy/__init__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">partner</span>
</span></pre></div>
            </div>
          </div><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="c"># 'security/ir.model.access.csv',</span>
        <span class="s">'templates.xml'</span><span class="p">,</span>
        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
<span class="hll">        <span class="s">'views/partner.xml'</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c"># загружается только в демо-режиме</span>
    <span class="s">'demo'</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
            </div>
          </div><em>openacademy/partner.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">fields</span><span class="p">,</span> <span class="n">models</span>
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Partner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_inherit</span> <span class="o">=</span> <span class="s">'res.partner'</span>
</span><span class="hll">
</span><span class="hll">    <span class="c"># Добавляем новую строку в res.partner model, по умолчанию partners есть</span>
</span><span class="hll">    <span class="c"># instructors</span>
</span><span class="hll">    <span class="n">instructor</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s">"Instructor"</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s">"Attended Sessions"</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div><em>openacademy/views/partner.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
</span><span class="hll"> <span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="c">&lt;!-- Добавляем instructors к существующему представлению --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"partner_instructor_form_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>partner.instructor<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inherit_id"</span> <span class="na">ref=</span><span class="s">"base.view_partner_form"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;notebook</span> <span class="na">position=</span><span class="s">"inside"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">"Sessions"</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"instructor"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"session_ids"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/page&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/notebook&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"contact_list_action"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Contacts<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"configuration_menu"</span> <span class="na">name=</span><span class="s">"Configuration"</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">"main_openacademy_menu"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"contact_menu"</span> <span class="na">name=</span><span class="s">"Contacts"</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">"configuration_menu"</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">"contact_list_action"</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="domains">
      <h4>Домены</h4>
      <p>В Odoo, <a href="./reference/orm.html#reference-orm-domains" class="internal reference"><span>Domain</span></a> это значения в которых закодировано состояние записей. Домен это список критериев используемых для
        выбора из подмножества записей в модели данных.Каждый криетерий представляет собой треугольник где вершинами являются имя поля, оператор и значение.</p>
      <p>К примеру, при использовании в модели данных <em>Продукт</em> домен выбирает все <em>услуги</em> цена которых выше <em>1000</em> за одну позицию:</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="p">[(</span><span class="s">'product_type'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="s">'service'</span><span class="p">),</span> <span class="p">(</span><span class="s">'unit_price'</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
      </div>
      <p>По умолчанию, критерии тесно взаимосвязаны с безусловным AND. Логические операторы
        <code>&amp;</code> (AND), <code>|</code> (OR) и <code>!</code> (NOT) могут быть использованы для явного комбинирования критериев, и помещаются в префиксной позиции (оператор чаще всего ставится перед аргументами). К примеру, для выбора продуктов,
        представляющих собой сервисы, <em>OR</em> имеющие цену за элемент <em>NOT</em> между 1000 и 2000":</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="p">[</span><span class="s">'|'</span><span class="p">,</span>
    <span class="p">(</span><span class="s">'product_type'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="s">'service'</span><span class="p">),</span>
    <span class="s">'!'</span><span class="p">,</span> <span class="s">'&amp;'</span><span class="p">,</span>
        <span class="p">(</span><span class="s">'unit_price'</span><span class="p">,</span> <span class="s">'&gt;='</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'unit_price'</span><span class="p">,</span> <span class="s">'&lt;'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)]</span>
</pre></div>
      </div>
      <p><code>Параметр</code> domain может быть добавлен к зависимым полям, с целью отделения действительных записей для работы, в процессе выбора записей в базе для работы с клиентским интерфейсом.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Домены в зависимых полях</p>
        <p>При выборе instructor для <em>Сессии</em>, должны быть видны только instructors (partners с <code>instructor</code> со значением <code>True</code>).</p>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s">"Duration in days"</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>

<span class="hll">    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">,</span>
</span><span class="hll">        <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s">'instructor'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="bp">True</span><span class="p">)])</span>
</span>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s">'cascade'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Course"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
</pre></div>
            </div>
          </div>
        </div>
        <div role="alert" class="alert-info alert">
          <p class="alert-title">Заметка</p>
          <p>Домен, объявленный как список, исполняется на стороне сервера, и не может обращаться к динамическим значениям справа э а домен, объявленный, как строка, исполняется со стороны клиента, разрешая имена полей справа. </p>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Более сложные домены</p>
        <p>Создайте новые партнерские категории <em>Teacher / Level 1</em> и <em>Teacher / Level 2</em>. Instructor в данной сессии может быть как instructor, так и teacher (of any level).</p>
        <ol>
          <li>Измените модель домена <em>Session</em></li>
          <li>Измените <code>openacademy/view/partner.xml</code> , таким образом, чтобы иметь доступ к <em>Partner категориям</em>:</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>

    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">,</span>
<span class="hll">        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s">'|'</span><span class="p">,</span> <span class="p">(</span><span class="s">'instructor'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
</span><span class="hll">                     <span class="p">(</span><span class="s">'category_id.name'</span><span class="p">,</span> <span class="s">'ilike'</span><span class="p">,</span> <span class="s">"Teacher"</span><span class="p">)])</span>
</span>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s">'cascade'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Course"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
</pre></div>
            </div>
          </div><em>openacademy/views/partner.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"contact_menu"</span> <span class="na">name=</span><span class="s">"Contacts"</span>
                  <span class="na">parent=</span><span class="s">"configuration_menu"</span>
                  <span class="na">action=</span><span class="s">"contact_list_action"</span><span class="nt">/&gt;</span>
<span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"contact_cat_list_action"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Contact Tags<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>res.partner.category<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"contact_cat_menu"</span> <span class="na">name=</span><span class="s">"Contact Tags"</span>
</span><span class="hll">                  <span class="na">parent=</span><span class="s">"configuration_menu"</span>
</span><span class="hll">                  <span class="na">action=</span><span class="s">"contact_cat_list_action"</span><span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"res.partner.category"</span> <span class="na">id=</span><span class="s">"teacher1"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Teacher / Level 1<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"res.partner.category"</span> <span class="na">id=</span><span class="s">"teacher2"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Teacher / Level 2<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="computed-fields-and-default-values">
      <h2>Вычисляемые поля и переменные по умолчанию</h2>
      <p>Помимо того, что поля могут сохраняться и быть в прямом доступе непосредственно из базы данных, они также могут <em>вычислены</em>. В этом случае, значения полей не извлекаются непосредственно из базы, а вычисляются `на лету` путем вызова метода
        модели.</p>
      <p> Для создания вычисляемого поля вам нужно создать поле, установив атрибут
        <code class="py xref py-attr">compute</code> в его метод. Метод вычисления должен просто устанавливать значение поля в вычисляемое в любой записи <code>self</code>.</p>
      <div role="alert" class="alert-danger aphorism alert">
        <p class="alert-title">Осторожно</p>
        <p><code>self</code> собирательный операнд</p>
        <p>Объект <code>self</code> является <em>записываемым</em>, т.е., упорядоченным собранием записей. Он поддерживается стандартными операциями Python с коллекциями, такими, как
          <code>len(self)</code> и <code>iter(self)</code>, а также дополнительными операндами <code>recs1 +
recs2</code>.</p>
        <p>Во взаимодействии с <code>self</code> можно собрать записи одна за одной, где каждая представляет собой комплект размера 1. Вы можете объединять, разделять записи при помощи точки <code>record.name</code>.</p>
      </div>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'test.computed'</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s">'_compute_name'</span><span class="p">)</span>

    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
      </div>
    </section>
    <section id="dependencies">
      <h3>Зависимости</h3>
      <p>Количество ввычисляемых полей обычно зависит от значений других полей в вычисляемой записи. ORM подразумевает спецификацию зависимостей разработчиком при помощи "декоратора" <a href="./reference/orm.html#openerp.api.depends"
          class="internal reference" title="openerp.api.depends"><code class="py xref py-func">depends()</code></a>. Данные зависимости используются ORM для управления обратным вычислением значения поля, при условии, что какое-либо зависимое поле было изменено:</p>
      <div
        class="highlight-python">
        <div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'test.computed'</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s">'_compute_name'</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'value'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"Record with value </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</pre></div>
        </div>
        <div role="alert" class="alert-exercise alert">
          <p class="alert-title">Упражнение</p>
          <p>Вычисляемые поля</p>
          <ul>
            <li>Добавьте процент занятых мест к модели <em>Session</em></li>
            <li>Отобразите поле в виде дерева и в виде таблицы</li>
            <li>Отобразите поле в виде прогресс-бара</li>
          </ul>
          <ol>
            <li>Добавте вычисляемое поле к <em>Session</em></li>
            <li>Покажите значение поля в представлении <em>Session</em>: </li>
          </ol>
          <div class="pq-patch"><em>openacademy/models.py</em>
            <div class="pq-section">
              <div class="highlight-python">
                <div class="highlight"><pre>    <span class="n">course_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span>
        <span class="n">ondelete</span><span class="o">=</span><span class="s">'cascade'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Course"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Taken seats"</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s">'_taken_seats'</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span><span class="p">:</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span class="hll">            <span class="k">else</span><span class="p">:</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
</span></pre></div>
              </div>
            </div><em>openacademy/views/openacademy.xml</em>
            <div class="pq-section">
              <div class="highlight-xml">
                <div class="highlight"><pre>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"start_date"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"duration"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"seats"</span><span class="nt">/&gt;</span>
<span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"taken_seats"</span> <span class="na">widget=</span><span class="s">"progressbar"</span><span class="nt">/&gt;</span>
</span>                            <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;/group&gt;</span>
                        <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
</pre></div>
              </div>
              <div class="highlight-xml">
                <div class="highlight"><pre>                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Session Tree"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"taken_seats"</span> <span class="na">widget=</span><span class="s">"progressbar"</span><span class="nt">/&gt;</span>
</span>                <span class="nt">&lt;/tree&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
              </div>
            </div>
          </div>
        </div>
    </section>
    <section id="default-values">
      <h3>Значения по умолчанию</h3>
      <p>Значение по умолчанию может быть передано любому из полей. Для этого, в определении поля добавьте опцию
        <code>default=X</code> где <code>X</code> либо значение переменной Python (boolean, целое число или число с плавающей точкой, или строковая переменная), либо значение функции, принимаемое из записи таблицы: </p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">"Unknown"</span><span class="p">)</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.users'</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
      </div>
      <div role="alert" class="alert-info alert">
        <p class="alert-title">Заметка</p>
        <p>Объект <code>self.env</code> редоставляет возможность получить значениея параметров и прочих атрибутов поля: /p>
          <ul>
            <li><code>self.env.cr</code> или <code>self._cr</code> в базе <em>cursor</em> предоставляет возможность получения значения параметров и прочих атрибутов поля: </li>
            <li><code>self.env.uid</code> или <code>self._uid</code> представаляет собой ID текущего пользователя базы</li>
            <li><code>self.env.user</code> запись текущего пользователя
              <</li>
                <li><code>self.env.context</code> или <code>self._context</code> контекстная директория</li>
                <li><code>self.env.ref(xml_id)</code> возвращает ID записи в соответствии с XML ID</li>
                <li><code>self.env[model_name]</code> возвращает окружение данной модели</li>
          </ul>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Активный объект – Значения по умолчанию</p>
        <ul>
          <li>Установите start_date по умолчанию на текущую дату (see
            <a href="./reference/orm.html#openerp.fields.Date" class="internal alert-link reference" title="openerp.fields.Date"><code class="py xref py-class">Date</code></a>).</li>
          <li>Добавьте поле <code>active</code> к классу Session, установив значение sessions активным по умолчанию.</li>
        </ul>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.session'</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="hll">    <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
</span>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s">"Duration in days"</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>
<span class="hll">    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span>
    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s">'|'</span><span class="p">,</span> <span class="p">(</span><span class="s">'instructor'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"instructor_id"</span><span class="nt">/&gt;</span>
<span class="hll">                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"active"</span><span class="nt">/&gt;</span>
</span>                            <span class="nt">&lt;/group&gt;</span>
                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"Schedule"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"start_date"</span><span class="nt">/&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
        <div role="alert" class="alert-info alert">
          <p class="alert-title">Заметка</p>
          <p>В Odoo имеется встроенный механизм правил, определяющий правила создания полей при помощи установки атрибута поля <code>active</code> в <code>False</code>.</p>
        </div>
      </div>
    </section>
    <section id="onchange">
      <h2>Onchange</h2>
      <p>Механизм предоставляет возможность обновления формы со стороны клиента без сохранения значений в базе данных непосредственно.</p>
      <p>Например, модель имеет три поля <code>amount</code>, <code>unit_price</code> и
        <code>price</code>, и вы хотите изменять поле price, в зависимости от изменения значений прочих связанных полей. Для того, чтобы получить нужный результат, вам нужно будет обозначить метод, где <code>self</code> представлен в виде формы, и обозначить
        его при помощи <a href="./reference/orm.html#openerp.api.onchange" class="internal reference" title="openerp.api.onchange"><code class="py xref py-func">onchange()</code></a> , чтобы обозначить управляющий
        элемент. Любое изменение в
        <code>self</code> будет отображено в форме.</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="c">&lt;!-- content of form view --&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"amount"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"unit_price"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"price"</span> <span class="na">readonly=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
</pre></div>
      </div>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="c"># onchange handler</span>
<span class="nd">@api.onchange</span><span class="p">(</span><span class="s">'amount'</span><span class="p">,</span> <span class="s">'unit_price'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># set auto-changing field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
    <span class="c"># Can optionally return a warning and domains</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">'warning'</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">'title'</span><span class="p">:</span> <span class="s">"Something bad happened"</span><span class="p">,</span>
            <span class="s">'message'</span><span class="p">:</span> <span class="s">"It was very bad indeed"</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
      </div>
      <p>Поведение вычисляемых полей, обозначенных тегом <code>onchange</code> может быть предугадано путем отслеживания изменений в форме: <em>Session</em> измените количество мест или присутствующих, и <code>taken_seats</code> прогрессбар обновится автоматически.</p>
      <div
        role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Внимание</p>
        <p>Для отображениия внешнего предупреждения об ошибке, проделайте следующее.</p>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
<span class="hll">
</span><span class="hll">    <span class="nd">@api.onchange</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_verify_valid_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="p">{</span>
</span><span class="hll">                <span class="s">'warning'</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">                    <span class="s">'title'</span><span class="p">:</span> <span class="s">"Incorrect 'seats' value"</span><span class="p">,</span>
</span><span class="hll">                    <span class="s">'message'</span><span class="p">:</span> <span class="s">"The number of available seats may not be negative"</span><span class="p">,</span>
</span><span class="hll">                <span class="p">},</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
</span><span class="hll">            <span class="k">return</span> <span class="p">{</span>
</span><span class="hll">                <span class="s">'warning'</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">                    <span class="s">'title'</span><span class="p">:</span> <span class="s">"Too many attendees"</span><span class="p">,</span>
</span><span class="hll">                    <span class="s">'message'</span><span class="p">:</span> <span class="s">"Increase seats or remove excess attendees"</span><span class="p">,</span>
</span><span class="hll">                <span class="p">},</span>
</span><span class="hll">            <span class="p">}</span>
</span></pre></div>
            </div>
          </div>
        </div>
        </div>
    </section>
    <section id="model-constraints">
      <h2>Конструкции моделей данных</h2>
      <p>В Odoo существует два способа установки автоматически генерируемых ограничений:
        <a href="./reference/orm.html#openerp.api.constrains" class="internal reference" title="openerp.api.constrains"><code class="py xref py-func">ограничения Python</code></a> and
        <a href="./reference/orm.html#openerp.models.Model._sql_constraints" class="internal reference" title="openerp.models.Model._sql_constraints"><code class="py xref py-attr">SQL constraints</code></a>.</p>
      <p>Ограничение Python определяется, как метод с атрибутами constraints() и возвращает ошибку, пока обозначенные условия не будут удовлетворять условиям поиска.
        <a href="./reference/orm.html#openerp.api.constrains" class="internal reference" title="openerp.api.constrains"><code class="py xref py-func">constrains()</code></a> В таком случае, атрибут определяет, какие
        поля будут вовлечены в ограничение, чтобы обеспечить их автоматическое изменение при модификации хотя бы одного из них. Метод подразумевает выдачу ошибки при отсутствии хотя бы одного из условий поиска:</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>

<span class="nd">@api.constrains</span><span class="p">(</span><span class="s">'age'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">"Your record is too old: </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="c"># all records passed the test, don't return anything</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Добавьте ограничения Python</p>
        <p>Добавьте ограничение, проверяющее условие: instructor отсутствует в поле attendees своей собственной сессии session.</p>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span>
</span>
<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.course'</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>                    <span class="s">'message'</span><span class="p">:</span> <span class="s">"Увеличить количество seats или удалить лишних attendees"</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
<span class="hll">
</span><span class="hll">    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s">'instructor_id'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">:</span>
</span><span class="hll">                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="s">"A session's instructor can't be an attendee"</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
      <p>SQL ограничения определяются через атрибут модели <a href="./reference/orm.html#openerp.models.Model._sql_constraints" class="internal reference" title="openerp.models.Model._sql_constraints"><code class="py xref py-attr">_sql_constraints</code></a>.
        Последнее соотносится с вершиной треугольника значений <code>(name, sql_definition, message)</code>, где <code>name</code> является постоянной величиной ограничения SQL, а <code>sql_definition</code> представляет собой <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html"
          class="external reference">table_constraint</a> выражение, при условии, что <code>message</code> - код ошибки.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Добавьте ограничения SQL</p>
        <p>При помощи <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html" class="external reference alert-link">документации PostgreSQL</a> , добавьте следующие ограничения:</p>
        <ol>
          <li>Обязательно проверьте, что описание course и описание course title оотличаются</li>
          <li>Сделайте имя Course УНИКАЛЬНЫМ</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s">'openacademy.session'</span><span class="p">,</span> <span class="s">'course_id'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Sessions"</span><span class="p">)</span>

<span class="hll">    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">        <span class="p">(</span><span class="s">'name_description_check'</span><span class="p">,</span>
</span><span class="hll">         <span class="s">'CHECK(name != description)'</span><span class="p">,</span>
</span><span class="hll">         <span class="s">"The title of the course should not be the description"</span><span class="p">),</span>
</span><span class="hll">
</span><span class="hll">        <span class="p">(</span><span class="s">'name_unique'</span><span class="p">,</span>
</span><span class="hll">         <span class="s">'UNIQUE(name)'</span><span class="p">,</span>
</span><span class="hll">         <span class="s">"The course title must be unique"</span><span class="p">),</span>
</span><span class="hll">    <span class="p">]</span>
</span><span class="hll">
</span>
<span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.session'</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Упражнение 6 - Добавьте дублирующую опцию</p>
        <p>Так как мы добавили уникальное имя к ограничению Course, дублировать ее более невозможно (<span class="menuselection">Form ‣
Duplicate</span>).</p>
        <p>Снова внедрите вашу собственную "копию" метода, позволяющего дублировать объект Course, сменив его на "Copy of [Имя оригинала]".</p>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s">'openacademy.session'</span><span class="p">,</span> <span class="s">'course_id'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Sessions"</span><span class="p">)</span>

<span class="hll">    <span class="nd">@api.multi</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class="hll">        <span class="n">default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">copied_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span><span class="p">(</span>
</span><span class="hll">            <span class="p">[(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'=like'</span><span class="p">,</span> <span class="s">u"Copy of {}%"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))])</span>
</span><span class="hll">        <span class="k">if</span> <span class="ow">not</span> <span class="n">copied_count</span><span class="p">:</span>
</span><span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="s">u"Copy of {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="s">u"Copy of {} ({})"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">copied_count</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">default</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
</span><span class="hll">        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Course</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">'name_description_check'</span><span class="p">,</span>
         <span class="s">'CHECK(name != description)'</span><span class="p">,</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="advanced-views">
      <h2>Расширенные представления</h2></section>
    <section id="id3">
      <h3>Древовидное представление</h3>
      <p>Древовидная структура просмотра дает возможность дальнейшей кастомизации поведения:</p>
      <dl><dt><code>colors</code></dt>
        <dd>
          <p>назначение цвета определенным условиям. Если условие <code>True</code>, ряду назначается соответствующий цвет:</p>
          <div class="highlight-xml">
            <div class="highlight"><pre><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Idea Categories"</span> <span class="na">colors=</span><span class="s">"blue:state=='draft';red:state=='trashed'"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"state"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
          </div>
          <p>Частности разделяются при помощи <code>;</code>, цвета и условия их применения разделяются:.
            <code>:</code>.</p>
        </dd><dt><code>editable</code></dt>
        <dd>В случае с <code>"top"</code> и <code>"bottom"</code> древовидное представление дает возможность изменять значения непосредственно по месту, в отличие от представления в виде формы, где значением является позиция появления нового ряда в форме.</dd>
      </dl>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Список в цвете</p>
        <p>Измените древовидную структуру поля Session таким образом, сессии о временем просмотра более 5 дней были бы окрашены в голубой цвет, а сессии, время просмотра которых более 15 дней, стали красного цвета.</p>
        <p>Изменяем вид представления сессии:</p>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>session.tree<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
<span class="hll">                <span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">"Session Tree"</span> <span class="na">colors=</span><span class="s">"#0000ff:duration&amp;lt;5;red:duration&amp;gt;15"</span><span class="nt">&gt;</span>
</span>                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"duration"</span> <span class="na">invisible=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
</span>                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"taken_seats"</span> <span class="na">widget=</span><span class="s">"progressbar"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/tree&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="calendars">
      <h3>Календари</h3>
      <p>Отображают записи в календарном виде. Корневой элемент - <code>&lt;calendar&gt;</code> , а постоянные атрибуты:</p>
      <dl><dt><code>color</code></dt>
        <dd>Используемое для <em>цветового разделения</em> но, события одного и того же цветового сегмента (имеющие одинаковое значение поля <code>@color</code>) будут иметь одинаковые цвета.В поле </dd><dt><code>date_start</code></dt>
        <dd>хранится значение даты и времени начала события, а </dd><dt><code>date_stop</code> (опционно)</dt>
        <dd>хранит в себе время и дату окончания события</dd>
      </dl>
      <p>поле (определяющее метку для каждого события)</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">"Ideas"</span> <span class="na">date_start=</span><span class="s">"invent_date"</span> <span class="na">color=</span><span class="s">"inventor_id"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/calendar&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Календарное представление</p>
        <p>Добавьте календарное представление к модели <em>Session</em> ,разрешающее пользователю просмотр событий, ассоциированных с Open Academy.</p>
        <ol>
          <li>
            <p>Добавьте поле <code>end_date</code> высчитанное из <code>start_date</code> и
              <code>duration</code></p>
            <div role="alert" class="alert-info alert">
              <p class="alert-title">Совет</p>
              <p>инвертируемая функция делает поле записываемым, разрешая перемещение сессий методом drag and drop в календарном представлении</p>
            </div>
          </li>
          <li>Добавьте календарное представление к модели <em>Session</em></li>
          <li>Добавьте календарное представление к действиям над <em>Session</em></li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="hll"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</span><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span>

<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>

    <span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Taken seats"</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s">'_taken_seats'</span><span class="p">)</span>
<span class="hll">    <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"End Date"</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
</span><span class="hll">        <span class="n">compute</span><span class="o">=</span><span class="s">'_get_end_date'</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s">'_set_end_date'</span><span class="p">)</span>
</span>
    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>                <span class="p">},</span>
            <span class="p">}</span>

<span class="hll">    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'start_date'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_get_end_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">):</span>
</span><span class="hll">                <span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">start_date</span>
</span><span class="hll">                <span class="k">continue</span>
</span><span class="hll">
</span><span class="hll">            <span class="c"># Добавьте продолжительность недели к стартовой дате, учитывая, что: Пнд. + 5 дней = Суббота, вычитаем одну секунду для получения значения Птн.</span>
</span><span class="hll">            <span class="c"># </span>
</span><span class="hll">            <span class="n">start</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span><span class="hll">            <span class="n">duration</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">end_date</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">duration</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">_set_end_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">end_date</span><span class="p">):</span>
</span><span class="hll">                <span class="k">continue</span>
</span><span class="hll">
</span><span class="hll">            <span class="c"># Высчитываем разницу в днях: Птн. - Пнд. = 4 дня,</span>
</span><span class="hll">            <span class="c"># добавим день для получения 5 дней</span>
</span><span class="hll">            <span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</span><span class="hll">            <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>
</span><span class="hll">
</span>    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s">'instructor_id'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="c">&lt;!-- calendar view --&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"session_calendar_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>session.calendar<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">"Session Calendar"</span> <span class="na">date_start=</span><span class="s">"start_date"</span>
</span><span class="hll">                          <span class="na">date_stop=</span><span class="s">"end_date"</span>
</span><span class="hll">                          <span class="na">color=</span><span class="s">"instructor_id"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/calendar&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"session_list_action"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form,calendar<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"session_menu"</span> <span class="na">name=</span><span class="s">"Sessions"</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="id4">
      <h3>Поисковые представления</h3>
      <p>Элементы в поисковом представлениии <code>&lt;field&gt;</code> могут быть обозначены <code>@filter_domain</code> , который работает поверх домена, обозначенного для данного поля. В данном случае,
        <code>self</code> представляет переменную, вводимую пользователем. В нижеприведенном примере, вы сможете наблюдать за работой обеих элементов <code>name</code> и <code>description</code>.</p>
      <p>Поисковые представления также могут состоять из элементов <code>&lt;filter&gt;</code> , играющих роль якорей для предопределенных запросов поиска. Фильтры должны иметь один из следующих атрибутов:</p>
      <dl><dt><code>domain</code></dt>
        <dd>добавляет домен к текущему поиску</dd><dt><code>context</code></dt>
        <dd>добавляет контекст к текущему поиску; ключ <code>group_by</code> используется для группирования определенных полей </dd>
      </dl>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;search</span> <span class="na">string=</span><span class="s">"Ideas"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">string=</span><span class="s">"Name and description"</span>
           <span class="na">filter_domain=</span><span class="s">"['|', ('name', 'ilike', self), ('description', 'ilike', self)]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"country_id"</span> <span class="na">widget=</span><span class="s">"selection"</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"my_ideas"</span> <span class="na">string=</span><span class="s">"My Ideas"</span>
            <span class="na">domain=</span><span class="s">"[('inventor_id', '=', uid)]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"Group By"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"group_by_inventor"</span> <span class="na">string=</span><span class="s">"Inventor"</span>
                <span class="na">context=</span><span class="s">"{'group_by': 'inventor_id'}"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
      </div>
      <p>Для использования собственного вида поиска, следует создать ссылку, используя поле <code>search_view_id</code> для данной записи.</p>
      <p> Данное действие также может устновить значения по умолчанию для своего поиска через поле <code>context</code> : контекстные ключи формы
        <code class="samp">search_default_<em>field_name</em></code> инициализируют <em>field_name</em> с нужным значением. Опционально, фильтры могут иметь <code>@name</code> по умолчанию, выступая в качестве булевых значений (активируются только по
        умолчанию).</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Поисковые представления</p>
        <ol>
          <li>Добавьте кнопку для фильтрации courses , для которых текущий пользователь отвечает за представление в виде course. Установите это в значение по умолчанию.</li>
          <li>Добавьте кнопку для объединения групп courses по типу responsible user.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>                <span class="nt">&lt;search&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"description"</span><span class="nt">/&gt;</span>
<span class="hll">                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"my_courses"</span> <span class="na">string=</span><span class="s">"My Courses"</span>
</span><span class="hll">                            <span class="na">domain=</span><span class="s">"[('responsible_id', '=', uid)]"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"Group By"</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"by_responsible"</span> <span class="na">string=</span><span class="s">"Responsible"</span>
</span><span class="hll">                                <span class="na">context=</span><span class="s">"{'group_by': 'responsible_id'}"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/group&gt;</span>
</span>                <span class="nt">&lt;/search&gt;</span>
            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
            </div>
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"context"</span> <span class="na">eval=</span><span class="s">"{'search_default_my_courses': 1}"</span><span class="nt">/&gt;</span>
</span>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"help"</span> <span class="na">type=</span><span class="s">"html"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"oe_view_nocontent_create"</span><span class="nt">&gt;</span>Create the first course
                <span class="nt">&lt;/p&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="gantt">
      <h3>Gantt</h3>
      <p>Горизонтальное меню, используемое для отображения развития и планированпия проекта, корневым элементом которого является <code>&lt;gantt&gt;</code>.</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">"Ideas"</span> <span class="na">date_start=</span><span class="s">"invent_date"</span> <span class="na">color=</span><span class="s">"inventor_id"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;level</span> <span class="na">object=</span><span class="s">"idea.idea"</span> <span class="na">link=</span><span class="s">"id"</span> <span class="na">domain=</span><span class="s">"[]"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/level&gt;</span>
<span class="nt">&lt;/gantt&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Gantt карты</p>
        <p>Добавьте Gantt, дав возможность пользователю просмотреть сессии, присоединенные к модулю Open Academy. Сессии должны быть сгруппированы, ориентируясь на поле instructor.</p>
        <ol>
          <li>Создайте вычисляемое поле, выражающее время сессии в часах</li>
          <li>Добавьте представление gantt, подключив его к выполнению модели <em>Session</em></li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"End Date"</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s">'_get_end_date'</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s">'_set_end_date'</span><span class="p">)</span>

<span class="hll">    <span class="n">hours</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Duration in hours"</span><span class="p">,</span>
</span><span class="hll">                         <span class="n">compute</span><span class="o">=</span><span class="s">'_get_hours'</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s">'_set_hours'</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>            <span class="n">end_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>

<span class="hll">    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'duration'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_get_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">hours</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">*</span> <span class="mi">24</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">_set_hours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mi">24</span>
</span><span class="hll">
</span>    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s">'instructor_id'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"session_gantt_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>session.gantt<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">"Session Gantt"</span> <span class="na">color=</span><span class="s">"course_id"</span>
</span><span class="hll">                       <span class="na">date_start=</span><span class="s">"start_date"</span> <span class="na">date_delay=</span><span class="s">"hours"</span>
</span><span class="hll">                       <span class="na">default_group_by=</span><span class="s">'instructor_id'</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/gantt&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"session_list_action"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form,calendar,gantt<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"session_menu"</span> <span class="na">name=</span><span class="s">"Sessions"</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="graph-views">
      <h3>Graph представления</h3>
      <p>Представления в виде графов дают возможность просмотра и анализа моделей в комплексе. Для обозначения данного представления используется оператор <code>&lt;graph&gt;</code>.</p>
      <p>Представление может быть отражено при помощи 4 режимов. Режим отображения по умолчанию выбирается путем испольования атрибута
        <code>@type</code>.</p>
      <dl><dt>Pivot</dt>
        <dd> пердставляет собой многомерную таблицу, прозволяющую выбирать различные фильтры и единицы измерения таким образом, чтобы отсортировать данные в наиболее корректном сочетании, перед тем, как представить их в графическом виде</dd><dt>Ячейка (по умолч.)</dt>
        <dd>
          <p>представляет собой первый тип отображения, используемый для оперделения групп горизонтальных осей. Остальные же определяют аггрегированные ячейки внутри каждой из групп.</p>
          <p>По умолчанию ячейки расположены последовательно, друг возле друга, и могут быть объединены при помощи установки аттрибута <code>@stacked="True"</code> в <code>&lt;graph&gt;</code></p>
        </dd><dt>Линия</dt>
        <dd>2-мерная линейная карта</dd><dt>Пирог</dt>
        <dd>2-мерный пирог</dd>
      </dl>
      <p>Графические представления имеют также характеристику <code>&lt;field&gt;</code> с необязательным атрибутом <code>@type</code> принимающим значения:</p>
      <dl><dt><code>row</code> (по умолч.)</dt>
        <dd>поля долны быть объединены по умолчанию</dd><dt><code>measure</code></dt>
        <dd>поля должны быть объединены, а не сгруппированы</dd>
      </dl>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">"Total idea score by Inventor"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"inventor_id"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"score"</span> <span class="na">type=</span><span class="s">"measure"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/graph&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-warning alert">
        <p class="alert-title">Внимание</p>
        <p>Представления в виде графов производят слияние значений баз данных, но не работают с несохраненными вычисляемыми полями.</p>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Представление в виде графа</p>
        <p>Добваьте представление в виде графа к объекту Session отображающему, для каждого course, количество attendees в форме карты ячеек.</p>
        <ol>
          <li>Добавьте количество attendees в виде сохраненного вычисляемого поля</li>
          <li>Добавьте соответствующее представление</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">hours</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Duration in hours"</span><span class="p">,</span>
                         <span class="n">compute</span><span class="o">=</span><span class="s">'_get_hours'</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s">'_set_hours'</span><span class="p">)</span>

<span class="hll">    <span class="n">attendees_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s">"Attendees count"</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s">'_get_attendees_count'</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mi">24</span>

<span class="hll">    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'attendee_ids'</span><span class="p">)</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">_get_attendees_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span class="hll">            <span class="n">r</span><span class="o">.</span><span class="n">attendees_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span>
</span><span class="hll">
</span>    <span class="nd">@api.constrains</span><span class="p">(</span><span class="s">'instructor_id'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"openacademy_session_graph_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>openacademy.session.graph<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">"Participations by Courses"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"course_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"attendees_count"</span> <span class="na">type=</span><span class="s">"measure"</span><span class="nt">/&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/graph&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"session_list_action"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form,calendar,gantt,graph<span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">"session_menu"</span> <span class="na">name=</span><span class="s">"Sessions"</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="kanban">
      <h3>Канбан представление</h3>
      <p>Используется для организации различных заданий, производственных процессов, и.т.п...Обозначается оператором
        <code>&lt;kanban&gt;</code>.</p>
      <p>Преставления канбан служит для отображения набора карт с возможностью группировки в колонки. Каждая карта представяет собой запись таблицы, а каждая колонка - значения аггрегируемого поля.</p>
      <p>Например, задачи проекта могут быть рассортированы по состояниям (каждая колонка - состояние), или по пользователям (каждая колонка - пользователь), и так далее.</p>
      <p>Представление Kanban определяет структуру каждой карты в виде смеси элементов форм (включая элементарный HTML) и <a href="./reference/qweb.html#reference-qweb" class="internal reference"><span>QWeb</span></a>.</p>
      <div
        role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Представление Kanban</p>
        <p>Добавьте представление Kanban, отображающее sessions, сгуппированными по course (колонки - courses).</p>
        <ol>
          <li>Добавьте переменную <code>color</code> в модель <em>Session</em></li>
          <li>Добавьте представление Kanban и обновите</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">duration</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">help</span><span class="o">=</span><span class="s">"Duration in days"</span><span class="p">)</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s">"Number of seats"</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="hll">    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
</span>
    <span class="n">instructor_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Instructor"</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s">'|'</span><span class="p">,</span> <span class="p">(</span><span class="s">'instructor'</span><span class="p">,</span> <span class="s">'='</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>        &lt;/record&gt;

        &lt;record model="ir.ui.view" id="view_openacad_session_kanban"&gt;
<span class="hll">            &lt;field name="name"&gt;openacad.session.kanban&lt;/field&gt;
</span><span class="hll">            &lt;field name="model"&gt;openacademy.session&lt;/field&gt;
</span><span class="hll">            &lt;field name="arch" type="xml"&gt;
</span><span class="hll">                &lt;kanban default_group_by="course_id"&gt;
</span><span class="hll">                    &lt;field name="color"/&gt;
</span><span class="hll">                    &lt;templates&gt;
</span><span class="hll">                        &lt;t t-name="kanban-box"&gt;
</span><span class="hll">                            &lt;div
</span><span class="hll">                                    t-attf-class="oe_kanban_color_{{kanban_getcolor(record.color.raw_value)}}
</span><span class="hll">                                                  oe_kanban_global_click_edit oe_semantic_html_override
</span><span class="hll">                                                  oe_kanban_card {{record.group_fancy==1 ? 'oe_kanban_card_fancy' : ''}}"&gt;
</span><span class="hll">                                &lt;div class="oe_dropdown_kanban"&gt;
</span><span class="hll">                                    &lt;!-- dropdown menu --&gt;
</span><span class="hll">                                    &lt;div class="oe_dropdown_toggle"&gt;
</span><span class="hll">                                        &lt;span class="oe_e"&gt;#&lt;/span&gt;
</span><span class="hll">                                        &lt;ul class="oe_dropdown_menu"&gt;
</span><span class="hll">                                            &lt;li&gt;
</span><span class="hll">                                                &lt;a type="delete"&gt;Delete&lt;/a&gt;
</span><span class="hll">                                            &lt;/li&gt;
</span><span class="hll">                                            &lt;li&gt;
</span><span class="hll">                                                &lt;ul class="oe_kanban_colorpicker"
</span><span class="hll">                                                    data-field="color"/&gt;
</span><span class="hll">                                            &lt;/li&gt;
</span><span class="hll">                                        &lt;/ul&gt;
</span><span class="hll">                                    &lt;/div&gt;
</span><span class="hll">                                    &lt;div class="oe_clear"&gt;&lt;/div&gt;
</span><span class="hll">                                &lt;/div&gt;
</span><span class="hll">                                &lt;div t-attf-class="oe_kanban_content"&gt;
</span><span class="hll">                                    &lt;!-- title --&gt;
</span><span class="hll">                                    Session name:
</span><span class="hll">                                    &lt;field name="name"/&gt;
</span><span class="hll">                                    &lt;br/&gt;
</span><span class="hll">                                    Start date:
</span><span class="hll">                                    &lt;field name="start_date"/&gt;
</span><span class="hll">                                    &lt;br/&gt;
</span><span class="hll">                                    duration:
</span><span class="hll">                                    &lt;field name="duration"/&gt;
</span><span class="hll">                                &lt;/div&gt;
</span><span class="hll">                            &lt;/div&gt;
</span><span class="hll">                        &lt;/t&gt;
</span><span class="hll">                    &lt;/templates&gt;
</span><span class="hll">                &lt;/kanban&gt;
</span><span class="hll">            &lt;/field&gt;
</span><span class="hll">        &lt;/record&gt;
</span><span class="hll">
</span><span class="hll">        &lt;record model="ir.actions.act_window" id="session_list_action"&gt;
</span>            &lt;field name="name"&gt;Sessions&lt;/field&gt;
            &lt;field name="res_model"&gt;openacademy.session&lt;/field&gt;
            &lt;field name="view_type"&gt;form&lt;/field&gt;
            &lt;field name="view_mode"&gt;tree,form,calendar,gantt,graph,kanban&lt;/field&gt;
<span class="hll">        &lt;/record&gt;
</span>
        &lt;menuitem id="session_menu" name="Sessions"
                  parent="openacademy_menu"
</pre></div>
            </div>
          </div>
        </div>
        </div>
    </section>
    <section id="workflows">
      <h2>Операционный поток</h2>
      <p>Операционные потоки - модели, ассоциированные с бизнес-объектами, описывающие их динамику. Операционные потоки также используются для отслеживания процессов, занимающих сверхлимитное время.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Операционных поток</p>
        <p>Добавьте поле <code>state</code> к модели <em>Session</em> . Он будет использоваться для опеределения принадлежности к рабочему потоку.</p>
        <p> Сессия может иметь три возможных атрибута: Черновой (draft) (по умолч.), Подтвержденный (Confirmed) и (Выполненный) Done.</p>
        <p>Добавьте поле к форме session, с атрибутом только для чтения, обозначив состояние поля и кнопки для его изменения. Варианты изменения:</p>
        <ul>
          <li>Draft -&gt; Confirmed</li>
          <li>Confirmed -&gt; Draft</li>
          <li>Confirmed -&gt; Done</li>
          <li>Done -&gt; Draft</li>
        </ul>
        <ol>
          <li>Добавьте поле <code>state</code></li>
          <li>Добавьте варианты изменения поля, вызываемые при помощи кнопок изменения записи.</li>
          <li>Также добавьте соответствующие кнопки к представлению формы session</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">attendees_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span>
        <span class="n">string</span><span class="o">=</span><span class="s">"Attendees count"</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s">'_get_attendees_count'</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="hll">    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
</span><span class="hll">        <span class="p">(</span><span class="s">'draft'</span><span class="p">,</span> <span class="s">"Draft"</span><span class="p">),</span>
</span><span class="hll">        <span class="p">(</span><span class="s">'confirmed'</span><span class="p">,</span> <span class="s">"Confirmed"</span><span class="p">),</span>
</span><span class="hll">        <span class="p">(</span><span class="s">'done'</span><span class="p">,</span> <span class="s">"Done"</span><span class="p">),</span>
</span><span class="hll">    <span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s">'draft'</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="nd">@api.multi</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">action_draft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'draft'</span>
</span><span class="hll">
</span><span class="hll">    <span class="nd">@api.multi</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">action_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'confirmed'</span>
</span><span class="hll">
</span><span class="hll">    <span class="nd">@api.multi</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">action_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="s">'done'</span>
</span><span class="hll">
</span>    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">'seats'</span><span class="p">,</span> <span class="s">'attendee_ids'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Session Form"</span><span class="nt">&gt;</span>
<span class="hll">                    <span class="nt">&lt;header&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"action_draft"</span> <span class="na">type=</span><span class="s">"object"</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Reset to draft"</span>
</span><span class="hll">                                <span class="na">states=</span><span class="s">"confirmed,done"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"action_confirm"</span> <span class="na">type=</span><span class="s">"object"</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Confirm"</span> <span class="na">states=</span><span class="s">"draft"</span>
</span><span class="hll">                                <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"action_done"</span> <span class="na">type=</span><span class="s">"object"</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Mark as done"</span> <span class="na">states=</span><span class="s">"confirmed"</span>
</span><span class="hll">                                <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"state"</span> <span class="na">widget=</span><span class="s">"statusbar"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/header&gt;</span>
</span><span class="hll">
</span>                    <span class="nt">&lt;sheet&gt;</span>
                        <span class="nt">&lt;group&gt;</span>
                            <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">"General"</span><span class="nt">&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <p>Операционные потоки могут быть ассоциированны с любым из объектов Odoo с возможностью различных вариантов их изменения. Операционные потоки применяются для структурирования и управления временем жизни бизнес-объектов и документов, а также для работы
        с триггерами и транзакциями при помощи графических интсрументов. Операционные потоки (кусты или действия), а также транзакции (условия) объявляются, как правило, в виде записей XML. Управляющие элементы операционных потоков называются рабочими
        элементами (workitems).</p>
      <div role="alert" class="alert-warning alert">
        <p class="alert-title">Внимание</p>
        <p>Операционный поток ассоциированный с моделью, создается только в случае создания записи модели. Таким образом, операциооный поток не может ассоциироваться с моделью, пока не будет создана запись модели непосредственно. Что означает невозможность
          ассоциирования экземпляра операционного потока с экземпляром сессии до объявления самого операционного потока.</p>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Операционный поток</p>
        <p>Замените поток ad-hoc <em>Session</em> настоящим операционным потоком. Трансформируйте форму <em>Session</em> таким образом, чтобы кнопки формы вызывали операционный поток, а не методы модели.</p>
        <div class="pq-patch"><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="s">'templates.xml'</span><span class="p">,</span>
        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
        <span class="s">'views/partner.xml'</span><span class="p">,</span>
<span class="hll">        <span class="s">'views/session_workflow.xml'</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c"># загружается только в режиме демонстрации</span>
    <span class="s">'demo'</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
            </div>
          </div><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="p">(</span><span class="s">'draft'</span><span class="p">,</span> <span class="s">"Draft"</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'confirmed'</span><span class="p">,</span> <span class="s">"Confirmed"</span><span class="p">),</span>
        <span class="p">(</span><span class="s">'done'</span><span class="p">,</span> <span class="s">"Done"</span><span class="p">),</span>
<span class="hll">    <span class="p">])</span>
</span>
    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">action_draft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Session Form"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;header&gt;</span>
<span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"draft"</span> <span class="na">type=</span><span class="s">"workflow"</span>
</span>                                <span class="na">string=</span><span class="s">"Reset to draft"</span>
                                <span class="na">states=</span><span class="s">"confirmed,done"</span><span class="nt">/&gt;</span>
<span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"confirm"</span> <span class="na">type=</span><span class="s">"workflow"</span>
</span>                                <span class="na">string=</span><span class="s">"Confirm"</span> <span class="na">states=</span><span class="s">"draft"</span>
                                <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
<span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"done"</span> <span class="na">type=</span><span class="s">"workflow"</span>
</span>                                <span class="na">string=</span><span class="s">"Mark as done"</span> <span class="na">states=</span><span class="s">"confirmed"</span>
                                <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"state"</span> <span class="na">widget=</span><span class="s">"statusbar"</span><span class="nt">/&gt;</span>
</pre></div>
            </div>
          </div><em>openacademy/views/session_workflow.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow"</span> <span class="na">id=</span><span class="s">"wkf_session"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>OpenAcademy sessions workflow<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"osv"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"on_create"</span><span class="nt">&gt;</span>True<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"draft"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Draft<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"flow_start"</span> <span class="na">eval=</span><span class="s">"True"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>function<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;</span>action_draft()<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"confirmed"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Confirmed<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>function<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;</span>action_confirm()<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"done"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Done<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>function<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;</span>action_done()<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_draft_to_confirmed"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_from"</span> <span class="na">ref=</span><span class="s">"draft"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"confirmed"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"signal"</span><span class="nt">&gt;</span>confirm<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_confirmed_to_draft"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_from"</span> <span class="na">ref=</span><span class="s">"confirmed"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"draft"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"signal"</span><span class="nt">&gt;</span>draft<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_done_to_draft"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_from"</span> <span class="na">ref=</span><span class="s">"done"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"draft"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"signal"</span><span class="nt">&gt;</span>draft<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_confirmed_to_done"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_from"</span> <span class="na">ref=</span><span class="s">"confirmed"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"done"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"signal"</span><span class="nt">&gt;</span>done<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
        <div role="alert" class="alert-info alert">
          <p class="alert-title">Совет</p>
          <p>Для проверки правильности создания элементов операционного потока вне сессии, перейдите к пункту <span class="menuselection">Настройки ‣
Технические ‣ Операционные потоки ‣ Элементы</span></p>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Автоматические транзакции</p>
        <p>Переместите sessions в автоматическом режиме из <em>Draft</em> в <em>Confirmed</em> при условии, что половина мест в сессии зарезервирована.</p>
        <div class="pq-patch"><em>openacademy/views/session_workflow.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"done"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"signal"</span><span class="nt">&gt;</span>done<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
<span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_auto_confirm_half_filled"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_from"</span> <span class="na">ref=</span><span class="s">"draft"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"act_to"</span> <span class="na">ref=</span><span class="s">"confirmed"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"condition"</span><span class="nt">&gt;</span>taken_seats <span class="ni">&amp;gt;</span> 50<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Действия с сервером</p>
        <p>Замените методы Python используемые для синхронизации сессии на действия с сервером.</p>
        <p>Оба типа действий, как операционный поток, так и серверные действия, должны быть созданы из интерфейса пользователя.</p>
        <div class="pq-patch"><em>openacademy/views/session_workflow.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"on_create"</span><span class="nt">&gt;</span>True<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.server"</span> <span class="na">id=</span><span class="s">"set_session_to_draft"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Set session to Draft<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model_id"</span> <span class="na">ref=</span><span class="s">"model_openacademy_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"code"</span><span class="nt">&gt;</span>
</span><span class="hll">model.search([('id', 'in', context['active_ids'])]).action_draft()
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"draft"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Draft<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"flow_start"</span> <span class="na">eval=</span><span class="s">"True"</span><span class="nt">/&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>dummy<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action_id"</span> <span class="na">ref=</span><span class="s">"set_session_to_draft"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.server"</span> <span class="na">id=</span><span class="s">"set_session_to_confirmed"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Set session to Confirmed<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model_id"</span> <span class="na">ref=</span><span class="s">"model_openacademy_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"code"</span><span class="nt">&gt;</span>
</span><span class="hll">model.search([('id', 'in', context['active_ids'])]).action_confirm()
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>
        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"confirmed"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Confirmed<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>dummy<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action_id"</span> <span class="na">ref=</span><span class="s">"set_session_to_confirmed"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.server"</span> <span class="na">id=</span><span class="s">"set_session_to_done"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Set session to Done<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model_id"</span> <span class="na">ref=</span><span class="s">"model_openacademy_session"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"code"</span><span class="nt">&gt;</span>
</span><span class="hll">model.search([('id', 'in', context['active_ids'])]).action_done()
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>
        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.activity"</span> <span class="na">id=</span><span class="s">"done"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Done<span class="nt">&lt;/field&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"wkf_id"</span> <span class="na">ref=</span><span class="s">"wkf_session"</span><span class="nt">/&gt;</span>
<span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"kind"</span><span class="nt">&gt;</span>dummy<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action"</span><span class="nt">&gt;&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"action_id"</span> <span class="na">ref=</span><span class="s">"set_session_to_done"</span><span class="nt">/&gt;</span>
</span>        <span class="nt">&lt;/record&gt;</span>

        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"workflow.transition"</span> <span class="na">id=</span><span class="s">"session_draft_to_confirmed"</span><span class="nt">&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="security">
      <h2>Безопасность</h2>
      <p>Для достижения соответствующего уровня безопасности, следует правильно настроить политики управления контролем.</p>
    </section>
    <section id="group-based-access-control-mechanisms">
      <h3>Групповые механизмы управления контролем безопасности</h3>
      <p>Группы определяются, как записи в модели <code>res.groups</code>, управление доступом которых осуществляется через характеристики меню. Но, даже без меню, к объектам можно получить доступ косвенно, через определения доступа для групп (только чтение,
        запись, выполнение и пр.). Обычно, все политики доступа встраиваются в модули посредством файлов CSV. Также, существует возможность ограничивать доступ к определенным полям через представление или объект, используя атрибуты полей групп.</p>
    </section>
    <section id="access-rights">
      <h3>Права доступа</h3>
      <p>Права доступа определяются, как записи в <code>ir.model.access</code>. Каждое правило ассоциируется с определенной моделью, группой (или же no group для глобальных ресурсов), а также сводом разрешений: чтение, запись, создание, отсоединение. Обычно,
        такие правила заданы в файле CSV, названном по имени модели:
        <code>ir.model.access.csv</code>.</p>
      <div class="highlight-text">
        <div class="highlight"><pre>id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_idea_idea,idea.idea,model_idea_idea,base.group_user,1,1,1,0
access_idea_vote,idea.vote,model_idea_vote,base.group_user,1,1,1,0
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Добавьте управление доступом через интерфейс OpenERP</p>
        <p>Создайте пользователя "John Smith". Потом группу "OpenAcademy / Session Read" с доступом на чтение для модели <em>Session</em>.</p>
        <ol>
          <li>Создайте пользователя <em>John Smith</em> через <span class="menuselection">Настройки ‣ Пользователи ‣ Пользователи</span></li>
          <li>Создайте новую группу <code>session_read</code> через
            <span class="menuselection">Настройки ‣ Пользователи ‣ Группы</span>, с правами доступа на чтение для модели <em>Session</em></li>
          <li>Отредактируйте <em>John Smith</em> , сделав его членом группы <code>session_read</code></li>
          <li>Залогиньтесь под <em>John Smith</em> для проверки правильности установки прав доступа </li>
        </ol>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Добавьте права доступа через файлы модуля</p>
        <p>Используя файлы баз,</p>
        <ul>
          <li>Создайте группу <em>OpenAcademy / Manager</em> с полным доступом к моделям OpenAcademy</li>
          <li>Установите доступ на чтение для <em>Session</em> и <em>Course</em> для всех пользователей</li>
        </ul>
        <ol>
          <li>Создайте <code>openacademy/security/security.xml</code> с принадлежностью к группе OpenAcademy Manager</li>
          <li>Отредактируйте файл <code>openacademy/security/ir.model.access.csv</code> с правами доступа к модулям</li>
          <li>Обновите модуль <code>openacademy/__openerp__.py</code>, добавив к нему новые файлы с данными</li>
        </ol>
        <div class="pq-patch"><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="c"># всегда загружаем</span>
    <span class="s">'data'</span><span class="p">:</span> <span class="p">[</span>
<span class="hll">        <span class="s">'security/security.xml'</span><span class="p">,</span>
</span><span class="hll">        <span class="s">'security/ir.model.access.csv'</span><span class="p">,</span>
</span>        <span class="s">'templates.xml'</span><span class="p">,</span>
        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
        <span class="s">'views/partner.xml'</span><span class="p">,</span>
</pre></div>
            </div>
          </div><em>openacademy/security/ir.model.access.csv</em>
          <div class="pq-section">
            <div class="highlight-guess">
              <div class="highlight"><pre>id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
<span class="hll">course_manager,course manager,model_openacademy_course,group_manager,1,1,1,1
</span><span class="hll">session_manager,session manager,model_openacademy_session,group_manager,1,1,1,1
</span><span class="hll">course_read_all,course all,model_openacademy_course,,1,0,0,0
</span><span class="hll">session_read_all,session all,model_openacademy_session,,1,0,0,0
</span></pre></div>
            </div>
          </div><em>openacademy/security/security.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">"group_manager"</span> <span class="na">model=</span><span class="s">"res.groups"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>OpenAcademy / Manager<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="record-rules">
      <h3>Права записи</h3>
      <p>Права записи определяют ограничения доступа к списку записей конкретной модели. Правило - запись в коде модели <code>ir.rule</code>, которая ассоциируется с моделью, количеством групп (many2many field), разрешениями, к которым применимы данные правила,
        а также с domain. Определение domain выделяет, каким записям доступ ограничен.</p>
      <p> Ниже приведен пример правила, запрещающего удаление пунктов, которым не указан атрибут <code>cancel</code>. Обратите внимание на то, что значение поля <code>groups</code>должно соответствовать соглашениям, указанным в методе <a href="./reference/orm.html#openerp.models.Model.write"
          class="internal reference" title="openerp.models.Model.write"><code class="py py-meth xref">write()</code></a>ORM.</p>
      <div class="highlight-xml">
        <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">"delete_cancelled_only"</span> <span class="na">model=</span><span class="s">"ir.rule"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Only cancelled leads may be deleted<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model_id"</span> <span class="na">ref=</span><span class="s">"crm.model_crm_lead"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"groups"</span> <span class="na">eval=</span><span class="s">"[(4, ref('base.group_sale_manager'))]"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_read"</span> <span class="na">eval=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_write"</span> <span class="na">eval=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_create"</span> <span class="na">eval=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_unlink"</span> <span class="na">eval=</span><span class="s">"1"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"domain_force"</span><span class="nt">&gt;</span>[('state','=','cancel')]<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Правило записи</p>
        <p>Добавьте правило записи к моделиAdd Course и группе "OpenAcademy / Manager", ограничивающее <code>write</code> и <code>unlink</code> доступ пользователям course. В случае, если course не имеет доступ, тогда все пользователи группы должны иметь
          право на его модификацию.</p>
        <p>Создайте новое правило в <code>openacademy/security/security.xml</code>:</p>
        <div class="pq-patch"><em>openacademy/security/security.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre>        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">"group_manager"</span> <span class="na">model=</span><span class="s">"res.groups"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>OpenAcademy / Manager<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
<span class="hll">
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">"only_responsible_can_modify"</span> <span class="na">model=</span><span class="s">"ir.rule"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Редактировать могут только ответственные из Course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model_id"</span> <span class="na">ref=</span><span class="s">"model_openacademy_course"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"groups"</span> <span class="na">eval=</span><span class="s">"[(4, ref('openacademy.group_manager'))]"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_read"</span> <span class="na">eval=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_write"</span> <span class="na">eval=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_create"</span> <span class="na">eval=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"perm_unlink"</span> <span class="na">eval=</span><span class="s">"1"</span><span class="nt">/&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"domain_force"</span><span class="nt">&gt;</span>
</span><span class="hll">                ['|', ('responsible_id','=',False),
</span><span class="hll">                      ('responsible_id','=',user.id)]
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span>    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="wizards">
      <h2>Помощники</h2>
      <p>Помощники описывают интерактивную работу с пользователями через динамические формы. Помощник является обычной моделью, расширяющей класс <code class="py xref py-class">TransientModel</code> вместо
        <a href="./reference/orm.html#openerp.models.Model" class="internal reference" title="openerp.models.Model"><code class="py xref py-class">Model</code></a>. Класс
        <code class="py xref py-class">TransientModel</code> расширяет <a href="./reference/orm.html#openerp.models.Model" class="internal reference" title="openerp.models.Model"><code class="py xref py-class">Model</code></a>        , отменяя все его существующие механизмы при помощи следующих инструментов:</p>
      <ul>
        <li>Записи помощников не являются постоянными и удаляются из базы данных по истечении определенного времени. Поэтому, их называют <em>транзитные</em>.</li>
        <li>Модели помощников не нуждаются в явных объявлениях прав доступа: пользователи имеют все права доступа к записям помощников.</li>
        <li>Модели помощников могут относиться как к обычным записям, так и к записям полей many2one, но, обычные записи <em>не могут</em> относиться к записям помощников в поле many2one.</li>
      </ul>
      <p>Мы хотим создать помощника, разрешающего доступ пользователям на создание attendees для определенной сессии, или же, для списка сессий одновременно.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Определение помощника</p>
        <p>Создайте модель помощника соотносящуюся с <em>Session</em> и <em>Partner</em> через модель many2one.</p>
        <p>Добавьте новый файл к <code>openacademy/wizard.py</code>:</p>
        <div class="pq-patch"><em>openacademy/__init__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">partner</span>
<span class="hll"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">wizard</span>
</span></pre></div>
            </div>
          </div><em>openacademy/wizard.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="hll"><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class="hll">
</span><span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">Wizard</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
</span><span class="hll">    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.wizard'</span>
</span><span class="hll">
</span><span class="hll">    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s">"Session"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class="hll">    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="launching-wizards">
      <h3>Запуск помощников</h3>
      <p>Запустить помощника можно через <code>ir.actions.act_window</code> , указав в
        <code>target</code> значение <code>new</code>. Последний открывает помощника в новом всплывающем окне. Действием можно управлять через меню.</p>
      <p>Также, существует и другой вариант запуска. Используйте код: <code>ir.actions.act_window</code>,как указано выше, но, добавив туда еще одну инструкцию <code>src_model</code> , определяющую, в контексте какой модели действие будет доступноthat. Помощник
        появится строго при определенных условиях, расположившись поверх основного окна. В данном случае, через ORM, все это прописывается в файле XML с тэгом <code>act_window</code>.</p>
      <div class="xml highlight-python code">
        <div class="highlight"><pre>&lt;act_window id="launch_the_wizard"
            name="Launch the Wizard"
            src_model="context_model_name"
            res_model="wizard_model_name"
            view_mode="form"
            target="new"
            key2="client_action_multi"/&gt;
</pre></div>
      </div>
      <p>Помощник использует стандартное представление, а его кнопки могут снабжаться атрибутом <code>special="cancel"</code> для закрытия окна без сохранения.</p>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Запустьите помощника</p>
        <ol>
          <li>Определите представление в виде формы.</li>
          <li>Добавьте действие, позволяющее запуск в контексте модели <em>Session</em>.</li>
          <li>В помощнике определите значение по умолчанию для поля сессии; используйте контекстный параметр <code>self._context</code> для получения текущей сессии.</li>
        </ol>
        <div class="pq-patch"><em>openacademy/wizard.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="k">class</span> <span class="nc">Wizard</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.wizard'</span>

<span class="hll">    <span class="k">def</span> <span class="nf">_default_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">'openacademy.session'</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'active_id'</span><span class="p">))</span>
</span><span class="hll">
</span>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span>
<span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s">"Session"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_session</span><span class="p">)</span>
</span>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
</pre></div>
            </div>
          </div><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>                  parent="openacademy_menu"
                  action="session_list_action"/&gt;

<span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"wizard_form_view"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>wizard.form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>openacademy.wizard<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Add Attendees"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;group&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"session_id"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/group&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;act_window</span> <span class="na">id=</span><span class="s">"launch_session_wizard"</span>
</span><span class="hll">                    <span class="na">name=</span><span class="s">"Add Attendees"</span>

</span><span class="hll">                    <span class="na">src_model=</span><span class="s">"openacademy.session"</span>
</span><span class="hll">                    <span class="na">res_model=</span><span class="s">"openacademy.wizard"</span>
</span><span class="hll">                    <span class="na">view_mode=</span><span class="s">"form"</span>
</span><span class="hll">                    <span class="na">target=</span><span class="s">"new"</span>
</span><span class="hll">                    <span class="na">key2=</span><span class="s">"client_action_multi"</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="nt">&lt;/openerp&gt;</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Регистрация attendees</p>
        <p>В помощнике нужно добавить кнопки и ввести соответствующий метод для добавления attendees к данной сессии.</p>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/group&gt;</span>
                    <span class="nt">&lt;footer&gt;</span>
<span class="hll">                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"subscribe"</span> <span class="na">type=</span><span class="s">"object"</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Subscribe"</span> <span class="na">class=</span><span class="s">"oe_highlight"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        or
</span><span class="hll">                        <span class="nt">&lt;button</span> <span class="na">special=</span><span class="s">"cancel"</span> <span class="na">string=</span><span class="s">"Cancel"</span><span class="nt">/&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/footer&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span>            <span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
</pre></div>
            </div>
          </div><em>openacademy/wizard.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span>
        <span class="n">string</span><span class="o">=</span><span class="s">"Session"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_session</span><span class="p">)</span>
    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">    <span class="nd">@api.multi</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="o">.</span><span class="n">attendee_ids</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span>
</span><span class="hll">        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Зарегистрируйте attendees для множественный сессийt</p>
        <p>Отредактируйте модель помощника так, чтобы attendees могли регистрироваться во множественных сессиях.</p>
        <div class="pq-patch"><em>openacademy/views/openacademy.xml</em>
          <div class="pq-section">
            <div class="highlight-xml+django">
              <div class="highlight"><pre>                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Add Attendees"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;group&gt;</span>
                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"session_ids"</span><span class="nt">/&gt;</span>
<span class="hll">                        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"attendee_ids"</span><span class="nt">/&gt;</span>
</span>                    <span class="nt">&lt;/group&gt;</span>
                    <span class="nt">&lt;footer&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"subscribe"</span> <span class="na">type=</span><span class="s">"object"</span>
</pre></div>
            </div>
          </div><em>openacademy/wizard.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="k">class</span> <span class="nc">Wizard</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.wizard'</span>

<span class="hll">    <span class="k">def</span> <span class="nf">_default_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s">'openacademy.session'</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'active_ids'</span><span class="p">))</span>
</span>
<span class="hll">    <span class="n">session_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span>
</span><span class="hll">        <span class="n">string</span><span class="o">=</span><span class="s">"Sessions"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_sessions</span><span class="p">)</span>
</span>    <span class="n">attendee_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s">'res.partner'</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s">"Attendees"</span><span class="p">)</span>

    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_ids</span><span class="p">:</span>
</span><span class="hll">            <span class="n">session</span><span class="o">.</span><span class="n">attendee_ids</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span>
</span>        <span class="k">return</span> <span class="p">{}</span>
</pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="internationalization">
      <h2>Интернационализация</h2>
      <p>Каждый модуль может иметь несколько вариантов перевода. Все они находятся в папке i18n в виде LANG.po файлов, где LANG - код локали для языка, или же, комбинация Язык_Страна, в случае, если они отличаются (пример: pt.po или pt_BR.po). Перевод будет
        автоматически втянут в Odoo для всех отмеченных языков. Разработчики используют английский для создания модулей, затем экспортируют термины модуля в Odoo's через gettext POT export (<span class="menuselection">Настройки ‣ Переводы ‣ Импорт/Экспорт ‣ Экспорт перевода</span>        без определения языка), создавая пустой шаблон POT, добавляя затем еще и переведенные файлы PO. Множество IDE's снабжены специальными инструментами для работы с файлами PO/POT.</p>
      <div role="alert" class="alert-info alert">
        <p class="alert-title">Совет</p>
        <p>Формат GNU gettext (Portable Object), используемый Odoo, встроен в LaunchPad, делая его кроссплатформенным приложением для перевода.</p>
      </div>
      <div class="highlight-text">
        <div class="highlight"><pre>|- idea/ # Папка модуля
   |- i18n/ # Файлы перевода
      | - idea.pot # Шаблон перевода (экспортирован с Odoo)
      | - fr.po # Французский файл с переводом
      | - pt_BR.po # Бразильский перевод (португальский вариант)
      | (...)
</pre></div>
      </div>
      <div role="alert" class="alert-info alert">
        <p class="alert-title">Совет</p>
        <p>По умолчанию, Odoo's файлы POT представляют собой файлы типа XML с определениями в полях на языке Python, где любаяя строка Python может быть переведена путем окружения ее функцией <code class="py xref py-func">openerp._()</code> (к примеру <code>_("Label")</code>)</p>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Переведите модуль</p>
        <p>Выберите второй язык, устанавливаемый в Odoo. Переведите модуль при помощи инструментов, пердоставляемых Odoo.</p>
        <ol>
          <li>Создайте папкуCreate <code>openacademy/i18n/</code></li>
          <li>Установите любой подходящий язык (
            <span class="menuselection">Administration ‣ Translations ‣ Load an
Official Translation</span>)</li>
          <li>Синхронизируйте переводимиые определения (<span class="menuselection">Administration ‣
Translations ‣ Application Terms ‣ Synchronize Translations</span>)</li>
          <li>Создайте шаблон перевода, экспортировав (
            <span class="menuselection">Administration ‣ Translations -&gt; Import/Export
‣ Export Translation</span>) без определения языка, сохранив его в папке <code>openacademy/i18n/</code></li>
          <li>Создайте файл перевода, экспортировав (
            <span class="menuselection">Administration ‣ Translations ‣ Import/Export
‣ Export Translation</span>) с указанием языка. Сохраните его в папке
            <code>openacademy/i18n/</code></li>
          <li>Откройте файл перевода (в обычном текстовом редакторе, или специальном редакторе PO-файлов. Напр.: <a href="http://poedit.net/" class="external reference alert-link">POEdit</a> и переведите пропущенные выражения</li>
          <li>В <code>models.py</code>, добавив функцию импорта к
            <code>openerp._</code> выделив пропущенные строки, как переводимые</li>
          <li>Повторите шаги 3-6</li>
        </ol>
        <div class="pq-patch"><em>openacademy/models.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="hll"><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">,</span> <span class="n">_</span>
</span>
<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">'openacademy.course'</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="n">default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="n">copied_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span><span class="p">(</span>
<span class="hll">            <span class="p">[(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'=like'</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u"Copy of {}%"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))])</span>
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">copied_count</span><span class="p">:</span>
<span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u"Copy of {}"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span>        <span class="k">else</span><span class="p">:</span>
<span class="hll">            <span class="n">new_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u"Copy of {} ({})"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">copied_count</span><span class="p">)</span>
</span>
        <span class="n">default</span><span class="p">[</span><span class="s">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_name</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Course</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s">'warning'</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">                    <span class="s">'title'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"Incorrect 'seats' value"</span><span class="p">),</span>
</span><span class="hll">                    <span class="s">'message'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"The number of available seats may not be negative"</span><span class="p">),</span>
</span>                <span class="p">},</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s">'warning'</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">                    <span class="s">'title'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"Too many attendees"</span><span class="p">),</span>
</span><span class="hll">                    <span class="s">'message'</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">"Increase seats or remove excess attendees"</span><span class="p">),</span>
</span>                <span class="p">},</span>
            <span class="p">}</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_check_instructor_not_in_attendees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">instructor_id</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">:</span>
<span class="hll">                <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">"A session's instructor can't be an attendee"</span><span class="p">))</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="reporting">
      <h2>Ведение отчетов</h2></section>
    <section id="printed-reports">
      <h3>Отчеты для печати</h3>
      <p>В Odoo 8.0 встроен новый движок для ведения документации, базирующийся на <a href="./reference/qweb.html#reference-qweb" class="internal reference"><span>QWeb</span></a>,
        <a href="http://getbootstrap.com/" class="external reference">Twitter Bootstrap</a> and <a href="http://wkhtmltopdf.org/" class="external reference">Wkhtmltopdf</a>.</p>
      <p>Отчет пердставляет собой комбинацию из двух элементов:</p>
      <ul>
        <li>
          <p><code>ir.actions.report.xml</code>, где <code>&lt;report&gt;</code> является ярлыком, устанавливающим различные параметры для отчета (тип по умолчанию, необходимость сохранения отчета в базе после его генерации,…)</p>
          <div class="highlight-xml">
            <div class="highlight"><pre><span class="nt">&lt;report</span>
    <span class="na">id=</span><span class="s">"account_invoices"</span>
    <span class="na">model=</span><span class="s">"account.invoice"</span>
    <span class="na">string=</span><span class="s">"Invoices"</span>
    <span class="na">report_type=</span><span class="s">"qweb-pdf"</span>
    <span class="na">name=</span><span class="s">"account.report_invoice"</span>
    <span class="na">file=</span><span class="s">"account.report_invoice"</span>
    <span class="na">attachment_use=</span><span class="s">"True"</span>
    <span class="na">attachment=</span><span class="s">"(object.state in ('open','paid')) and</span>
<span class="s">        ('INV'+(object.number or '').replace('/','')+'.pdf')"</span>
<span class="nt">/&gt;</span>
</pre></div>
          </div>
        </li>
        <li>
          <p>Стандартный вид <a href="./reference/views.html#reference-views-qweb" class="internal reference"><span>QWeb</span></a> для нового отчета:</p>
          <div class="highlight-xml">
            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">"report.html_container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">"docs"</span> <span class="na">t-as=</span><span class="s">"o"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">"report.external_layout"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Report title<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/t&gt;</span>

стандартный контекст отчета подразумевает определенный набор элементов, таких как:

``docs``
    записи, для которых производится печать отчета
``user``
    пользователь, печатающий отчет
</pre></div>
          </div>
        </li>
      </ul>
      <p>В связи с тем, что отчеты представляют собой стандартные веб-страницы, они могут быть доступны и легко управляемы посредством обычного запроса URL. К примеру, HTML версия <em>Invoice</em> доступна по ссылке
        <a href="http://localhost:8069/report/html/account.report_invoice/1" class="external reference">http://localhost:8069/report/html/account.report_invoice/1</a> (если <code>account</code> установлен), а PDF версия доступна по ссылке <a href="http://localhost:8069/report/pdf/account.report_invoice/1"
          class="external reference">http://localhost:8069/report/pdf/account.report_invoice/1</a>.</p>
      <div role="alert" class="alert-danger alert" id="reference-backend-reporting-printed-reports-pdf-without-styles">
        <p class="alert-title">Внимание</p>
        <p>Если в вашем отчете PDF отсутствует правильное форматирование, то, возможно, процесс <a href="http://wkhtmltopdf.org/" class="external reference alert-link">wkhtmltopdf</a> достучаться до вашего сервера для загрузки отчета.</p>
        <p>Проверьте логи вашего сервера. В случае обнаружения проблем со стилями CSS, генерирующими отчет PDF report, попробуйте переустановить их.</p>
        <p>Процесс <a href="http://wkhtmltopdf.org/" class="external reference alert-link">wkhtmltopdf</a> использует параметр <code>web.base.url</code> в качестве <em>корневого каталога</em> для доступа ко всем файлам отчетов, однако, их параметр обновляется
          каждый раз при входе администратора. Если ваш сервер находится за прокси, он может быть недоступен. Это исправляется путем редактирования системных параметров:</p>
        <ul>
          <li><code>report.url</code>, указывающих на URL доступа к серверу (возможно <code>http://localhost:8069</code> или нечто подобное). Этот адрес будет использоваться толькро для данной операции.</li>
          <li><code>web.base.url.freeze</code>, установленный в <code>True</code>, остановит автоматическое обновление через <code>web.base.url</code>.</li>
        </ul>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Создайте отчет для модели Session</p>
        <p>Для каждой сессии в отчете должно быть отображено ее имя, время ее начала и окончания, а также список attendees.</p>
        <div class="pq-patch"><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
        <span class="s">'views/partner.xml'</span><span class="p">,</span>
        <span class="s">'views/session_workflow.xml'</span><span class="p">,</span>
<span class="hll">        <span class="s">'reports.xml'</span><span class="p">,</span>
</span>    <span class="p">],</span>
    <span class="c"># only loaded in demonstration mode</span>
    <span class="s">'demo'</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
            </div>
          </div><em>openacademy/reports.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll"><span class="nt">&lt;data&gt;</span>
</span><span class="hll">    <span class="nt">&lt;report</span>
</span><span class="hll">        <span class="na">id=</span><span class="s">"report_session"</span>
</span><span class="hll">        <span class="na">model=</span><span class="s">"openacademy.session"</span>
</span><span class="hll">        <span class="na">string=</span><span class="s">"Session Report"</span>
</span><span class="hll">        <span class="na">name=</span><span class="s">"openacademy.report_session_view"</span>
</span><span class="hll">        <span class="na">file=</span><span class="s">"openacademy.report_session"</span>
</span><span class="hll">        <span class="na">report_type=</span><span class="s">"qweb-pdf"</span> <span class="nt">/&gt;</span>
</span><span class="hll">
</span><span class="hll">    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">"report_session_view"</span><span class="nt">&gt;</span>
</span><span class="hll">        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">"report.html_container"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">"docs"</span> <span class="na">t-as=</span><span class="s">"doc"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">"report.external_layout"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"page"</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;h2</span> <span class="na">t-field=</span><span class="s">"doc.name"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;p&gt;</span>From <span class="nt">&lt;span</span> <span class="na">t-field=</span><span class="s">"doc.start_date"</span><span class="nt">/&gt;</span> to <span class="nt">&lt;span</span> <span class="na">t-field=</span><span class="s">"doc.end_date"</span><span class="nt">/&gt;&lt;/p&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;h3&gt;</span>Attendees:<span class="nt">&lt;/h3&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;ul&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">"doc.attendee_ids"</span> <span class="na">t-as=</span><span class="s">"attendee"</span><span class="nt">&gt;</span>
</span><span class="hll">                                <span class="nt">&lt;li&gt;&lt;span</span> <span class="na">t-field=</span><span class="s">"attendee.name"</span><span class="nt">/&gt;&lt;/li&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/ul&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/div&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/t&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/template&gt;</span>
</span><span class="hll"><span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="dashboards">
      <h3>Панели инструментов</h3>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Выбор панели инструментов</p>
        <p>Выберите панель инструментов, содержащую графическое представление, созданное вами, календарное представление сессии, список курсов (с возможностью переключения к представлению в виде формы). Панель должна быть доступна через пункт меню, а также
          автоматически отображаться в веб-клиенте при открытии главного меню OpenAcademy.</p>
        <ol>
          <li>
            <p>Создайте файл <code>openacademy/views/session_board.xml</code>. В нем должно быть прописано представление панели, действия, соотносящиеся с этим представлением, действия для открытия панели, а также переопределение пунктов главного меню, скоординированное
              в соответствии с добавляемыми действиями для панели инструментов</p>
            <div role="alert" class="alert-info alert">
              <p class="alert-title">Заметка</p>
              <p>Доступные стили для панели инструментов <code>1</code>, <code>1-1</code>, <code>1-2</code>,

                <code>2-1</code> и <code>1-1-1</code></p>
            </div>
          </li>
          <li>Обновите <code>openacademy/__openerp__.py</code> для соответствия новым данным file
          </li>
        </ol>
        <div class="pq-patch"><em>openacademy/__openerp__.py</em>
          <div class="pq-section">
            <div class="highlight-python">
              <div class="highlight"><pre>    <span class="s">'version'</span><span class="p">:</span> <span class="s">'0.1'</span><span class="p">,</span>

    <span class="c"># все модули, необходимые для корректной работы</span>
<span class="hll">    <span class="s">'depends'</span><span class="p">:</span> <span class="p">[</span><span class="s">'base'</span><span class="p">,</span> <span class="s">'board'</span><span class="p">],</span>
</span>
    <span class="c"># всегда подгружаемо</span>
    <span class="s">'data'</span><span class="p">:</span> <span class="p">[</span>
</pre></div>
            </div>
            <div class="highlight-python">
              <div class="highlight"><pre>        <span class="s">'views/openacademy.xml'</span><span class="p">,</span>
        <span class="s">'views/partner.xml'</span><span class="p">,</span>
        <span class="s">'views/session_workflow.xml'</span><span class="p">,</span>
<span class="hll">        <span class="s">'views/session_board.xml'</span><span class="p">,</span>
</span>        <span class="s">'reports.xml'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="c"># подгружаемо только в режиме демонстрации</span>
</pre></div>
            </div>
          </div><em>openacademy/views/session_board.xml</em>
          <div class="pq-section">
            <div class="highlight-xml">
              <div class="highlight"><pre><span class="hll"><span class="cp">&lt;?xml version="1.0"?&gt;</span>
</span><span class="hll"><span class="nt">&lt;openerp&gt;</span>
</span><span class="hll">    <span class="nt">&lt;data&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"act_session_graph"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Attendees by course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>graph<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_id"</span>
</span><span class="hll">                   <span class="na">ref=</span><span class="s">"openacademy.openacademy_session_graph_view"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"act_session_calendar"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Sessions<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.session<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>calendar<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_id"</span> <span class="na">ref=</span><span class="s">"openacademy.session_calendar_view"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"act_course_list"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.ui.view"</span> <span class="na">id=</span><span class="s">"board_session_form"</span><span class="nt">&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Session Dashboard Form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"model"</span><span class="nt">&gt;</span>board.board<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"arch"</span> <span class="na">type=</span><span class="s">"xml"</span><span class="nt">&gt;</span>
</span><span class="hll">                <span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">"Session Dashboard"</span><span class="nt">&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;board</span> <span class="na">style=</span><span class="s">"2-1"</span><span class="nt">&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;column&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Attendees by course"</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">"%(act_session_graph)d"</span>
</span><span class="hll">                                <span class="na">height=</span><span class="s">"150"</span>
</span><span class="hll">                                <span class="na">width=</span><span class="s">"510"</span><span class="nt">/&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Sessions"</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">"%(act_session_calendar)d"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/column&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;column&gt;</span>
</span><span class="hll">                            <span class="nt">&lt;action</span>
</span><span class="hll">                                <span class="na">string=</span><span class="s">"Courses"</span>
</span><span class="hll">                                <span class="na">name=</span><span class="s">"%(act_course_list)d"</span><span class="nt">/&gt;</span>
</span><span class="hll">                        <span class="nt">&lt;/column&gt;</span>
</span><span class="hll">                    <span class="nt">&lt;/board&gt;</span>
</span><span class="hll">                <span class="nt">&lt;/form&gt;</span>
</span><span class="hll">            <span class="nt">&lt;/field&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">"ir.actions.act_window"</span> <span class="na">id=</span><span class="s">"open_board_session"</span><span class="nt">&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>Session Dashboard<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"res_model"</span><span class="nt">&gt;</span>board.board<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_type"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_mode"</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"usage"</span><span class="nt">&gt;</span>menu<span class="nt">&lt;/field&gt;</span>
</span><span class="hll">          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"view_id"</span> <span class="na">ref=</span><span class="s">"board_session_form"</span><span class="nt">/&gt;</span>
</span><span class="hll">        <span class="nt">&lt;/record&gt;</span>
</span><span class="hll">
</span><span class="hll">        <span class="nt">&lt;menuitem</span>
</span><span class="hll">            <span class="na">name=</span><span class="s">"Session Dashboard"</span> <span class="na">parent=</span><span class="s">"base.menu_reporting_dashboard"</span>
</span><span class="hll">            <span class="na">action=</span><span class="s">"open_board_session"</span>
</span><span class="hll">            <span class="na">sequence=</span><span class="s">"1"</span>
</span><span class="hll">            <span class="na">id=</span><span class="s">"menu_board_session"</span> <span class="na">icon=</span><span class="s">"terp-graph"</span><span class="nt">/&gt;</span>
</span><span class="hll">    <span class="nt">&lt;/data&gt;</span>
</span><span class="hll"><span class="nt">&lt;/openerp&gt;</span>
</span></pre></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="webservices">
      <h2>Веб сервисы</h2>
      <p>Модуль веб сервисов предоставляет стандартный набор веб сервисов для всех модулей :</p>
      <ul>
        <li>XML-RPC</li>
        <li>JSON-RPC</li>
      </ul>
      <p>Объекты бизнеса также могут быть доступны через объектный механизм. Также их можно изменять через клиентский интерфейс в виде контекстного представления.</p>
      <p>Odoo доступна через интерфейсы XML-RPC/JSON-RPC, имеющими библиотеки на различных языках.</p>
    </section>
    <section id="xml-rpc-library">
      <h3>Библиотека XML-RPC</h3>
      <p>В данном примере отражено взаимодействие программы на Python с библиотекой <code>xmlrpclib</code>:</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="kn">import</span> <span class="nn">xmlrpclib</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">'http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%d</span><span class="s">/xmlrpc/'</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s">'common'</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Logged in as </span><span class="si">%s</span><span class="s"> (uid: </span><span class="si">%d</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>

<span class="c"># СОздаем новую запись</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s">'object'</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'color'</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">'memo'</span> <span class="p">:</span> <span class="s">'This is a note'</span><span class="p">,</span>
    <span class="s">'create_uid'</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s">'note.note'</span><span class="p">,</span> <span class="s">'create'</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
      </div>
      <div role="alert" class="alert-exercise alert">
        <p class="alert-title">Упражнение</p>
        <p>Добавим новую службу к клиенту</p>
        <p>Напишем программу на Python, обеспечивающую отправку XML-RPC запросов к ПК с запущенным. Эта программа должна отображать все сессии с соответствующим количеством seats. Также, она должна создавать новую сессию для одного из courses.</p>
        <div class="highlight-python">
          <div class="highlight"><pre><span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">xmlrpclib</span>
<span class="n">HOST</span> <span class="o">=</span> <span class="s">'localhost'</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">8069</span>
<span class="n">DB</span> <span class="o">=</span> <span class="s">'openacademy'</span>
<span class="n">USER</span> <span class="o">=</span> <span class="s">'admin'</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s">'admin'</span>
<span class="n">ROOT</span> <span class="o">=</span> <span class="s">'http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%d</span><span class="s">/xmlrpc/'</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span><span class="n">PORT</span><span class="p">)</span>

<span class="c"># 1. Login</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="s">'common'</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span><span class="n">USER</span><span class="p">,</span><span class="n">PASS</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"Logged in as </span><span class="si">%s</span><span class="s"> (uid:</span><span class="si">%d</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span><span class="n">uid</span><span class="p">)</span>

<span class="n">call</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
    <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="s">'object'</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">,</span>
    <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c"># 2. Read the sessions</span>
<span class="n">sessions</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span><span class="s">'search_read'</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span><span class="s">'seats'</span><span class="p">])</span>
<span class="k">for</span> <span class="n">session</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Session </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s"> seats)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span> <span class="n">session</span><span class="p">[</span><span class="s">'seats'</span><span class="p">])</span>
<span class="c"># 3.create a new session</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span> <span class="s">'create'</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">'name'</span> <span class="p">:</span> <span class="s">'My session'</span><span class="p">,</span>
    <span class="s">'course_id'</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
        </div>
        <p>Вместо использования тяжелокодируемых ID курсов, можно просто искать курс по имени:</p>
        <div class="highlight-python">
          <div class="highlight"><pre><span class="c"># 3.create a new session for the "Functional" course</span>
<span class="n">course_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s">'openacademy.course'</span><span class="p">,</span> <span class="s">'search'</span><span class="p">,</span> <span class="p">[(</span><span class="s">'name'</span><span class="p">,</span><span class="s">'ilike'</span><span class="p">,</span><span class="s">'Functional'</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="s">'openacademy.session'</span><span class="p">,</span> <span class="s">'create'</span><span class="p">,</span> <span class="p">{</span>
    <span class="s">'name'</span> <span class="p">:</span> <span class="s">'My session'</span><span class="p">,</span>
    <span class="s">'course_id'</span> <span class="p">:</span> <span class="n">course_id</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
        </div>
      </div>
    </section>
    <section id="json-rpc-library">
      <h3>Библиотека JSON-RPC</h3>
      <p>В следующем примера программа на Python взаимодействует с сервером Odoo при помощи стандартных библиотек Python <code>urllib2</code> и <code>json</code>:</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="k">def</span> <span class="nf">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"jsonrpc"</span><span class="p">:</span> <span class="s">"2.0"</span><span class="p">,</span>
        <span class="s">"method"</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
        <span class="s">"params"</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
        <span class="s">"id"</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s">"Content-Type"</span><span class="p">:</span><span class="s">"application/json"</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"error"</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s">"error"</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reply</span><span class="p">[</span><span class="s">"result"</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">"call"</span><span class="p">,</span> <span class="p">{</span><span class="s">"service"</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span> <span class="s">"method"</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s">"args"</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>

<span class="c"># log in the given database</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">/jsonrpc"</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">"common"</span><span class="p">,</span> <span class="s">"login"</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'color'</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">'memo'</span> <span class="p">:</span> <span class="s">'This is another note'</span><span class="p">,</span>
    <span class="s">'create_uid'</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">"object"</span><span class="p">,</span> <span class="s">"execute"</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s">'note.note'</span><span class="p">,</span> <span class="s">'create'</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
      </div>
      <p>А вот та же программа, использующая jsonrpclib:
        <a href="https://pypi.python.org/pypi/jsonrpclib" class="external reference">jsonrpclib</a>:</p>
      <div class="highlight-python">
        <div class="highlight"><pre><span class="kn">import</span> <span class="nn">jsonrpclib</span>

<span class="c"># server proxy object</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">"http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">/jsonrpc"</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">jsonrpclib</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c"># log in the given database</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">"common"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"login"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">])</span>

<span class="c"># helper function for invoking model methods</span>
<span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">server</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">"object"</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"execute"</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

<span class="c"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'color'</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">'memo'</span> <span class="p">:</span> <span class="s">'This is another note'</span><span class="p">,</span>
    <span class="s">'create_uid'</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">invoke</span><span class="p">(</span><span class="s">'note.note'</span><span class="p">,</span> <span class="s">'create'</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
      </div>
      <p>Примеры можно легко перетранслировать из XML-RPC в JSON-RPC.</p>
      <div role="alert" class="alert-info alert">
        <p class="alert-title">Заметка</p>
        <p>В вашем распоряжении имеется огромное количество высокооуровневых APIs для доступа к Odoo на различных языках, работающих без <em>явного</em> обращения к XML-RPC или JSON-RPC, например:</p>
        <ul>
          <li><a href="https://github.com/akretion/ooor" class="external reference alert-link">https://github.com/akretion/ooor</a></li>
          <li><a href="https://github.com/syleam/openobject-library" class="external reference alert-link">https://github.com/syleam/openobject-library</a></li>
          <li><a href="https://github.com/nicolas-van/openerp-client-lib" class="external reference alert-link">https://github.com/nicolas-van/openerp-client-lib</a></li>
          <li><a href="https://pypi.python.org/pypi/oersted/" class="external reference alert-link">https://pypi.python.org/pypi/oersted/</a></li>
        </ul>
      </div>
      <div class="footnote" id="autofields"><span class="footnote-label"><a class="footnote-backref" href="#id2">[1]</a></span> вполне возможно
        <a href="./reference/orm.html#openerp.models.Model._log_access" class="internal reference" title="openerp.models.Model._log_access"><code class="py xref py-attr">автоматическое отключение некоторых полей</code></a>
      </div>
      <div class="footnote" id="rawsql"><span class="footnote-label"><a class="footnote-backref" href="#id1">[2]</a></span> возможно создание прямых запросов к SQL, однако, необходимо очень внимательно пользоваться, так как работает в обход аутентификации Odoo и его защитных механизмов.</div>
    </section>

    </article>
    </div>

    <div id="mask"></div>
  </main>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter42690849 = new Ya.Metrika({
                    id: 42690849,
                    clickmap: true,
                    trackLinks: true,
                    accurateTrackBounce: true,
                    webvisor: true,
                    trackHash: true
                });
            } catch (e) {}
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function() {
                n.parentNode.insertBefore(s, n);
            };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else {
            f();
        }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/42690849" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>

</html>
