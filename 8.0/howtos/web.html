<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Building Interface Extensions &mdash; перевод на русский язык документации odoo 8.0</title>

    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />

    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="перевод на русский язык документации odoo 8.0" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Web Service API" href="../api_integration.html" />
    <link rel="prev" title="Building a Module" href="./backend.html" />
</head>

<body role="document">
    <header class="">
        <figure class="card top">
            <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
        </figure>
    </header>
    <nav id="main_navbar" class="navbar ">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".navbar-main">
                    <span class="sr-only">Навигация</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <nav class="nav navbar-nav navbar-left">
                    <li id="main-back">
                        <a href="../index.html" class="mdi-navigation-arrow-back"></a>
                    </li>
                    <li>
                        <h1 id="main_title">Создание расширений пользовательского интерфейса</h1>
                    </li>
                </nav>
            </div>

            <nav class="collapse navbar-collapse navbar-main navbar-right" role="navigation">

                <ul class="navbar-nav navbar-right nav">
                    <li class="versions">
                        <a class="dropdown-toggle" data-toggle="dropdown">
                8.0 <span class="caret"></span>
              </a>
                        <ul class="dropdown-menu" role="menu">

                            <li><a href="https://www.odoo.com/documentation/9.0/howtos/web.html">9.0</a></li>

                        </ul>
                    </li>
                </ul>

                <ul class="current navbar-nav navbar-right nav">
                    <li class="toctree-l1 current dropdown"><a data-toggle="dropdown" href="../tutorials.html" class="dropdown-toggle internal reference">Руководства</a>
                        <ul class="current dropdown-menu">
                            <li class="toctree-l2"><a href="themes.html" class="internal reference">Создание своей темы</a></li>
                            <li class="toctree-l2"><a href="website.html" class="internal reference">Создание вебсайта</a></li>
                            <li class="toctree-l2"><a href="backend.html" class="current internal reference">Создание модуля</a></li>
                            <li class="current toctree-l2"><a href="" class="internal reference">Создание расширений для интерфейса</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1"><a href="../api_integration.html" class="internal reference">Web Service API</a>
                        <ul></ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../setup.html" class="dropdown-toggle internal reference">Настройка</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../setup/install.html" class="internal reference">Установка Odoo</a></li>
                            <li class="toctree-l2"><a href="../setup/deploy.html" class="internal reference">Развертывание Odoo</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../reference.html" class="dropdown-toggle internal reference">Справка</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="../reference/orm.html" class="internal reference">ORM API</a></li>
                            <li class="toctree-l2"><a href="../reference/data.html" class="internal reference">Файлы с данными</a></li>
                            <li class="toctree-l2"><a href="../reference/actions.html" class="internal reference">Действия</a></li>
                            <li class="toctree-l2"><a href="../reference/views.html" class="internal reference">Представления</a></li>
                            <li class="toctree-l2"><a href="../reference/module.html" class="internal reference">Модули</a></li>
                            <li class="toctree-l2"><a href="../reference/cmdline.html" class="internal reference">Интерфейс коммандной строки: odoo.py</a></li>
                            <li class="toctree-l2"><a href="../reference/security.html" class="internal reference">Безопасность в Odoo</a></li>
                            <li class="toctree-l2"><a href="../reference/testing.html" class="internal reference">Тестирование модулей</a></li>
                            <li class="toctree-l2"><a href="../reference/http.html" class="internal reference">Web Controllers</a></li>
                            <li class="toctree-l2"><a href="../reference/qweb.html" class="internal reference">QWeb</a></li>
                            <li class="toctree-l2"><a href="../reference/javascript.html" class="internal reference">Javascript</a></li>
                            <li class="toctree-l2"><a href="../reference/translations.html" class="internal reference">Перевод Модулей</li>
                            <li class="toctree-l2"><a href="../reference/reports.html" class="internal reference">Печатные формы(Отчеты) на QWeb</a></li>
                            <li class="toctree-l2"><a href="../reference/workflows.html" class="internal reference">Бизнес-процессы</a></li>
                            <li class="toctree-l2"><a href="../reference/guidelines.html" class="internal reference">Методические рекомендации по Odoo</a></li>
                            <li class="toctree-l2"><a href="../reference/upgrade_api.html" class="internal reference">API для обновления</a></li>
                        </ul>
                    </li>
                    <li class="toctree-l1 dropdown"><a data-toggle="dropdown" href="../business.html" class="dropdown-toggle internal reference">Business Mementoes</a>
                        <ul class="dropdown-menu">
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/accounting.html" class="external reference">Accounting Memento (US GAAP)</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/double-entry.html" class="external reference">Double-Entry Inventory</a></li>
                            <li class="toctree-l2"><a href="https://odoo.com/documentation/functional/valuation.html" class="external reference">Inventory Valuations</a></li>
                        </ul>
            </nav>
        </div>
    </nav>


    <main class="container ">

        <div class="row">

            <aside>
                <div class="navbar-aside text-center">
                    <div class="logo_box">
                        <span class="logo"></span> Документация
                    </div>
                    <ul class="list-group text-left nav">
                        <li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">Простой модуль</a></li>
                        <li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo JavaScript модуль</a></li>
                        <li class="list-group-item"><a href="#classes" class="ripple internal reference">Классы</a></li>
                        <li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">Основы Widget</a>
                            <ul>
                                <li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">Ваш первый Widget</a></li>
                                <li class="list-group-item"><a href="#display-content" class="ripple internal reference">Отображение контента</a></li>
                                <li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Родительские и дочерние объекты Widget</a></li>
                                <li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">Уничтожение Widget</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">Генератор шаблонов QWeb</a>
                            <ul>
                                <li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">Использование QWeb</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">QWeb контекст</a></li>
                                        <li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">Объеявление шаблона</a></li>
                                        <li class="list-group-item"><a href="#escaping" class="ripple internal reference">Вывод данных</a></li>
                                        <li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">Вывод HTML</a></li>
                                        <li class="list-group-item"><a href="#conditionals" class="ripple internal reference">Состояния</a></li>
                                        <li class="list-group-item"><a href="#iteration" class="ripple internal reference">Перебор значений</a></li>
                                        <li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">Определение атрибутов</a></li>
                                        <li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">Вызов других шаблонов</a></li>
                                        <li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">Для более глубокого изучения QWeb</a></li>
                                        <li class="list-group-item"><a href="#exercise" class="ripple internal reference">Упражнение</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">Помощники для Widget</a>
                            <ul>
                                <li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference">jQuery Selector для <code >Widget</code></a></li>
                                <li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">Простое связывание DOM событий</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">События и свойства виджета</a>
                            <ul>
                                <li class="list-group-item"><a href="#events" class="ripple internal reference">События</a></li>
                                <li class="list-group-item"><a href="#properties" class="ripple internal reference">Свойства</a></li>
                                <li class="list-group-item"><a href="#id3" class="ripple internal reference">Упражнение</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">Изменение существующих виджетов и классов</a></li>
                        <li class="list-group-item"><a href="#translations" class="ripple internal reference">Система переводов на другие языки</a></li>
                        <li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">Связь с сервером Odoo</a>
                            <ul>
                                <li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">Взаимодействие с моделями данных</a></li>
                                <li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li>
                                <li class="list-group-item"><a href="#queries" class="ripple internal reference">Запросы</a></li>
                            </ul>
                        </li>
                        <li class="list-group-item"><a href="#exercises" class="ripple internal reference">Упражнения</a></li>
                        <li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">Существующие веб-компоненты</a>
                            <ul>
                                <li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">Менеджер действий</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">Использование менеджера действий</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#client-actions" class="ripple internal reference">Действия клиента</a></li>
                                <li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">Архитектура представлений</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">Менеджер представлений</a></li>
                                        <li class="list-group-item"><a href="#the-views" class="ripple internal reference">Представления</a></li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">Поля представления вид Form</a>
                                    <ul>
                                        <li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">Создание нового типа поля</a>
                                            <ul>
                                                <li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">Простое поле только для чтения</a></li>
                                                <li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">Поле для чтения-записи</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">Пользовательские виджеты для представления вида Form</a></li>
                            </ul>
                        </li>
                    </ul>

                    <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/8.0/doc/howtos/web.rst" class="gith-link">
              Доступно на GitHub
          </a></p>

                </div>
            </aside>

            <article class="doc-body ">


                <section id="building-interface-extensions">
                    <p>Это руководство о том, как создавать модули для Odoo веб клиента.</p>
                    <p>Для того, чтобы создавать вебсайт с помощью Odoo, смотрите <a href="website.html" class="internal reference"><em >Создание вебсайта</em></a>; для того чтобы добавить новые бизнес возможности или расширить существующие в Odoo бизнес
                        системы, смотрите <a href="backend.html" class="internal reference"><em >Создание модуля</em></a>.</p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Это руководство предполагает знание:</p>
                        <ul>
                            <li>Основы и рекомендации по использованию Javascript</li>
                            <li><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li>
                            <li><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li>
                        </ul>
                        <p>так требеуется <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span >установленная система Odoo</span></a>, и <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p>
                    </div>
                </section>
                <section id="a-simple-module">
                    <h2>Простой модуль</h2>
                    <p>Давайте наченем с простого модуля, который содержит базовую конфигурацию веб компонентов и позволяет нам тестировать веб-фреймворк.</p>
                    <p>пример доступен онлайн и может быть скачан с помощью следующей команды:</p>
                    <div class="highlight-console">
                        <div class="highlight"><pre><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
                    </div>
                    <p>Данное действие создаст <code>petstore</code> каталог. Далее вам необходимо добавить этот каталог в
                        <a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, для Odoo, создать новую базу данных и установить модуль<code>oepetstore</code>.</p>
                    <p>Если вы просмотрие <code>petstore</code> каталог, вы увидете следующие содержимое:</p>
                    <div class="highlight-text">
                        <div class="highlight"><pre>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __openerp__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
                    </div>
                    <p>Модуль уже содержит некоторые изменения серверной части. мы вернемся к этому чуть позже, а сейчас давайть сфокусируеся на содержимом каталога <code>static</code>, который связан непосрественно с веб отображением.
                    </p>
                    <p>Файлы используемые в &quot;web&quot; части Odoo модуля должны быть помещены в каталог <code>static</code>, для того, чтобы они стали доступны из веб-браузереа файлы, находящиеся вне этого каталога, не могут быть получены браузером
                        напрямую. Подкаталоги <code>src/css</code>, <code>src/js</code> and <code>src/xml</code> не обязаны иметь строго аналогичные названия и имееют такие именя исключительно для удобства разработки.</p>
                    <dl><dt><code >oepetstore/static/css/petstore.css</code></dt>
                        <dd>пока пуст, будет содержать <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> для контента магазина для животных </dd><dt><code >oepetstore/static/xml/petstore.xml</code></dt>
                        <dd>Так же почти пуст, будет содержать <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a> шаблон</dd><dt><code >oepetstore/static/js/petstore.js</code></dt>
                        <dd>
                            <p>Наиболее важная (и интерестная) часть, содержит логику приложения (или по крайнен мере его веб-браузерную часть) как javascript. Должна выглядеть следующим образом:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p>Она выводит небольшое сообщение в коносоль веб-браузера.</p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Все JavaScript файлы объеденены и <a href="../glossary.html#term-minified" class="internal alert-link reference"><span class="std std-term xref">сжаты</span></a> для снижения времени загрузки приложения.</p>
                        <p>Одним из недостатков такого подхода является то, что отладка становится более сложной отдельные файлы исчезают и код становится практически не читаемым. Есть возможность отключить данных процесс путем включения &quot;режима разработчика&quot;:
                            авторизируйтесь в вашей Odoo системе (логин <em>admin</em> пароль
                            <em>admin</em> по умолчанию) откройте меню пользователя (в правом верхнем углу Odoo экрана) и выбирете <span class="guilabel">About Odoo</span> а затем <span class="guilabel">Activate
the developer mode</span>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block">
                        <p>Данный механизм перезагрузит клиент с отключенными механизмами оптимизации, что позволит вести разработку и отладку более комфортно.</p>
                    </div>
                </section>
                <section id="odoo-javascript-module">
                    <h2>Odoo JavaScript модуль</h2>
                    <p>Чистый Javascript сам по себе не имеет встроенных модулей. В результате чего переменные определенные в разных файлах могут смешиваться и конфиликтовать. Такая ситуация привела к тому, что стали появляться различные шаблоны модулей,
                        использование которых помзовляет создавать чистые пространства имен с минимальными рисками конфликтов.</p>
                    <p>Фреймворк Odoo использует такого рода шаблоны для определения модулей внутри своих веб расширений, для уопорядочивания как пространства имен так и правильного порядка загрузки.</p>
                    <p><code>oepetstore/static/js/petstore.js</code> содержит объявление модуля:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <p>В веб части Odoo, модули объявляются как функции присвоенные глобальной переменной <code>openerp</code>. Имя функции должно быть таким же как и расширения(модуля) (в данном случае
                        <code>oepetstore</code>) для того чтобы фреймворк смог найти ее и автоматически инициализировать.</p>
                    <p>Когда веб клиент загружает ваш модуль он вызывает корневую(root) функцию и передают ей два параметра:</p>
                    <ul>
                        <li>первый параметр это текущий экземпляр(инстанс) Odoo веб клиента, это предоставляет доступ к различным возможностям определенными Odoo (переводы, сетевые службы), а так же объектам определенным ядром или другими модулями.
                        </li>
                        <li>второй параметр это ваше собственное пространство имен, которое автомтически созадется самим веб клиентом. Список объектов и переменных, которые должны быть доступны вне вашего модуля (либо из-за того что Odoo веб клиенту необходимо
                            вызывать их, либо другие хотят кастомизировать их) должны быть установлены внутри этого пространства имен.
                        </li>
                    </ul>
                </section>
                <section id="classes">
                    <h2>Классы</h2>
                    <p>В отличие от модулей и вопреки большинству объекто-ориентированных языков, javascript не построен на классах <em>classes</em><a href="#id4" class="footnote-ref" id="id1">1</a> хотя и предоставляет приблизительно эквивалентные (если
                        низкоуровневые и более многословные) мехнанизмы.</p>
                    <p>Для простоты и удобства разработчиков веб часть Odoo предоставляет систему классовн основанную на <a href="http://ejohn.org/blog/simple-javascript-inheritance/" class="external reference">Простое наследование JavaScript</a>.</p>
                    <p>Новые классы определяются вызовом <code class="js-func xref js">extend()</code> метода класса <code class="js-class xref js">openerp.web.Class()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Метод <code class="js-func xref js">extend()</code> принимает словарь, словарь нового класса, в котором содержится описание всего содержимого (методов и статических атрибутов). В данном случаае класс будет иметь только метод <code>say_hello</code>                        который не принимает параметров.</p>
                    <p>Экземпляры класс создаются с помощью оператора <code>new</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Доступ к атрибута экземпляра может быть получен через <code>this</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Классы могут предоставлять инициализатор для выполнения первоначальной настройки экземпляра, через определение метода <code>init()</code>. Инициализатор принимает параметры, переданны при использовании оператора <code>new</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>Так же существует возможность создавать подклассы из существующих (использованны-определенных) классов путем вызова <code class="js-func xref js">extend()</code> для родительского класса, как это делается для подкласса <code class="js-class xref js">Class()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <p>При переопределении метода с использованием наследования вы можете использовать <code>this._super()</code> для вызова оригинального метода:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p><code>_super</code> не является стандарнтым методом, он устанавливаентся "на лету" к следущему метод в текущей цепочке наследования, если таковая имеется. Он определяется только во время <em>синхронных</em> части вызова метода,
                            для вызова в асинхронных обработчиках (после сетевых вызово или в обратных вызовах <code>setTimeout</code>) ссылку на его значение следует хранить, она не будет доступна через <code>this</code>:</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="widgets-basics">
                    <h2>Основы работы с Widget</h2>
                    <p>Odoo веб клиент привязан к <a href="http://jquery.org" class="external reference">jQuery</a> для простой манипуляции DOM моделью. Он полезен и предоставляет API лучше чем стандартный
                        <a href="http://www.w3.org/TR/DOM-Level-3-Core/"
                            class="external reference">W3C DOM</a>
                            <a href="#dombugs" class="footnote-ref" id="id2">2</a>, но не достаточный для структурирования комплексных приложений, что приводит к сложностям в обслуживании.
                    </p>
                    <p>Подобно объектно-ориентированным инструментариям пользовательского интерфейса (например <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a>                        или <a href="http://www.gtk.org" class="external reference">GTK</a>), Odoo Web назначает отдельные компоненты ответственными за отдельные секции страницы. В Odoo web, базой для таких компонентов является класс
                        <a href="../reference/javascript.html#openerp.Widget"
                            class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, специализирующийся на обработке раздела страницы и отображении информации для пользователя.</p>
                </section>
                <section id="your-first-widget">
                    <h3>Ваш первый Widget</h3>
                    <p>В начальном демонстрационном модуле уже есть базовый виджет:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Она расширяет <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> и переопределяет стандартный метод
                        <a href="../reference/javascript.html#openerp.Widget.start"
                            class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>, который как и предыдущий <code>MyClass</code> — пока еще мало что делает.</p>
                    <p>Эта строка в конце файла:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre>
</div>
                    </div>
                    <p>регистрирует наш простой виджет как действие клиента. Действия клиента будут объяснены позже, на данный момент это позволяет нашему виджету быть вызванным и показанным когда мы выбираем пункт меню
                        <span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span>
                    </p>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>т.к. виджет будет вызываться вне нашего модуля, веб клиенту необходимо его &quot;fully qualified&quot; имя, а не локальная его версия.</p>
                    </div>
                </section>
                <section id="display-content">
                    <h3>Отображение контента</h3>
                    <p>Виджеты имеют ряд методов и функций, но основы просты:</p>
                    <ul>
                        <li>настройка виджета</li>
                        <li>формат данных виджета</li>
                        <li>отображение виджета</li>
                    </ul>
                    <p>Виджет <code>HomePage</code> уже имеет метод <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a>. Этот метод является частью жизненного цикла обычного виджета и автоматически вызывается после добавления виджета на страницу. Мы можем использовать его для отображения необходимого нам контента.</p>
                    <p>Все виджеты имеют<a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> который представляет раздел страницы, за который они отвечают (как <a href="http://jquery.org" class="external reference">jQuery</a> объект). Содержимое виджета должно быть вставлено туда. По умолчанию <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> является пустым элементом <code>&lt;div&gt;</code>.</p>
                    <p>Элемент <code>&lt;div&gt;</code> обычно невидим для пользователя, если у него нет контента (или нет определенных стилей, задающих его размер) which поэтому при запуске <code>HomePage</code> ничего не отображается на странице.</p>
                    <p>Давайте добавим немного контента в root элемент виджета, используя jQuery:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Это сообщение появится когда вы откроете пункт меню<span class="menuselection">Pet Store
‣ Pet Store ‣ Home Page</span></p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>для обновления javascript кода, который загружен в Odoo Web, вам необходимо обновить страницу. Нет необходимости перезагружать сервер Odoo.</p>
                    </div>
                    <p>Виджет <code>HomePage</code> используется и управляется Odoo Web автоматически. Для того, чтобы узнать как создавать виджеты &quot;с нуля&quot; давайте создадим новый:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Тпеперь мы можем добавить наш <code>GreetingsWidget</code> к <code>HomePage</code> используя метод
                        <code>GreetingsWidget</code>'s <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <ul>
                        <li>сначала <code>HomePage</code> добавляет свое содержимое в корень DOM </li>
                        <li>затем <code>HomePage</code> создает экземпляр <code>GreetingsWidget</code></li>
                        <li>И в конце он сообщает <code>GreetingsWidget</code> куда вставлять себя, делегируя часть своего <a href="../reference/javascript.html#openerp.Widget._S_el" class="internal reference" title="openerp.Widget.$el"><code class="js-attr xref js">$el</code></a> <code>GreetingsWidget</code>.</li>
                    </ul>
                    <p>Когда вызывается метод <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>, он просит виджет вставить себя в указанную позицию  и отобразить свой контент. Метод<a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> будет вызываться во время вызова <a href="../reference/javascript.html#openerp.Widget.appendTo" class="internal reference" title="openerp.Widget.appendTo"><code class="js-func xref js">appendTo()</code></a>.</p>
                    <p>Чтобы увидеть, что происходит под отображаемым интерфейсом, мы будем использовать DOM Explorer браузера. Но сначала давайте немного изменим наши виджеты, чтобы мы могли легче находить, где они находятся,
                        <a href="../reference/javascript.html#openerp.Widget.className"
                            class="internal reference" title="openerp.Widget.className"><code class="js-attr xref js">добавив класс к их корневым элементам:</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Если вы можете найти соответствующий раздел DOM (щелкните правой кнопкой мыши тексте, затем  выберите <span class="guilabel">Исследовать Элемент</span>), и вы должны увидеть нечто похожее на:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello dear Odoo user!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>We are so happy to see you again in this menu!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Который четко показывает два элемента<code>&lt;div&gt;</code> автоматически созданных <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, потому что мы добавили несколько классов в них.</p>
                    <p>Мы также можем увидеть два div элемента с прикрепленными к ним сообщениями, которые мы добавили сами</p>
                    <p>Наконец, обратите внимание, что элемент<code>&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> который представляет экземпляр <code>GreetingsWidget</code> находящийся <em>внутри</em> <code>&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> предоставленного экземпляра <code>HomePage</code></p>
                </section>
                <section id="widget-parents-and-children">
                    <h3>Родительские и дочерние объекты Widget</h3>
                    <p>В предыдущей части мы создали экземпляр виджета, используя этот синтаксис:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>Первым аргументом является <code>this</code>, который в данном случае был экземпляром <code>HomePage</code>. Это говорит виджету созданному другим виджетом, что он является его <em>родителем</em>.</p>
                    <p>Как мы видели, виджеты обычно вставляются в DOM другими виджетами и As we've seen, widgets are usually inserted in the DOM by another widget and
                        <em>внутри</em> корнегового элемента виджета.  Это означает, что большинство виджетов являются &quot;частью&quot; другого виджета, и существуют от его имени. Мы вызываем <em>родительский</em> контейнер, и помещяем в него <em>дочерний</em> виджет.</p>
                    <p>Из-за многочисленных технических и концептуальных причин виджету необходимо знать, кто его родительские и кто его дочерние объекты</p>
                    <dl><dt><code class="js-func xref js">getParent()</code></dt>
                        <dd>
                            <p>может быть использовано для получения родительского объекта виджета:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                            </div>
                        </dd><dt><code class="js-func xref js">getChildren()</code></dt>
                        <dd>
                            <p>может быть использовано для получения дочернего объекта виджета:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p>При переопределении метода <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> виджета <em>очень важно</em> передать родительскому элементу вызов <code>this._super()</code>, иначе это отношение будет установлено неверно:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>В конце концов если виджет не имеет родительского объекта (т.к. это корневой виджет приложения), в качестве родител может быть указан <code>null</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
                    </div>
                </section>
                <section id="destroying-widgets">
                    <h3>Уничтожение виджетов</h3>
                    <p>Если вы можете показать контент вашим пользователям, то вы так же должны имень возможность его удалить. Это достигается с помощью метода <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
                    </div>
                    <p>Когда виджет уничтожается, он сначала вызывает функцию
                        <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a> всем своим дочерним объектам. А уже потом удаляет себя из DOM.
                        Если вы установили постоянные структуры в
                        <a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a> или
                        <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference"
                            title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> которые должны быть явно очищены (потому что сборщик мусора не будет их обрабатывать), вы можете переопределить
                            <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal reference"
                                title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>.</p>
                    <div role="alert" class="alert-danger alert">
                        <p class="alert-title">Осторожно</p>
                        <p>при переопределении <a href="../reference/javascript.html#openerp.Widget.destroy" class="internal alert-link reference" title="openerp.Widget.destroy"><code class="js-func xref js">destroy()</code></a>, <code>_super()</code>
                            <em>должен всегда</em> вызываться иначе виджет и дочерние элементы не будут очищены правильно, оставляя возможные утечки памяти и &quot;фантомные события&quot;, даже если ошибка не отображается</p>
                    </div>
                </section>
                <section id="the-qweb-template-engine">
                    <h2>Генератор шаблонов QWeb</h2>
                    <p>В предыдущем разделе мы добавляли контент к нашим виджетам, непосредственно манипулируя (и добавляя) их DOM:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>Такой подход позволяет генерировать и отображать любой тип контента, но становится громоздким при генерации значительных объемов DOM (много повторяющихся действий, проблемы с цитированием, ...))</p>
                    <p>Как и во многих других средах, решение Odoo заключается в использовании <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">генератора шаблонов</a>. Генератор шаблонов для Odoo называется QWeb.
                        <a href="../reference/qweb.html#reference-qweb"
                            class="internal reference"><span>QWeb</span></a>.</p>
                    <p>QWeb это язык шаблонов на базе XML, такой же как <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a>                        or <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. Он имеет следующие характеристики:
                    </p>
                    <ul>
                        <li>Он полностью написан на JavaScript и рендерится в браузере</li>
                        <li>каждый файл шаблона (XML файлы) может содержать несколько шаблонов</li>
                        <li>Он имеет специальную поддержку со стороны Odoo Web  <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a>, хотя он может использоватся и вне Odoo веб клиента (и возможно использовать<a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> не полагаясь на QWeb)</li>
                    </ul>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Обоснованием использования QWeb вместо существующих генераторов шаблонов для javascript является расширяемость уже существующих ( а так же произеденных сторонними разработчиками) шаблонов <a href="../reference/views.html#reference-views" class="internal alert-link reference"><span >представлений</span></a>.</p>
                        <p>Большинство генераторов шаблонов javascript основаны на простом тексте, что исключает упрощенную структурную расширяемость, там где основанный на XML генератор шаблонов может быть расширен такими средствами как XPath или CSS и DSL (или даже XSLT). Гибкость и расширяемость такого рода является основной характеристикой Odoo, и ее утрата считается неприемлемой</p>
                    </div>
                </section>
                <section id="using-qweb">
                    <h3>Использование QWeb</h3>
                    <p>Для начала давайте определим простой QWeb шаблон в почти пустом файле
                        <code>oepetstore/static/src/xml/petstore.xml</code>:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                    </div>
                    <p>Теперь мы можем использовать этот шаблон внутри виджета <code>HomePage</code>. Используя переменную загрузчика <code>QWeb</code> определенную в верхней части страницы, мы можем вызвать шаблон определенный в XML файле:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><code class="js-func xref js">QWeb.render()</code> ищет определенный шаблон преобразовывает в строку и возвращает результат.</p>
                    <p>Однако, поскольку <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> имеет специальную интеграцию для QWeb, шаблон можно установить непосредственно в виджете через его атрибут <a href="../reference/javascript.html#openerp.Widget.template" class="internal reference" title="openerp.Widget.template"><code class="js-attr xref js">шаблона</code></a> :</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Хотя результат выглядит похожим, между этими подходами есть два различия:
                    </p>
                    <ul>
                        <li>во второй версией, шаблон выдается непосредственно перед вызовом
                            <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a></li>
                        <li>в первой версии содержимое шаблона добавляется к корневому элементу виджета, тогда как во второй версии корневой элемент шаблона сразу <em>устанавливается как</em> корневой элемент виджета. Вот почему вспомогательный виджет  &quot;привествия&quot; также получает красный фон</li>
                    </ul>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Шаблоны должны иметь один корневой элемент без-<code>t</code>, особенно если они установлены как <a href="../reference/javascript.html#openerp.Widget.template" class="internal alert-link reference" title="openerp.Widget.template"><code class="js-attr xref js">шаблоны</code> виджета </a>. Если емееся несколько &quot;корневых элементов&quot;, результаты не определены (обычно используется только первый корневой элемент, а остальные будут игнорироваться)</p>
                    </div>
                </section>
                <section id="qweb-context">
                    <h4>QWeb контекст</h4>
                    <p>Шаблонам QWeb могут быть предоставлены данные и они могут содержать базовую логику отображения.</p>
                    <p>Для явных вызовов <code class="js-func xref js">QWeb.render()</code>, данные шаблона передаются как второй параметр:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
                    </div>
                    <p>с измененным шаблоном::</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>будет следующий результат:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Klaus<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>При использовании интеграции <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> не представляется возможным предоставить дополнительные данные шаблону. Шаблон будет иметь единственную контекстную переменную <code>виджетов</code>, ссылающуюся на виджет, отображаемый непосредственно перед вызовом метода <a href="../reference/javascript.html#openerp.Widget.start" class="internal reference" title="openerp.Widget.start"><code class="js-func xref js">start()</code></a> (состояние виджета будет по существу состоять в том, что установлено<a href="../reference/javascript.html#openerp.Widget.init" class="internal reference" title="openerp.Widget.init"><code class="js-func xref js">init()</code></a>):</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Result:</p>
                    <div class="highlight-html">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Mordecai<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="template-declaration">
                    <h4>Объявление шаблона</h4>
                    <p>Мы увидели как <em>происходит визуализация</em> шаблона QWeb, теперь давайте посмотри синтаксис самих шаблонов.</p>
                    <p>Шаблон QWeb состоит из обычного XML, смешанного с <em>дериктивами</em> QWeb. Директива QWeb объявляется с атрибутами XML, начинающимися с <code>t-</code>.</p>
                    <p>Самая простая директива это <code>t-name</code>, используемая для объявления новых шаблонов используемых в файле:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                    </div>
                    <p><code>t-name</code> принимает имя определяемого шаблона и объявляет таким образом, что его можно вызвать с помощью <code class="js-func xref js">QWeb.render()</code>. Его можно использовать только на верхнем уровне файла шаблона.</p>
                </section>
                <section id="escaping">

                    <h4>Вывод данных</h4>
                    <p>Директива <code>t-esc</code> может быть использована для вывода текста:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Он принимает вычисляемно выражение Javascript, а затем его результат помещается в HTML-код и вставляется в документ. Поскольку это выражение, то можно указать только имя переменной, как показано выше, или более сложное выражение, например какое либо вычисление:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>или вызов метода:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="outputting-html">
                    <h4>Вывод HTML</h4>
                    <p>Чтобы внедрить HTML-код на отображаемую страницу, используйте <code>t-raw</code>. Подобно <code>t-esc</code> он принимает произвольное Javascript-выражение как параметр, но не выполняет шаг HTML-escape.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-danger alert">
                        <p class="alert-title">Осторожно</p>
                        <p><code>t-raw</code> <em>не должен</em> использоваться для данных, которые могут содержать небезопасный пользовательский контент так как это приводит к уязвимостям <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">межсайтового скриптинга</a>
                        </p>
                    </div>
                </section>
                <section id="conditionals">
                    <h4>Состояния</h4>
                    <p>QWeb может иметь состояния используя блок <code>t-if</code>. Директива принимает произвольное выражение, если выражение не существует (<code>false</code>, <code>null</code>, <code>0</code> или пустая строка) весь блок подавляется, в противном случае он отображается.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>QWeb не имеет &quot;else&quot; структутуры, используйте второй <code>t-if</code> с инвертированным первоначальным условием. Вы можете захотеть сохранить условие в локальной переменной, если это сложное или дорогое выражение.</p>
                    </div>
                </section>
                <section id="iteration">
                    <h4>Перебор значений</h4>
                    <p>Для перебора значений по списку используйте<code>t-foreach</code> и <code>t-as</code>. <code>t-foreach</code> принимает выражение, возвращающее список для итерации по <code>t-as</code> беря имя переменной для привязки к каждому элементу во время итерации.</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p><code>t-foreach</code> так же может быть использован с числами и объектами (словарями)
                        </p>
                    </div>
                </section>
                <section id="defining-attributes">
                    <h4>Определение атрибутов</h4>
                    <p>QWeb предоставляет две связанные директивы для определения вычисленных атрибутов:
                        <code class="samp">t-att-<em >name</em></code> и <code class="samp">t-attf-<em >name</em></code>.  В любом случае, <em>name</em> это имя создаваемого атрибута(например <code>t-att-id</code> определяет
                        <code>id</code> атрибута после визуализации).</p>
                    <p><code>t-att-</code>  принимает выражение javascript, результат которого устанавливается как значение атрибута, наиболее полезно, если вычисляется все значение атрибута:
                    </p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p><code>t-attf-</code> принимает <em>строковый формат</em>. Строковый формат это текст с интерполяционными блоками внутриo интерполяционный блок - это javascript-выражение между <code>{{</code> и <code>}}</code>, который будет заменен результатом выражения. Это особенно полезно для атрибутов, которые частично имеют текстовые значения и частично вычисляемые, например класс:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="calling-other-templates">
                    <h4>Вызов других шаблонов</h4>
                    <p>Шаблоны можно разбить на подшаблоны (для простоты, управляемости, многократного использования или во избежание чрезмерной перегрузки разметки).</p>
                    <p>Это реализовано с помощью <code>t-call</code> директивы, которая принимает имя шаблона для визуализации:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>визуализация <code>A</code> а шаблона даст результат:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
                    </div>
                    <p>Суб-шаблоны наследуют контекст при визуализации вызывающего их объекта..</p>
                </section>
                <section id="to-learn-more-about-qweb">
                    <h4>Для более глубокого изучения QWeb</h4>
                    <p>Для подробной справки по QWeb смотрите <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p>
                </section>
                <section id="exercise">
                    <h4>Упражнение</h4>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Использование QWeb в Widget</p>
                        <p>Создайте виджет, конструктор которого имеет два параметра помимо
                            <code>родителя</code>: <code>product_names</code> и <code>color</code>.</p>
                        <ul>
                            <li><code>product_names</code> должен быть массивом строк, каждая из которых - название продукта
                            </li>
                            <li><code>color</code> строка содержащая цвет в CSS цветовом формате (например:
                                <code>#000000</code> для черного).</li>
                        </ul>
                        <p>Виджет должен отображать названия продуктов друг под другом, каждый в отдельном поле с цветом фона и значением
                            <code>color</code> и границы. Вы должны использовать QWeb для визуализации HTML. Все что касается CSS должно находится  в <code>oepetstore/static/src/css/petstore.css</code>.</p>
                        <p>Используйте виджет в <code>HomePage</code> с полдюжиной продуктов.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">products</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span><span class="p">(</span>
                <span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="s2">&quot;mouse&quot;</span><span class="p">,</span> <span class="s2">&quot;keyboard&quot;</span><span class="p">,</span> <span class="s2">&quot;graphic card&quot;</span><span class="p">,</span> <span class="s2">&quot;screen&quot;</span><span class="p">],</span> <span class="s2">&quot;#00FF00&quot;</span><span class="p">);</span>
            <span class="nx">products</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ProductsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ProductsWidget&quot;</span><span class="p">,</span>
        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">products</span><span class="p">,</span> <span class="nx">color</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">products</span> <span class="o">=</span> <span class="nx">products</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ProductsWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;widget.products&quot;</span> <span class="na">t-as=</span><span class="s">&quot;product&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;oe_products_item&quot;</span>
                      <span class="na">t-attf-style=</span><span class="s">&quot;background-color: {{ widget.color }};&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;product&quot;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/span&gt;</span>
                <span class="nt">&lt;br/&gt;</span>
            <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_products_item</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <a href="../_images/qweb.png" class="internal alert-link reference"><img src="../_images/qweb.png" class="img-responsive center-block"></a>
                    </div>
                </section>
                <section id="widget-helpers">
                    <h2>Помощники для Widget</h2></section>
                <section id="widget-s-jquery-selector">
                    <h3>jQuery Selector для <code >Widget</code></h3>
                    <p>Выбор элементов DOM внутри виджетов можно выполнить, вызвав метод find ()
                        <code>find()</code> в корне DOM виджета:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
                    </div>
                    <p>Но поскольку это обычная операция, <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> предоставляет эквивалентный ярлык через метод the
                        <a href="../reference/javascript.html#openerp.Widget._S_" class="internal reference" title="openerp.Widget.$"><code class="js-func xref js">$()</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-warning alert">
                        <p class="alert-title">Внимание</p>
                        <p>Глобальная функция jQuery <code>$()</code> <em>никогда</em>  не должна использоваться, если она абсолютно не нужна: выбор в корне виджета относится к виджету и локален к нему, но выбор с <code>$()</code> является глобальным для страницы / приложения и может соответствовать частям других виджетов и представлений, поэтому его использование можем привести к случайным или опасным побочным эффектам. Поскольку виджет вообще должен действовать только в разделе DOM, который он имеет, поэтому нет причин для применения механизмов глобального выбора.</p>
                    </div>
                </section>
                <section id="easier-dom-events-binding">
                    <h3>Простое связывание DOM событий</h3>
                    <p>Ранее мы связывали события DOM с помощью обычных обработчиков событий jQuery (например,
                        <code>.click()</code> или <code>.change()</code>) на элементах виджета:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Хотя это метод и работает, у него есть несколько проблем:</p>
                    <ol>
                        <li>он довольно многословный</li>
                        <li>он не поддерживает замену корневого элемента виджета во время выполнения, поскольку привязка выполняется только при запуске <code>start()</code> (во время инициализации виджета)
                        </li>
                        <li>он требует ршения <code>this</code>-связанных проблем</li>
                    </ol>
                    <p>Таким образом, виджеты предоставляют ярлык привязки события DOM через
                        <a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">события</code></a>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><a href="../reference/javascript.html#openerp.Widget.events" class="internal reference" title="openerp.Widget.events"><code class="js-attr xref js">События</code></a> - это объект (отображение) события в функцию или метод для вызова, когда событие инициируется:
</p>
                    <ul>
                        <li>ключ - это имя события, которое может быть уточнено с помощью селектора CSS, и в этом случае, только если событие произойдет в выбранном подэлементе, будет выполняться функция или метод: <code>click</code> будет обрабатывать все клики внутри виджета, но
                            <code>click .my_button</code> будет обрабатывать только клики в элементах с классом <code>my_button</code></li>
                        <li>
                            <p>значение - это действие, которое должно выполняться при срабатывании события</p>
                            <p>это может быть либо функция:</p>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
                            </div>
                            <p>или имя метода объекта (см. пример выше).</p>
                            <p>В любом случае <code>this</code> является экземпляром виджета, а обработчику предоставляется единственный параметр <a href="http://api.jquery.com/category/events/event-object/" class="external reference">объект события jQuery</a>                                для события.
                            </p>
                        </li>
                    </ul>
                </section>
                <section id="widget-events-and-properties">
                    <h2>События и свойства виджета</h2></section>
                <section id="events">
                    <h3>События</h3>
                    <p>Виджеты предоставляют систему событий (отдельно от системы событий DOM / jQuery, описанной выше): виджет может сам запускать события, а другие виджеты (или он сам) могут связываться к вышеуказанному виджету и прослушивать эти события:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Этот виджет выступает в роли фасада, преобразуя входные данные пользователя (через события DOM) во внутреннее событие, для которого родительские виджеты могут связывать себя.
                    </p>
                    <p><code class="js-func xref js">trigger()</code> берет имя события для запуска в качестве его первого (обязательного) аргумента, любые дополнительные аргументы рассматриваются как данные события и передаются непосредственно слушателям.</p>
                    <p>Затем мы можем настроить родительское событие, создающее экземпляр нашего общего виджета, и прослушивать событие  <code>user_chose</code> спользуя метод <code class="js-func xref js">on()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p><code class="js-func xref js">on()</code> связывает функцию, вызываемую, когда событие, идентифицировано <code>event_name</code>. Аргумент <code>func</code> это функция для вызова <code>object</code> - объект, которым связана эта функция, если это метод. Связанная функция будет вызываться с дополнительными аргументами  <code class="js-func xref js">trigger()</code> Если она есть. Пример:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Запуск событий на другом виджетах, как правило, плохая идея. Главным исключением из этого правила является <code>openerp.web.bus</code> который существует специально для трансляций, в которых любой виджет может интересоваться всем веб-приложением Odoo.
                        </p>
                    </div>
                </section>
                <section id="properties">
                    <h3>Свойства</h3>
                    <p>Свойства очень похожи на обычные атрибуты объектов, поскольку они позволяют хранить данные в экземпляре виджетов, однако у них есть дополнительная функция, при которой они запускают события при установке:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
                    </div>
                    <ul>
                        <li><code class="js-func xref js">set()</code> устанавливает значение свойства и запускает
                            <code class="samp">change:<em >propname</em></code> (где <em>propname</em>  это имя свойства, переданное в качестве первого параметра для <code class="js-func xref js">set()</code>) and <code>change</code></li>
                        <li><code class="js-func xref js">get()</code> получает значение свойства.</li>
                    </ul>
                </section>
                <section id="id3">
                    <h3>Упражнение</h3>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Свойства и события виджета</p>
                        <p>Создайте виджет<code>ColorInputWidget</code> который будет отображать 3 <code>&lt;input type=&quot;text&quot;&gt;</code>. Каждый из этих <code>&lt;input&gt;</code>  предназначен для ввода шестнадцатеричного числа от 00 до FF. Когда какой-либо из этих <code>&lt;input&gt;</code> изменяется пользователем, виджет должен запрашивать содержимое трех
                            <code>&lt;input&gt;</code>, соединять их значения, чтобы иметь полный цветовой код CSS (например: <code>#00FF00</code>) и поместить результат в свойство с именем <code>color</code>. Обратите внимание, что событие jQuery <code>change()</code> которое вы можете привязать к любому элементу HTML <code>&lt;input&gt;</code> и метод <code>val()</code>который может запрашивать текущее значение этого <code>&lt;input&gt;</code> могут быть полезны для вас в этом упражнении.</p>
                            <p>Затем измените виджет <code>HomePage</code> чтобы создать экземпляр <code>ColorInputWidget</code> и отобразите его. Виджет <code>HomePage</code> также должен отображать пустой прямоугольник.Этот прямоугольник должен всегда, в любой момент, иметь тот же цвет фона, что и цвет в свойстве <code>color</code> экземпляра <code>ColorInputWidget</code> .</p>
                        <p>Используйте QWeb для генерации всего HTML.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;ColorInputWidget&quot;</span><span class="p">,</span>
        <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="s1">&#39;input_changed&#39;</span>
        <span class="p">},</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">input_changed</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="p">},</span>
        <span class="nx">input_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;#&quot;</span><span class="p">,</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_red&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_green&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_blue&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
            <span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="nx">color</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ColorInputWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color_changed</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="nx">color_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_color_div&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">colorInput</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">));</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;ColorInputWidget&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Red: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_red&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Green: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_green&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
            Blue: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_color_blue&quot;</span> <span class="na">value=</span><span class="s">&quot;00&quot;</span><span class="nt">&gt;&lt;/input&gt;&lt;br</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_color_div&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_color_div</span> <span class="p">{</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="modify-existing-widgets-and-classes">
                    <h2>Изменение существующих виджетов и классов</h2>
                    <p>Система классов веб-фреймворка Odoo позволяет напрямую модифицировать существующие классы с помощью метода <code class="js-func xref js">include()</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
                    </div>
                    <p>Эта система похожа на механизм наследования, за исключением того, что она изменит целевой класс прямо на месте вместо того, чтобы создавать новый.</p>
                    <p>В этом случае  <code>this._super()</code> будет вызывать оригинальную реализацию заменяемого / переопределяемого метода. Если у класса уже есть подклассы, все вызовы <code>this._super()</code> в подклассах вызовут новые реализации, определенные в вызове <code class="js-func xref js">include()</code>. Это также будет работать, если некоторые экземпляры класса (или любого из его подклассов) были созданы до вызова <code class="js-func xref js">include()</code>.</p>
                </section>
                <section id="translations">
                    <h2>Система переводов на другие языки</h2>
                    <p>Процесс преобразования текста в код Python и JavaScript очень похож. Вы могли заметить эти строки в начале файла <code>petstore.js</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
                    </div>
                    <p>Эти строки просто используются для импорта функций перевода в текущий модуль JavaScript. Они используются следующим образом:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
                    </div>
                    <p>В Odoo файлы переводов автоматически генерируются путем сканирования исходного кода. Обнаружен весь кусок кода, вызывающий определенную функцию, и их содержимое добавляется в файл перевода, который затем отправляется переводчикам. В Python, это функция <code>_()</code>. В JavaScript это функция <code class="js-func xref js">_t()</code> (и еще <code class="js-func xref js">_lt()</code>).</p>
                    <p>Функция <code>_t()</code> возвращает перевод, определенный для текста, который задан. Если для этого текста не определен перевод, то она вернет исходный текст как есть.</p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>Чтобы вводить пользовательские значения в переносимые строки, рекомендуется использовать<a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a> с именованными аргументами <em>после</em> перевода:</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
                        </div>
                        <p>Это делает переводы более удобочитаемыми для переводчиков и дает им большую гибкость для изменения порядка или игнорирования параметров.</p>
                    </div>
                    <p><code class="js-func xref js">_lt()</code> (&quot;ленивый перевод&quot;) похож, но несколько более сложен: вместо перевода его параметра сразу, он возвращает объект, который при преобразовании в строку будет выполнять перевод.</p>
                    <p>Данный механизм используется для определения переводимых терминов до инициализации системы переводов, например, для атрибутов класса (поскольку модули загружаются до того, как язык пользователя настроен и загружены переводы)</p>
                </section>
                <section id="communication-with-the-odoo-server">
                    <h2>Связь с сервером Odoo</h2></section>
                <section id="contacting-models">
                    <h3>Взаимодействие с моделями данных</h3>
                    <p>Большинство операций с Odoo связаны со взаимодействием с <em>моделями данных</em>, реализующими бизнес-логику, и эти модели данных будут (потенциально) взаимодействовать с какой либо системой хранения (обычно <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p>
                    <p>Хотя <a href="http://jquery.org" class="external reference">jQuery</a> и предоставляет функцию <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> для сетевого взаимодейтсвия, для связи с Odoo требуются дополнительные метаданные настройка которых перед каждым вызовом будет многословной и подверженной ошибкам. В результат веб клиент Odoo предоставляет примитивы связи более высокого уровня.</p>
                    <p> Чтобы продемонстрировать это, файл  <code>petstore.py</code> aуже содержит небольшую модель с примером метода:</p>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">:</span> <span class="s">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
                    </div>
                    <p>В этом примере объявлена модель данных с двумя полями, и методом <code>my_method()</code> который возвращает словарь литералов.</p>
                    <p>Вот пример виджета, который вызывает  <code>my_method()</code> и отображает результат:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Класс, используемый для вызова моделей Odoo<a href="../reference/javascript.html#openerp.Model" class="internal reference" title="openerp.Model"><code class="js-class xref js">openerp.Model()</code></a>.Он создается с именем модели Odoo в качестве первого параметра (
                        <code>oepetstore.message_of_the_day</code> в нашем случае).</p>
                    <p><code class="js-func xref js">call()</code> можно использовать для вызова любого (публичного) метода модели Odoo. Он принимает следующие позиционные аргументы:</p>
                    <dl><dt><code >name</code></dt>
                        <dd>Имя вызваемого метода, <code>my_method</code></dd><dt><code >args</code></dt>
                        <dd>
                            <p>массив <a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">позиционных аргументов</a> для предоставления метода.Поскольку пример не имеет позиционного аргумента, параметр <code>args</code> не предоставляется.
                            </p>
                            <p>Вот другой пример с позиционными аргументами:</p>
                            <div class="highlight-python">
                                <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                            </div>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                            </div>
                        </dd><dt><code >kwargs</code></dt>
                        <dd>
                            <p>Отображение<a href="https://docs.python.org/2/glossary.html#term-argument" class="external reference">аргументов колючевого слова</a> для передачи. В примере представлен одиночный аргумент. <code>контекста</code>.</p>
                            <div class="highlight-python">
                                <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
                            </div>
                            <div class="highlight-javascript">
                                <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
                            </div>
                        </dd>
                    </dl>
                    <p><code class="js-func xref js">call()</code> возвращает отложенное разрешенное значение, возвращаемое методом модели данных в качестве первого аргумента.</p>
                </section>
                <section id="compoundcontext">
                    <h3>CompoundContext</h3>
                    <p>Предыдущий раздел использовал аргумент <code>контекста</code> который не был объяснен в вызове метода:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
                    </div>
                    <p>Контекст подобен &quot;магическому&quot; аргументу, который веб-клиент всегда будет выдавать серверу при вызове метода. Контекст - это словарь, содержащий несколько ключей. Одним из наиболее важных ключей является язык пользователя, используемый сервером для перевода всех сообщений приложения. Другой - часовой пояс пользователя, используемый для правильного вычисления дат и времени, для одновременного использования Odoo людьми в находящихся в разных странах.</p>
                    <p> <code>Аргумент</code> необходим во всех методах, в противном случае могут произойти плохие вещи (например, приложение неправильно переводится). Вот почему, когда вы вызываете метод модели данных, вы всегда должны предоставлять этот аргумент. Решением этого является использование<code class="js-class xref js">openerp.web.CompoundContext()</code>.</p>
                    <p><code class="js-class xref js">CompoundContext()</code> это класс, используемый для передачи пользователю контекста (с языком, часовым поясом и т. Д.) На сервер, а также добавление новых ключей в контекст (в некоторых моделях данных используются произвольные ключи, добавленные в контекст). Он создается путем предоставления его конструктору любого количества словарей или других экземпляров <code class="js-class xref js">CompoundContext()</code>.  Он объединит все эти контексты перед отправкой их на сервер.</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
                    </div>
                    <div class="highlight-python">
                        <div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;lang&#39;</span><span class="p">:</span> <span class="s">&#39;en_US&#39;</span><span class="p">,</span> <span class="s">&#39;new_key&#39;</span><span class="p">:</span> <span class="s">&#39;key_value&#39;</span><span class="p">,</span> <span class="s">&#39;tz&#39;</span><span class="p">:</span> <span class="s">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
                    </div>
                    <p>Вы можете видеть, что словарь в <code>контексте</code> одержит некоторые ключи, которые связаны с конфигурацией текущего пользователя в Odoo плюс ключ <code>new_key</code> который был добавлен при создании <code class="js-class xref js">CompoundContext()</code>.</p>
                </section>
                <section id="queries">
                    <h3>Запросы</h3>
                    <p>В то время как <a href="../reference/javascript.html#openerp.Model.call" class="internal reference" title="openerp.Model.call"><code class="js-func xref js">call()</code></a> достаточен для любого взаимодействия с моделями данных Odoo, Odoo Web предоставляет помощника для более простого и ясного формирования запросов к моделям данных (выборки записей на основе различных условий):
                        <a href="../reference/javascript.html#openerp.Model.query" class="internal reference" title="openerp.Model.query"><code class="js-func xref js">query()</code></a> который действует как сокращение до простой комбинации
                        <a href="../reference/orm.html#openerp.models.Model.search"
                            class="internal reference" title="openerp.models.Model.search"><code class="py py-meth xref">search()</code></a> и :
                            <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>. Он обеспечивает более четкий синтаксис для поиска и чтения моделей данных:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>против:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
                    </div>
                    <ul>
                        <li><code class="js-func xref js">query()</code> принимает необязательный список полей в качестве параметра (если не указано ни одного поля, выбираются все поля модели данных). Он возвращает
                            <a href="../reference/javascript.html#openerp.web.Query" class="internal reference"
                                title="openerp.web.Query"><code class="js-class xref js">openerp.web.Query()</code></a> который может быть дополнительно настроен перед выполнением</li>
                        <li><a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> представляет собой построенный запрос. Он неизменен, методы для настройки запроса фактически возвращают измененную копию, поэтому можно использовать оригинальную и новую версии бок о бок. Смотрите
                            <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> для настройки его параметров .</li>
                    </ul>
                    <p>Когда запрос настроен так как вам нужно, просто вызовите функцию
                        <a href="../reference/javascript.html#openerp.web.Query.all" class="internal reference" title="openerp.web.Query.all"><code class="js-func xref js">all()</code></a> чтобы выполнить его, и верните отложенный вызов к его результату. Результат - то же самое, что и
                        <a href="../reference/orm.html#openerp.models.Model.read" class="internal reference" title="openerp.models.Model.read"><code class="py py-meth xref">read()</code></a>, массив словарей, где каждый словарь является запрошенной записью, при этом каждое запрошенное поле является словарным ключом.</p>
                </section>
                <section id="exercises">
                    <h2>Упражнения</h2>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Послание дня</p>
                        <p>Создайте виджет <code>MessageOfTheDay</code> тображающий последнюю запись модели данных <code>oepetstore.message_of_the_day</code>. Виджет должен получать свою запись сразу после ее отображения.</p>
                        <p>Отобразите виджет на домашней странице Pet Store</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;MessageOfTheDay&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">},</span>
    <span class="p">});</span>

<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Список игрушек для домашних животных</p>
                        <p>Создайте виджет<code>PetToysList</code>, отображающий 5 игрушек (используя их имя и их изображения)..</p>
                        <p>Игрушки для животных не хранятся в новой модели, вместо этого они хранятся в
                            <code>product.product</code> с использованием специальной категории <em>Pet Toys</em>. Вы можете увидеть заранее сгенерированные игрушки и добавить новые, зайдя в
                            <span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. Вам, вероятно, понадобится изучить <code>product.product</code> чтобы создать правильный домен, чтобы выбрать только игрушки для домашних животных.</p>
                        <p>В Odoo, изображения обычно хранятся в обычных полях, закодированных как
                            <a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML поддерживает вывод изображений прямо из base64 с помощью <code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p>
                        <p>The <code>PetToysList</code> Виджет PetToysList должен отображаться на домашней странице справа от виджета <code>MessageOfTheDay</code>. Для этого вам понадобится сделать макет с CSS.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePage&quot;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_left&#39;</span><span class="p">)),</span>
                <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.oe_petstore_homepage_right&#39;</span><span class="p">))</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">MessageOfTheDay</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;MessageOfTheDay&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;oepetstore.message_of_the_day&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">order_by</span><span class="p">(</span><span class="s1">&#39;-create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;-id&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">first</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_mywidget_message_of_the_day&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
                <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                    <span class="p">});</span>
                <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePage&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_left&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage_right&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;MessageOfTheDay&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_motd&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">&quot;oe_mywidget_message_of_the_day&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToysList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoyslist&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
            <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-att-src=</span><span class="s">&quot;&#39;data:image/jpg;base64,&#39;+item.image&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_petstore_homepage</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_left</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_homepage_right</span> <span class="p">{</span>
    <span class="k">display</span><span class="o">:</span> <span class="k">table-cell</span><span class="p">;</span>
    <span class="k">width</span> <span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_motd</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoyslist</span> <span class="p">{</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.oe_petstore_pettoy</span> <span class="p">{</span>
    <span class="k">margin</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="k">background-color</span><span class="o">:</span> <span class="m">#F0EEEE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="existing-web-components">
                    <h2>Существующие веб-компоненты</h2></section>
                <section id="the-action-manager">
                    <h3>Менеджер действий</h3>
                    <p>В Odoo,многие операции начинаются с <a href="../reference/actions.html#reference-actions" class="internal reference"><span >действия</span></a>: открытие элемента меню (для вида), печать отчета, ... </p>
                    <p>Действия - это фрагменты данных, описывающие реакцию клиента на активацию части содержимого. Действия могут быть сохранены (и считаны с помощью модели данных), или они могут быть сгенерированы «на лету» (локально для клиента кодом javascript или дистанционно с помощью метода модели данных).</p>
                    <p>В Odoo Web,  компонентом, ответственным за обработку и реакцию на эти действия, является <em>Менеджер действий.</em>.</p>
                </section>
                <section id="using-the-action-manager">
                    <h4>Использование менеджера действий</h4>
                    <p>Менеджер действий может быть явно вызван из кода javascript, создав словарь, описывающий <a href="../reference/actions.html#reference-actions" class="internal reference"><span >действие</span></a> нужного типа, и вызов экземпляра менеджера действий вместе с ним.</p>
                    <p><code class="js-func xref js">do_action()</code> это ссылка <a href="../reference/javascript.html#openerp.Widget" class="internal reference" title="openerp.Widget"><code class="js-class xref js">Widget()</code></a> просматривающий
                         &quot;текущий&quot; менеджер действий и выполняющий действие:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                    </div>
                    <p>Наиболее распространенный <code>тип</code> действия <code>ir.actions.act_window</code> который предоставляет представления к модели (отображает модель различными способами), ее наиболее распространенными атрибутами являются:</p>
                    <dl><dt><code >res_model</code></dt>
                        <dd>Модель для отображения в представлениях</dd>
                        <dt><code >res_id</code> (необязательно)</dt>
                        <dd>Для представлений вида Form предварительно выбранная запись <code>res_model</code></dd>
                        <dt><code >Представления</code></dt>
                        <dd>Список представлений доступен через действие. Список
                            <code>[view_id, view_type]</code>, <code>view_id</code> может быть либо идентификатором представления правильного типа в базе данных , либо <code>false</code> чтобы использовать представление по умолчанию для указанного типа. Типы представлений не могут присутствовать несколько раз. Действие по умолчанию откроет первое представление из списка.</dd>
                            <dt><code >target</code></dt>
                        <dd>Либо <code>current </code> (по умолчанию) который заменяет раздел &quot;content&quot; веб-клиента действием, либо <code>new </code>  чтобы открыть действие в диалоговом окне </dd>
                        <dt><code >context</code></dt>
                        <dd>Дополнительные данные контекста для использования в действии.</dd>
                    </dl>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Перейти к продукту</p>
                        <p>Измените компонент <code>PetToysList</code> оэтому нажатие на игрушку заменяет домашнюю страницу видом формы игрушки.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">PetToysList</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;PetToysList&#39;</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .oe_petstore_pettoy&#39;</span><span class="o">:</span> <span class="s1">&#39;selected_item&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s1">&#39;product.product&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">])</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;categ_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;Pet Toys&quot;</span><span class="p">]])</span>
            <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">all</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_</span><span class="p">(</span><span class="nx">results</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;PetToy&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">item</span><span class="o">:</span> <span class="nx">item</span><span class="p">}));</span>
                <span class="p">});</span>
            <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">selected_item</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s1">&#39;product.product&#39;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;PetToy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_pettoy&quot;</span> <span class="na">t-att-data-id=</span><span class="s">&quot;item.id&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;item.name&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
        <span class="nt">&lt;p&gt;&lt;img</span> <span class="na">t-attf-src=</span><span class="s">&quot;data:image/jpg;base64,{{item.image}}&quot;</span><span class="nt">/&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="client-actions">
                    <h3>Действия клиента</h3>
                    <p>В этом руководстве мы использовали простой виджет <code>HomePage</code>  который автоматически запускается веб-клиентом, когда мы выбираем нужный пункт меню. Но как веб-клиент Odoo узнал о том, что нужно запустить именно этот виджет? Это потому, что виджет зарегистрирован как <em>действие клиента</em>.</p>
                    <p>Клиентское действие (как следует из его названия) является типом действия, определенным почти полностью в клиенте, в javascript для веб-клиента Odoo. Сервер просто отправляет тег действия (произвольное имя) и, при необходимости, добавляет несколько параметров, но помимо этого <em>всё</em> обрабатывается пользовательским кодом клиента.</p>
                    <p>Наш виджет зарегистрирован как обработчик для действия клиента следующим образом:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p><code>instance.web.client_actions</code> это <code class="js-class xref js">Registry()</code> в котором менеджер действий ищет обработчики действий клиента, когда ему нужно его выполнить. Первый параметр  <code class="js-class xref js">add()</code> это имя (тег) действия клиента, а вторым параметром является путь к виджету из корня веб-клиента Odoo.</p>
                    <p>Когда клиентское действие должно быть выполнено, менеджер действий ищет свой тег в реестре, проходит указанный путь и отображает виджет, который он находит в конце.</p>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <p>обработчик действий клиента также может быть регулярной функцией, в случае, когда он будет вызван, и его результат (если он есть) будет интерпретироваться как следующее действие для выполнения.</p>
                    </div>
                    <p>На стороне сервера мы просто определили действие <code>ir.actions.client</code>:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
                    </div>
                    <p>добавляем действие в нужный пункт меню:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
                    </div>
                </section>
                <section id="architecture-of-the-views">
                    <h3>Архитектура представлений</h3>
                    <p>Значительная часть полезносных качест (и соотвественно возникающих с этим сложностей) веб-клиента Odoo находится в представлениях. Каждый тип представления - это способ отображения модели на клиенте.</p>
                </section>
                <section id="the-view-manager">
                    <h4>Менеджер представлений</h4>
                    <p>Когда экземпляр <code>ActionManager</code> получает действие типа <code>ir.actions.act_window</code>, он делегирует синхронизацию и обработку самих представлений <em>менеджеру представлений</em>, который затем настраивает одно или несколько представлений в зависимости от требований исходного действия:</p>
                    <a href="../_images/viewarchitecture.svg" class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a>
                </section>
                <section id="the-views">
                    <h4>Представления</h4>
                    <p>Большинство <a href="../reference/views.html#reference-views" class="internal reference"><span >представлений Odoo</span></a> реализованы через подкласс <code class="js-class xref js">openerp.web.View()</code> который предоставляет немного общей базовой структуры для обработки событий и отображения информации о модели.</p>
                    <p><em>Представление поиска</em> считается основным типом представления в Odoo фреймворке, но обрабатывается отдельно веб-клиентом (как правило оно является постоянным и может взаимодействовать с другими представлениями, чего не делают обычные представления)..</p>
                    <p>Представление отвечает за загрузку собственного XML описания (с помощью <a href="../reference/orm.html#openerp.models.Model.fields_view_get" class="internal reference" title="openerp.models.Model.fields_view_get"><code class="py xref py-class">fields_view_get</code></a>) и любого другого источника данных, в котором он нуждается. С этой целью представления оснащаются необязательным идентификатором представления, заданным как атрибут <code class="js-attr xref js">view_id</code>.</p>
                    <p>Представления также оснащаются экземпляром <code class="js-class xref js">DataSet()</code> который содержит самую необходимую информацию о модели данных (ее название и, возможно, различные идентификаторы записи).</p>
                    <p>Представления также могут обрабатывать поисковые запросы путем переопределения
                        <code class="js-func xref js">do_search()</code>, и при необходимости обновлять свой
                        <code class="js-class xref js">DataSet()</code>.</p>
                </section>
                <section id="the-form-view-fields">
                    <h3>Поля представления вид Form</h3>
                    <p>Обычной потребностью является расширение представления вида Form для добавления новых способов отображения полей.</p>
                    <p>Все встроенные поля имеют реализацию отображения по умолчанию, новый виджет формы может понадобиться для правильного взаимодействия с новым типом поля (например, поле <a href="../glossary.html#term-gis" class="internal reference"><span class="std std-term xref">ГИС</span></a>) или для предоставления новых образов и способов взаимодействия с существующими типами полей (например, проверки полей
                        <a href="../reference/orm.html#openerp.fields.Char" class="internal reference" title="openerp.fields.Char"><code class="py xref py-class">Char</code></a> который должен содержать адреса электронной почты и отображать их в виде сообщений электронной почты.</p>
                    <p>Чтобы явно указать, какой вид виджета следует использовать для отображения поля, просто используйте атрибут<code>widget</code>  в XML описании представления:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
                    </div>
                    <div role="alert" class="alert-info alert">
                        <p class="alert-title">Примечание</p>
                        <ul>
                            <li>один и тот же виджет представления вида Form используется как в режиме &quot;просмотра&quot; (только для чтения) и &quot;редактирования&quot;, нельзя использовать один виджет для одного режима а другой для другого</li>
                            <li>одно и тоже поле(имя поля) нельзя использовать в представлении вида Form</li>
                            <li>Виджет может игнорировать текущий режим представления вида Form и может оставаться неизменным как в режиме просмотра, так и в режиме редактирования</li>
                        </ul>
                    </div>
                    <p>Поля создаются экземпляром представления вида Form после того, как оно прочитало свое XML описание  и сформирован соответствующий HTML код, представляющий это описание. После этого представление вида Form будет взаимодействовать с объектами поля с использованием методов. Эти методы определены интерфейсом<code>FieldInterface</code>. Почти все поля наследуют абстрактный класс <code>AbstractField</code>.  Этот класс определяет некоторые механизмы по умолчанию, которые должны быть реализованы большинством полей.</p>
                    <p>Вот некоторые из обязанностей класса поля:</p>
                    <ul>
                        <li>Класс поля должен отображать и разрешать пользователю редактировать значение поля.</li>
                        <li>
                            <p>Он должен правильно реализовать 3 атрибута поля, доступных во всех полях Odoo. Класс <code>AbstractField</code> уже реализует алгоритм, который динамически вычисляет значение этих атрибутов (они могут измениться в любой момент, потому что их значение изменяется в соответствии со значением других полей). Эти значения хранятся в <em>Widget Properties</em>  (свойства виджета были объяснены ранее в этом руководстве). Каждый класс поля несет ответственность за проверку свойств виджета и динамическую адаптацию в зависимости от их значений. Вот описание каждого из этих атрибутов
                            </p>
                            <ul>
                                <li><code>required</code>:  поле должно иметь значение перед сохранением. Если <code>required</code> емеет значение <code>true</code> и поле не имеет значения, метод поля <code>is_valid()</code> должен возвращать <code>false</code>.</li>
                                <li><code>invisible</code>: Когда <code>true</code>, поле должно быть невидимым. Класс
                                    <code>AbstractField</code> уже имеет базовую реализацию этого поведения, которая подходит для большинства полей.</li>
                                <li><code>readonly</code>: Когда <code>true</code>, поле не должно давать пользователю отредактировать себя. Большинство полей Odoo  имеют совершенно другое поведение в зависимости от значения <code>readonly</code>.Например <code>FieldChar</code> отображает HTML <code>&lt;input&gt;</code> когда он редактируемый, и просто отображает текст, когда он доступен только для чтения. Это также означает, что у него гораздо больше кода, который ему потребуется для реализации только одного поведения, но это необходимо для обеспечения хорошего пользовательского опыта.
                                </li>
                            </ul>
                        </li>
                        <li>Поля имеют два метода <code>set_value()</code> и <code>get_value()</code>, которые вызываются представлением вида Form, чтобы придать ему значение для отображения и возврата к новому значению, введенному пользователем. Эти методы должны уметь обрабатывать значение, заданное сервером Odoo, когда выполняется функция <code>read()</code> для модели данных и возвращать допустимое значение для <code>write()</code>. Помните, что типы данных JavaScript / Python, используемые для представления значений, заданных <code>read()</code> и заданных
                            <code>write()</code> не обязательно должны быть одинаковы в Odoo. Например, когда вы читаете many2one, это всегда кортеж, первым значением которого является идентификатор указанной записи, а вторым является имя (например: <code>(15, &quot;Agrolait&quot;)</code>).
                            Но когда вы делаете запись в many2one, это должно быть одно целое число, а не кортеж. <code>AbstractField</code> имеет реализацию этих методов по умолчанию, которая хорошо работает для простых типов данных и устанавливает свойство виджета с именем <code>value</code>.</li>
                    </ul>
                    <p>Обратите внимание, что для лучшего понимания того, как реализовать поля, вам настоятельно рекомендуется посмотреть определение интерфейса <code>FieldInterface</code> и класса <code>AbstractField</code> непосредственно в коде веб клиента Odoo.
                    </p>
                </section>
                <section id="creating-a-new-type-of-field">
                    <h4>Создание нового типа поля</h4>
                    <p>В этой части мы объясним, как создать новый тип поля. Примером здесь будет повторная реализация класса <code>FieldChar</code> и постепенное объяснение каждой части.</p>
                </section>
                <section id="simple-read-only-field">
                    <h5>Простое поле только для чтения</h5>
                    <p>Вот первая реализация, которая будет отображать только текст. Пользователь не сможет изменять содержимое поля.</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p>В этом примере мы объявляем класс с именем <code>FieldChar2</code> который является наследником <code>AbstractField</code>.Мы также регистрируем этот класс в реестре <code>instance.web.form.widgets</code> с ключом <code>char2</code>.  Это позволит нам использовать это новое поле в любом представлении вида Form, указав <code>widget=&quot;char2&quot;</code> в теге <code>&lt;field/&gt;</code> при создании XML описании представления.</p>
                    <p>В этом примере мы определяем единственный метод: <code>render_value()</code>. Все, что он делает - так это отображает <code>value</code> свойства виджета. Это два инструмента, определенные классом <code>AbstractField</code>. Как объяснялось ранее, представление вида Form вызовет метод поля <code>set_value()</code>, чтобы установить отображаемое значение. У этого метода уже есть реализация по умолчанию в <code>AbstractField</code>которая просто устанавливает <code>value</code> свойства виджета. <code>AbstractField</code> также смотрит событие <code>change:value</code> направленное на себя и вызывает <code>render_value()</code>когда это происходит. Таким образом, <code>render_value()</code>  это удобный метод для реализации в дочерних классах выполнения некоторых операции каждый раз, когда изменяется значение поля.</p>
                    <p>В методе <code>init()</code>, мы также определяем значение поля по умолчанию, если в представлении формы не указано ни одного (здесь мы предполагаем, что значение по умолчанию поля <code>char</code> должно быть пустой строкой).</p>
                </section>
                <section id="read-write-field">
                    <h5>Поле для чтения-записи</h5>
                    <p>Поля, доступные только для чтения, которые отображают только контент и не позволяют пользователю изменять его, могут быть полезны, однако большинство полей в Odoo также позволяют себя редактировать. Это усложняет реализацию классов полей, главным образом потому, что поля должны обрабатывать как редактируемый, так и нередактируемый режим, эти режимы часто совершенно разные (для целей дизайна и удобства использования), и поля должны иметь возможность переключаться между режимами в любой момент.</p>
                    <p>Чтобы узнать, в каком режиме должно быть текущее поле, класс <code>AbstractField</code> задает свойство виджета с именем <code>effective_readonly</code>. Поле должно следить за изменениями в этом свойстве виджета и соответственно отображать правильный режим. Например:
                    </p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                    </div>
                    <p>В методе start <code>start()</code> (который вызывается сразу же после добавления виджета в DOM), мы связываемся с изменением события: <code>change:effective_readonly</code>.Это позволяет нам повторно отображать поле каждый раз, когда свойство виджета изменяет значение     <code>effective_readonly</code>. Этот обработчик будет вызывать<code>display_field()</code>, который также вызывается непосредственно в <code>start()</code>. Этот <code>display_field()</code> был создан специально для этого поля, это не метод, определенный в <code>AbstractField</code> или любом другом классе. Мы можем использовать этот метод для отображения содержимого поля в зависимости от текущего режима.</p>
                    <p>С этого момента концепция этого поля является типичной, за исключением того, что есть много проверок, чтобы узнать состояние свойства  <code>effective_readonly</code>:</p>
                    <ul>
                        <li>В шаблоне QWeb используемом для отображения содержимого виджета, он отображает <code>&lt;input type=&quot;text&quot; /&gt;</code> если мы находимся в режиме чтения-записи и ничего, если в режиме только для чтения.</li>
                        <li>В методе <code>display_field()</code>  мы должны привязать событие <code>change</code> для <code>&lt;input type=&quot;text&quot; /&gt;</code> чтобы знать, когда пользователь изменил значение. Когда это произойдет, мы вызываем метод <code>internal_set_value()</code>с новым значением поля. Это удобный метод, предоставляемый классом <code>AbstractField</code> Этот метод установит новое значение в свойстве <code>value</code>  но не вызовет вызов <code>render_value()</code> (это необязательно, поскольку <code>&lt;input type=&quot;text&quot; /&gt;</code> уже содержит правильное значение).
                        </li>
                        <li>В <code>render_value()</code>, мы используем совершенно другой код для отображения значения поля в зависимости от того, находимся ли мы в режиме только для чтения или в режиме чтения-записи.</li>
                    </ul>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Создание цветового поля</p>
                        <p>Создайте класс <code>FieldColor</code>. Значение этого поля должно быть строкой, содержащей код цвета, подобный используемому в CSS (пример: <code>#FF0000</code>  для красного цвета). В режиме только для чтения это цветовое поле должно отображать небольшой блок, цвет которого соответствует значению поля. В режиме чтения-записи вы должны отобразить  <code>&lt;input type=&quot;color&quot; /&gt;</code>. Этот тип  <code>&lt;input /&gt;</code> является компонентом HTML5, который работает не во всех браузерах, но хорошо работает в Google Chrome. Так что это нормально использовать в качестве упражнения.</p><p>Этот виджет можно использовать в виде формы модели данных <code>message_of_the_day</code> для его поля с именем <code>color</code>. В качестве бонуса вы можете изменить виджет <code>MessageOfTheDay</code> созданный в предыдущей части этого руководства, чтобы отобразить сообщение дня с цветом фона, указанным в поле <code>color</code>.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldColor</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;change input&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;effective_readonly&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldColor&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.oe_field_color_content&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;#FFFFFF&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldColor&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldColor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_color_content&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;color&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                        <div class="highlight-css">
                            <div class="highlight"><pre><span class="nc">.oe_field_color_content</span> <span class="p">{</span>
    <span class="k">height</span><span class="o">:</span> <span class="m">20px</span><span class="p">;</span>
    <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="nb">black</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
                        </div>
                    </div>
                </section>
                <section id="the-form-view-custom-widgets">
                    <h3>Пользовательские виджеты для представления вида Form</h3>
                    <p>Поля представления вида Form используются для редактирования одного поля и в основном связаны с этим полем. Поскольку это может быть ограничением, также возможно создавать<em>виджеты для представления вида Form</em> которые не являются настолько ограниченными и имеют меньше связей с конкретным жизненным циклом.
                    </p>
                    <p>Пользовательские виджеты для представления вида Form могут быть добавлены через тег <code>widget</code>:</p>
                    <div class="highlight-xml">
                        <div class="highlight"><pre><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
                    </div>
                    <p>Этот тип виджета будет просто создан представлением вида Form во время генерации HTML в соответствии с определением в XML описании. Они имеют общие свойства с полями (например, свойство <code>effective_readonly</code>  но им не присвоено точное поле. И поэтому они не имеют методов, таких как
                        <code>get_value()</code> и <code>set_value()</code>. Они должны наследоваться от абстрактного класса<code>FormWidget</code>.</p>
                    <p>Пользовательские виджеты для представления вида Form могут взаимодействовать с полями, слушая их изменения и получая или изменяя их значения. Они могут обращаться к полям представления через атрибут <code class="js-attr xref js">field_manager</code>:</p>
                    <div class="highlight-javascript">
                        <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
                    </div>
                    <p><code class="js-attr xref js">FormWidget</code> сам обычно является
                        <code class="js-class xref js">FormView()</code>, но используемые в нем функции должны быть ограничены функциями, определенными <code class="js-class xref js">FieldManagerMixin()</code>, наиболее полезным образом:</p>
                    <ul>
                        <li><code class="js-func xref js">get_field_value(field_name)()</code>  которое возвращает значение поля.</li>
                        <li><code class="js-func xref js">set_values(values)()</code> устанавливает несколько значений поля, принимает отображение <code>{field_name: value_to_set}</code></li>
                        <li>Событие <code class="samp">field_changed:<em >field_name</em></code> запускается каждый раз, когда изменяется значение поля с именем <code>field_name</code></li>
                    </ul>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Показать координаты на карте Google</p>
                        <p>Добавьте два поля <code>product.product</code> сохраняющих широту и долготу, а затем создайте новый виджет формы, чтобы отобразить широту и долготу происхождения товара на карте.</p>
                        <p>Чтобы отобразить карту, используйте механизм интеграции Google Map в свой сайт:</p>
                        <div class="highlight-html">
                            <div class="highlight"><pre><span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span> <span class="na">src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/iframe&gt;</span>
</pre></div>
                        </div>
                        <p>where <code>XXX</code> should be replaced by the latitude and <code>YYY</code> by the longitude.
                        </p>
                        <p>Отобразите два поля позиции и виджет карты, используя их в новой вкладке в режиме notebook представления вида Form текущего товара.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                    <div role="alert" class="alert-exercise alert">
                        <p class="alert-title">Упражнение</p>
                        <p>Получение текущих координат</p>
                        <p>Добавьте кнопку, переустановив координаты продукта в местоположение пользователя, вы можете получить эти координаты, используя API-интерфейс
                            <a href="http://diveintohtml5.info/geolocation.html" class="external reference alert-link">javascript geolocation API</a>.</p>
                        <p>Теперь мы хотим отобразить дополнительную кнопку, чтобы автоматически устанавливать координаты в положение текущего пользователя.</p>
                        <p>Чтобы получить координаты пользователя, простым способом является использование JavaScript API-интерфейс. <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">Смотрите онлайн-документацию, чтобы знать, как ее использовать.</a>.</p>
                        <p>Также обратите внимание, что пользователь не должен нажимать на эту кнопку, когда вид формы находится в режиме только для чтения. Таким образом, этот пользовательский виджет должен корректно обрабатывать свойство <code>effective_readonly</code>  точно так же, как любое поле. Одним из способов сделать это было бы заставить кнопку исчезать, когда значение <code>effective_readonly</code> истинно.</p>
                        <div class="highlight-javascript">
                            <div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetCoordinates</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="s1">&#39;received_position&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">sup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_latitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:provider_longitude&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_map</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">sup</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">display_map</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;WidgetCoordinates&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_latitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;provider_longitude&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;button&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">));</span>
    <span class="p">},</span>
    <span class="nx">received_position</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">set_values</span><span class="p">({</span>
            <span class="s2">&quot;provider_latitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">,</span>
            <span class="s2">&quot;provider_longitude&quot;</span><span class="o">:</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetCoordinates&#39;</span><span class="p">);</span>
</pre></div>
                        </div>
                        <div class="highlight-xml">
                            <div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;WidgetCoordinates&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span>
        <span class="na">t-attf-src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll={{latitude}},{{longitude}}&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/iframe&gt;</span>
    <span class="nt">&lt;button&gt;</span>Get My Current Coordinate<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
                        </div>
                    </div>
                    <div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> как отдельное понятие из экземпляра. Во многих языках классы являются полноценными объектами а так же сами экземпляры (метаклассов), но это два достаточно разных поняти класс и экземпляр и между ними соблюдается четко прописанная иерархия</div>
                    <div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> a а также о различиях между браузерами, хотя со временем это стало менее насущным </div>
                </section>

            </article>
        </div>

        <div id="mask"></div>
    </main>

    <div class="floating_action_container">
        <a id="floating_action" class="ripple" href="#">
            <i class="mdi-action-explore"></i>
        </a>
        <div id="floating_action_menu">
            <span class="bubble"></span>
            <ul class="list-group content">
                <li class="list-group-item ripple"><a>Cras justo odio</a></li>
                <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
                <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
                <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
                <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
            </ul>
        </div>
    </div>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter42690849 = new Ya.Metrika({
                        id: 42690849,
                        clickmap: true,
                        trackLinks: true,
                        accurateTrackBounce: true,
                        webvisor: true,
                        trackHash: true
                    });
                } catch (e) {}
            });

            var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function() {
                    n.parentNode.insertBefore(s, n);
                };
            s.type = "text/javascript";
            s.async = true;
            s.src = "https://mc.yandex.ru/metrika/watch.js";

            if (w.opera == "[object Opera]") {
                d.addEventListener("DOMContentLoaded", f, false);
            } else {
                f();
            }
        })(document, window, "yandex_metrika_callbacks");
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/42690849" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
</body>

</html>
